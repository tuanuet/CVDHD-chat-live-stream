{"version":3,"sources":["../app.js"],"names":["express","require","compression","session","bodyParser","logger","chalk","errorHandler","lusca","dotenv","MongoStore","flash","path","mongoose","passport","expressValidator","expressStatusMonitor","sass","multer","upload","dest","join","__dirname","load","homeController","userController","contactController","passportConfig","app","server","createServer","Promise","global","connect","process","env","MONGODB_URI","MONGOLAB_URI","connection","on","err","console","error","log","red","exit","set","OPENSHIFT_NODEJS_IP","PORT","OPENSHIFT_NODEJS_PORT","use","src","resave","saveUninitialized","secret","SESSION_SECRET","store","url","autoReconnect","clear_interval","initialize","req","res","next","locals","user","match","returnTo","static","isAuthenticated","get","index","getLogin","post","postLogin","logout","getForgot","postForgot","getReset","postReset","getSignup","postSignup","getContact","postContact","getAccount","postUpdateProfile","postUpdatePassword","postDeleteAccount","getOauthUnlink","listen","green","io","module","exports"],"mappings":"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","file":"app.js","sourcesContent":["/**\n * Module dependencies.\n */\nconst express = require('express');\nconst compression = require('compression');\nconst session = require('express-session');\nconst bodyParser = require('body-parser');\nconst logger = require('morgan');\nconst chalk = require('chalk');\nconst errorHandler = require('errorhandler');\nconst lusca = require('lusca');\nconst dotenv = require('dotenv');\nconst MongoStore = require('connect-mongo')(session);\nconst flash = require('express-flash');\nconst path = require('path');\nconst mongoose = require('mongoose');\nconst passport = require('passport');\nconst expressValidator = require('express-validator');\nconst expressStatusMonitor = require('express-status-monitor');\nconst sass = require('node-sass-middleware');\nconst multer = require('multer');\n\nconst upload = multer({ dest: path.join(__dirname, 'uploads') });\n\n/**\n * Load environment variables from .env file, where API keys and passwords are configured.\n */\ndotenv.load({ path: '.env.example' });\n\n/**\n * Controllers (route handlers).\n */\nconst homeController = require('./controllers/home');\nconst userController = require('./controllers/user');\nconst contactController = require('./controllers/contact');\n\n/**\n * API keys and Passport configuration.\n */\nconst passportConfig = require('./config/passport');\n\n/**\n * Create Express server.\n */\nconst app = express();\nvar server = require('http').createServer(app);\n/**\n * Connect to MongoDB.\n */\nmongoose.Promise = global.Promise;\nmongoose.connect(process.env.MONGODB_URI || process.env.MONGOLAB_URI);\nmongoose.connection.on('error', (err) => {\n  console.error(err);\n  console.log('%s MongoDB connection error. Please make sure MongoDB is running.', chalk.red('âœ—'));\n  process.exit();\n});\n\n/**\n * Express configuration.\n */\napp.set('host', process.env.OPENSHIFT_NODEJS_IP || '0.0.0.0');\napp.set('port', process.env.PORT || process.env.OPENSHIFT_NODEJS_PORT || 8080);\napp.set('views', path.join(__dirname, 'views'));\napp.set('view engine', 'pug');\n// app.use(expressStatusMonitor());\n// app.use(compression());\napp.use(sass({\n  src: path.join(__dirname, 'public'),\n  dest: path.join(__dirname, 'public')\n}));\napp.use(logger('dev'));\n// app.use(bodyParser.json());\n// app.use(bodyParser.urlencoded({ extended: true }));\napp.use(expressValidator());\napp.use(session({\n  resave: true,\n  saveUninitialized: true,\n  secret: process.env.SESSION_SECRET,\n  store: new MongoStore({\n    url: process.env.MONGODB_URI || process.env.MONGOLAB_URI,\n    autoReconnect: true,\n    clear_interval: 3600\n  })\n}));\napp.use(passport.initialize());\napp.use(passport.session());\napp.use(flash());\napp.use((req, res, next) => {\n  res.locals.user = req.user;\n  next();\n});\napp.use((req, res, next) => {\n  // After successful login, redirect back to the intended page\n  if (!req.user &&\n      req.path !== '/login' &&\n      req.path !== '/signup' &&\n      !req.path.match(/^\\/auth/) &&\n      !req.path.match(/\\./)) {\n    req.session.returnTo = req.path;\n  } else if (req.user &&\n      req.path === '/account') {\n    req.session.returnTo = req.path;\n  }\n  next();\n});\napp.use(express.static(path.join(__dirname, 'public')));\n\n//import router\nimport routerLiveStream from './router/livestream.js';\nimport routerLiveChat from './router/livechat.js';\n\napp.use('/livechat',passportConfig.isAuthenticated,routerLiveChat);\napp.use('/livestream',passportConfig.isAuthenticated,routerLiveStream);\n\n/**\n * Primary app routes.\n */\napp.get('/', homeController.index);\napp.get('/login', userController.getLogin);\napp.post('/login', userController.postLogin);\napp.get('/logout', userController.logout);\napp.get('/forgot', userController.getForgot);\napp.post('/forgot', userController.postForgot);\napp.get('/reset/:token', userController.getReset);\napp.post('/reset/:token', userController.postReset);\napp.get('/signup', userController.getSignup);\napp.post('/signup', userController.postSignup);\napp.get('/contact', contactController.getContact);\napp.post('/contact', contactController.postContact);\napp.get('/account', passportConfig.isAuthenticated, userController.getAccount);\napp.post('/account/profile', passportConfig.isAuthenticated, userController.postUpdateProfile);\napp.post('/account/password', passportConfig.isAuthenticated, userController.postUpdatePassword);\napp.post('/account/delete', passportConfig.isAuthenticated, userController.postDeleteAccount);\napp.get('/account/unlink/:provider', passportConfig.isAuthenticated, userController.getOauthUnlink);\n\n/**\n * Error Handler.\n */\napp.use(errorHandler());\n\n/**\n * Start Express server.\n */\nserver.listen(app.get('port'), () => {\n  console.log('%s App is running at http://localhost:%d in %s mode', chalk.green('âœ“'), app.get('port'), app.get('env'));\n  console.log('  Press CTRL-C to stop\\n');\n});\n\n\n/**\n  * event socket\n  */\nimport socketEvent from './socketEvent.js'\nconst io = require('socket.io')(server);\nsocketEvent(io);\n\nmodule.exports = app;\n"]}