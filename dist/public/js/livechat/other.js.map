{"version":3,"sources":["../../../../public/js/livechat/other.js"],"names":["$","socket","io","transports","on","arrUserInfo","show","console","log","forEach","user","ten","peerId","append","remove","alert","openStream","config","audio","video","navigator","mediaDevices","getUserMedia","playStream","idVideoTag","stream","document","getElementById","srcObject","play","peer","Peer","key","host","secure","port","id","click","username","val","emit","then","call","remoteStream","answer","attr"],"mappings":";;AAAAA,EAAE,YAAM;AACN,MAAMC,SAASC,GAAG,WAAH,EAAgB,EAAEC,YAAY,CAAC,WAAD,CAAd,EAAhB,CAAf;;AAEAF,SAAOG,EAAP,CAAU,kBAAV,EAA8B,UAACC,WAAD,EAAiB;AAC7CL,MAAE,WAAF,EAAeM,IAAf;AACAC,YAAQC,GAAR,CAAYH,WAAZ;AACAA,gBAAYI,OAAZ,CAAoB,UAACC,IAAD,EAAU;AAAA,UACpBC,GADoB,GACJD,IADI,CACpBC,GADoB;AAAA,UACfC,MADe,GACJF,IADI,CACfE,MADe;;AAE5BZ,QAAE,SAAF,EAAaa,MAAb,cAA+BD,MAA/B,UAA0CD,GAA1C;AACD,KAHD;AAIAV,WAAOG,EAAP,CAAU,mBAAV,EAA+B,UAACM,IAAD,EAAU;AAAA,UAC/BC,GAD+B,GACfD,IADe,CAC/BC,GAD+B;AAAA,UAC1BC,MAD0B,GACfF,IADe,CAC1BE,MAD0B;;AAEvCZ,QAAE,SAAF,EAAaa,MAAb,cAA+BD,MAA/B,UAA0CD,GAA1C;AACD,KAHD;AAIAV,WAAOG,EAAP,CAAU,oBAAV,EAAgC,UAACQ,MAAD,EAAY;AAC1CZ,cAAMY,MAAN,EAAgBE,MAAhB;AACD,KAFD;AAGA;AACD,GAfD;AAgBAb,SAAOG,EAAP,CAAU,kBAAV,EAA8B;AAAA,WAAMW,MAAM,8BAAN,CAAN;AAAA,GAA9B;;AAEA,WAASC,UAAT,GAAsB;AACpB,QAAMC,SAAS,EAAEC,OAAO,IAAT,EAAeC,OAAO,IAAtB,EAAf;AACA,WAAOC,UAAUC,YAAV,CAAuBC,YAAvB,CAAoCL,MAApC,CAAP;AACD;;AAGD,WAASM,UAAT,CAAoBC,UAApB,EAAgCC,MAAhC,EAAwC;AACtC,QAAMN,QAAQO,SAASC,cAAT,CAAwBH,UAAxB,CAAd;AACAL,UAAMS,SAAN,GAAkBH,MAAlB;AACAN,UAAMU,IAAN;AACD;;AAED,MAAMC,OAAO,IAAIC,IAAJ,CAAS,EAAEC,KAAK,QAAP,EAAiBC,MAAM,mCAAvB,EAA4DC,QAAQ,IAApE,EAA0EC,MAAM,GAAhF,EAAT,CAAb;AACAL,OAAK1B,EAAL,CAAQ,MAAR,EAAgB,UAACgC,EAAD,EAAQ;AACtBpC,MAAE,UAAF,EAAca,MAAd,CAAqBuB,EAArB;AACApC,MAAE,YAAF,EAAgBqC,KAAhB,CAAsB,YAAM;AAC1B,UAAMC,WAAWtC,EAAE,cAAF,EAAkBuC,GAAlB,EAAjB;AACAtC,aAAOuC,IAAP,CAAY,oBAAZ,EAAkC,EAAE7B,KAAK2B,QAAP,EAAiB1B,QAAQwB,EAAzB,EAAlC;AACD,KAHD;AAID,GAND;;AAQA;AACApC,IAAE,UAAF,EAAcqC,KAAd,CAAoB,YAAM;AACxB,QAAMD,KAAKpC,EAAE,WAAF,EAAeuC,GAAf,EAAX,CADwB,CACS;AACjCvB,iBAAayB,IAAb,CAAkB,UAAChB,MAAD,EAAY;AAC5BF,iBAAW,aAAX,EAA0BE,MAA1B;AACA,UAAMiB,OAAOZ,KAAKY,IAAL,CAAUN,EAAV,EAAcX,MAAd,CAAb;AACAiB,WAAKtC,EAAL,CAAQ,QAAR,EAAkB;AAAA,eAAgBmB,WAAW,cAAX,EAA2BoB,YAA3B,CAAhB;AAAA,OAAlB;AACD,KAJD;AAKD,GAPD;AAQA;;AAEAb,OAAK1B,EAAL,CAAQ,MAAR,EAAgB,UAACsC,IAAD,EAAU;AACxB1B,iBAAayB,IAAb,CAAkB,UAAChB,MAAD,EAAY;AAC5BiB,WAAKE,MAAL,CAAYnB,MAAZ,EAD4B,CACP;AACrBF,iBAAW,aAAX,EAA0BE,MAA1B;AACAiB,WAAKtC,EAAL,CAAQ,QAAR,EAAkB;AAAA,eAAgBmB,WAAW,cAAX,EAA2BoB,YAA3B,CAAhB;AAAA,OAAlB;AACD,KAJD;AAKD,GAND;;AASA3C,IAAE,SAAF,EAAaI,EAAb,CAAgB,OAAhB,EAAyB,IAAzB,EAA+B,YAAY;AACzC,QAAMgC,KAAKpC,EAAE,IAAF,EAAQ6C,IAAR,CAAa,IAAb,CAAX;AACA7B,iBAAayB,IAAb,CAAkB,UAAChB,MAAD,EAAY;AAC5BF,iBAAW,aAAX,EAA0BE,MAA1B;AACA,UAAMiB,OAAOZ,KAAKY,IAAL,CAAUN,EAAV,EAAcX,MAAd,CAAb;AACAiB,WAAKtC,EAAL,CAAQ,QAAR,EAAkB;AAAA,eAAgBmB,WAAW,cAAX,EAA2BoB,YAA3B,CAAhB;AAAA,OAAlB;AACD,KAJD;AAKD,GAPD;AAQD,CAtED","file":"other.js","sourcesContent":["$(() => {\n  const socket = io('/livechat', { transports: ['websocket'] });\n\n  socket.on('DANH_SACH_ONLINE', (arrUserInfo) => {\n    $('#div-chat').show();\n    console.log(arrUserInfo);\n    arrUserInfo.forEach((user) => {\n      const { ten, peerId } = user;\n      $('#ulUser').append(`<li id=\"${peerId}\">${ten}</li>`);\n    });\n    socket.on('CO_NGUOI_DUNG_MOI', (user) => {\n      const { ten, peerId } = user;\n      $('#ulUser').append(`<li id=\"${peerId}\">${ten}</li>`);\n    });\n    socket.on('AI_DO_NGAT_KET_NOI', (peerId) => {\n      $(`#${peerId}`).remove();\n    });\n    // openStream().then(stream =>playStream('localStream',stream));\n  });\n  socket.on('DANG_KY_THAT_BAI', () => alert('Vuil long chá»n username khac'));\n\n  function openStream() {\n    const config = { audio: true, video: true };\n    return navigator.mediaDevices.getUserMedia(config);\n  }\n\n\n  function playStream(idVideoTag, stream) {\n    const video = document.getElementById(idVideoTag);\n    video.srcObject = stream;\n    video.play();\n  }\n\n  const peer = new Peer({ key: 'peerjs', host: 'uet-video-call-peer.herokuapp.com', secure: true, port: 443 });\n  peer.on('open', (id) => {\n    $('#my-peer').append(id);\n    $('#btnSignUp').click(() => {\n      const username = $('#txtUsername').val();\n      socket.emit('NGUOI_DUNG_DANG_KY', { ten: username, peerId: id });\n    });\n  });\n\n  // Nguoi goi di\n  $('#btnCall').click(() => {\n    const id = $('#remoteId').val(); // Lay ra Id nguoi duoc goi\n    openStream().then((stream) => {\n      playStream('localStream', stream);\n      const call = peer.call(id, stream);\n      call.on('stream', remoteStream => playStream('remoteStream', remoteStream));\n    });\n  });\n  // Nguoi nhan\n\n  peer.on('call', (call) => {\n    openStream().then((stream) => {\n      call.answer(stream); // Tra loi bang cach tra lai stream dang call\n      playStream('localStream', stream);\n      call.on('stream', remoteStream => playStream('remoteStream', remoteStream));\n    });\n  });\n\n\n  $('#ulUser').on('click', 'li', function () {\n    const id = $(this).attr('id');\n    openStream().then((stream) => {\n      playStream('localStream', stream);\n      const call = peer.call(id, stream);\n      call.on('stream', remoteStream => playStream('remoteStream', remoteStream));\n    });\n  });\n});\n\n"]}