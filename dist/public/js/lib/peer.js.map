{"version":3,"sources":["../../../../public/js/lib/peer.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","module","RTCSessionDescription","window","mozRTCSessionDescription","RTCPeerConnection","mozRTCPeerConnection","webkitRTCPeerConnection","RTCIceCandidate","mozRTCIceCandidate","util","EventEmitter","Negotiator","Reliable","DataConnection","peer","provider","options","extend","serialization","reliable","open","type","id","connectionId","_idPrefix","randomToken","label","metadata","_buffer","_buffering","bufferSize","_chunkedData","_payload","_peerBrowser","browser","startConnection","originator","inherits","prototype","initialize","dc","_dc","dataChannel","_configureDataChannel","self","supports","sctp","binaryType","onopen","log","emit","_reliable","debug","onmessage","msg","_handleDataMessage","onclose","close","data","datatype","constructor","Blob","blobToArrayBuffer","ab","unpack","ArrayBuffer","String","binaryStringToArrayBuffer","JSON","parse","__peerData","chunkInfo","count","total","cleanup","send","chunked","_bufferedSend","stringify","blob","pack","needsChunking","chunkedBrowsers","size","chunkedMTU","_sendChunks","blobToBinaryString","str","binaryBlob","_trySend","push","setTimeout","_tryBuffer","shift","blobs","chunk","ii","handleMessage","message","payload","handleSDP","sdp","handleCandidate","candidate","warn","Socket","MediaConnection","Peer","BinaryPack","localStream","_stream","addStream","remoteStream","answer","stream","messages","_getMessages","pcs","media","queue","connection","pc","_getPeerConnection","peerConnection","config","createDataChannel","onnegotiationneeded","_makeOffer","error","peerConnections","signalingState","_startPeerConnection","optional","RtpDataChannels","DtlsSrtpKeyAgreement","_setupListeners","pc_id","peerId","onicecandidate","evt","socket","dst","oniceconnectionstatechange","iceConnectionState","noop","onicechange","ondatachannel","channel","getConnection","onaddstream","readyState","createOffer","offer","higherBandwidthSDP","setLocalDescription","err","emitError","constraints","_makeAnswer","createAnswer","setRemoteDescription","ice","sdpMLineIndex","addIceCandidate","Object","undefined","toString","host","CLOUD_HOST","port","CLOUD_PORT","key","path","token","defaultConfig","location","hostname","secure","isSecure","logFunction","setLogFunction","setLogLevel","audioVideo","_delayedAbort","validateId","validateKey","destroyed","disconnected","connections","_lostMessages","_initializeServerConnection","_initialize","_retrieveId","on","_handleMessage","_abort","disconnect","cb","http","XMLHttpRequest","protocol","url","queryString","Date","getTime","Math","random","onerror","pathError","onreadystatechange","status","responseText","start","src","_cleanupPeer","_addConnection","_storeMessage","connect","setZeroTimeout","_lastServerId","destroy","_cleanup","peers","keys","j","jj","reconnect","listAllPeers","helpfulError","_queue","httpProtocol","wsProtocol","_httpUrl","_wsUrl","_startXhrStream","_startWebSocket","_socket","WebSocket","event","_timeout","clearTimeout","_http","abort","_sendQueuedMessages","_index","_streamIndex","old","_handleStream","_setHTTPTimeout","split","index","bufferedMessage","_wsOpen","toLowerCase","setRequestHeader","dataCount","logLevel","level","debugLevel","parseInt","isNaN","_printWith","_print","fn","Function","prefix","copy","Array","slice","arguments","unshift","apply","name","console","reliablePC","reliableDC","negotiationPC","binary","exec","ctor","superCtor","super_","create","value","enumerable","writable","configurable","dest","source","hasOwnProperty","global","timeouts","messageName","setZeroTimeoutPostMessage","postMessage","stopPropagation","addEventListener","attachEvent","bl","chunks","ceil","end","min","b","fr","FileReader","onload","target","result","readAsArrayBuffer","readAsBinaryString","byteArray","Uint8Array","charCodeAt","buffer","substr","EE","context","once","_events","listeners","ee","a1","a2","a3","a4","a5","len","args","removeListener","events","removeAllListeners","off","addListener","setMaxListeners","EventEmitter2","EventEmitter3","BufferBuilder","binaryFeatures","unpacker","Unpacker","packer","Packer","getBuffer","dataBuffer","dataView","byteLength","unpack_uint8","positive_fixnum","negative_fixnum","unpack_raw","unpack_string","unpack_array","unpack_map","unpack_float","unpack_double","unpack_uint16","unpack_uint32","unpack_uint64","unpack_int8","unpack_int16","unpack_int32","unpack_int64","byte","bytes","read","uint16","uint32","uint64","uint8","pow","buf","c","fromCharCode","objects","map","sign","exp","fraction","h32","l32","hfrac","frac","subarray","bufferBuilder","pack_string","floor","pack_integer","pack_double","append","pack_array","File","pack_bin","useArrayBufferView","pack_object","toBinaryPack","flush","pack_uint8","pack_uint16","pack_uint32","utf8Length","ary","num","pack_int8","pack_int16","pack_int32","pack_int64","pack_uint64","LN2","frac0","frac1","b32","obj","prop","high","low","_utf8Replace","m","replace","useBlobBuilder","BlobBuilder","WebKitBlobBuilder","MozBlobBuilder","MSBlobBuilder","_pieces","_parts","builder","getBlob","_outgoing","_incoming","_received","_window","_mtu","_interval","_count","_setupDC","_handleSend","ack","_chunk","timer","_sendWindowedChunks","_setupInterval","setInterval","_multiple","_intervalSend","_processAcks","item","indexOf","idata","odata","_ack","max","_calculateNextAck","_complete","ch","limit","sent","version","navigator","appVersion","match","parts"],"mappings":"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","file":"peer.js","sourcesContent":["/*! peerjs build:0.3.13, development. Copyright(c) 2013 Michelle Bu <michelle@michellebu.com> */(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n    module.exports.RTCSessionDescription = window.RTCSessionDescription ||\n        window.mozRTCSessionDescription;\n    module.exports.RTCPeerConnection = window.RTCPeerConnection ||\n        window.mozRTCPeerConnection || window.webkitRTCPeerConnection;\n    module.exports.RTCIceCandidate = window.RTCIceCandidate ||\n        window.mozRTCIceCandidate;\n\n},{}],2:[function(require,module,exports){\n    var util = require('./util');\n    var EventEmitter = require('eventemitter3');\n    var Negotiator = require('./negotiator');\n    var Reliable = require('reliable');\n\n    /**\n     * Wraps a DataChannel between two Peers.\n     */\n    function DataConnection(peer, provider, options) {\n        if (!(this instanceof DataConnection)) return new DataConnection(peer, provider, options);\n        EventEmitter.call(this);\n\n        this.options = util.extend({\n            serialization: 'binary',\n            reliable: false\n        }, options);\n\n        // Connection is not open yet.\n        this.open = false;\n        this.type = 'data';\n        this.peer = peer;\n        this.provider = provider;\n\n        this.id = this.options.connectionId || DataConnection._idPrefix + util.randomToken();\n\n        this.label = this.options.label || this.id;\n        this.metadata = this.options.metadata;\n        this.serialization = this.options.serialization;\n        this.reliable = this.options.reliable;\n\n        // Data channel buffering.\n        this._buffer = [];\n        this._buffering = false;\n        this.bufferSize = 0;\n\n        // For storing large data.\n        this._chunkedData = {};\n\n        if (this.options._payload) {\n            this._peerBrowser = this.options._payload.browser;\n        }\n\n        Negotiator.startConnection(\n            this,\n            this.options._payload || {\n                originator: true\n            }\n        );\n    }\n\n    util.inherits(DataConnection, EventEmitter);\n\n    DataConnection._idPrefix = 'dc_';\n\n    /** Called by the Negotiator when the DataChannel is ready. */\n    DataConnection.prototype.initialize = function(dc) {\n        this._dc = this.dataChannel = dc;\n        this._configureDataChannel();\n    }\n\n    DataConnection.prototype._configureDataChannel = function() {\n        var self = this;\n        if (util.supports.sctp) {\n            this._dc.binaryType = 'arraybuffer';\n        }\n        this._dc.onopen = function() {\n            util.log('Data channel connection success');\n            self.open = true;\n            self.emit('open');\n        }\n\n        // Use the Reliable shim for non Firefox browsers\n        if (!util.supports.sctp && this.reliable) {\n            this._reliable = new Reliable(this._dc, util.debug);\n        }\n\n        if (this._reliable) {\n            this._reliable.onmessage = function(msg) {\n                self.emit('data', msg);\n            };\n        } else {\n            this._dc.onmessage = function(e) {\n                self._handleDataMessage(e);\n            };\n        }\n        this._dc.onclose = function(e) {\n            util.log('DataChannel closed for:', self.peer);\n            self.close();\n        };\n    }\n\n// Handles a DataChannel message.\n    DataConnection.prototype._handleDataMessage = function(e) {\n        var self = this;\n        var data = e.data;\n        var datatype = data.constructor;\n        if (this.serialization === 'binary' || this.serialization === 'binary-utf8') {\n            if (datatype === Blob) {\n                // Datatype should never be blob\n                util.blobToArrayBuffer(data, function(ab) {\n                    data = util.unpack(ab);\n                    self.emit('data', data);\n                });\n                return;\n            } else if (datatype === ArrayBuffer) {\n                data = util.unpack(data);\n            } else if (datatype === String) {\n                // String fallback for binary data for browsers that don't support binary yet\n                var ab = util.binaryStringToArrayBuffer(data);\n                data = util.unpack(ab);\n            }\n        } else if (this.serialization === 'json') {\n            data = JSON.parse(data);\n        }\n\n        // Check if we've chunked--if so, piece things back together.\n        // We're guaranteed that this isn't 0.\n        if (data.__peerData) {\n            var id = data.__peerData;\n            var chunkInfo = this._chunkedData[id] || {data: [], count: 0, total: data.total};\n\n            chunkInfo.data[data.n] = data.data;\n            chunkInfo.count += 1;\n\n            if (chunkInfo.total === chunkInfo.count) {\n                // Clean up before making the recursive call to `_handleDataMessage`.\n                delete this._chunkedData[id];\n\n                // We've received all the chunks--time to construct the complete data.\n                data = new Blob(chunkInfo.data);\n                this._handleDataMessage({data: data});\n            }\n\n            this._chunkedData[id] = chunkInfo;\n            return;\n        }\n\n        this.emit('data', data);\n    }\n\n    /**\n     * Exposed functionality for users.\n     */\n\n    /** Allows user to close connection. */\n    DataConnection.prototype.close = function() {\n        if (!this.open) {\n            return;\n        }\n        this.open = false;\n        Negotiator.cleanup(this);\n        this.emit('close');\n    }\n\n    /** Allows user to send data. */\n    DataConnection.prototype.send = function(data, chunked) {\n        if (!this.open) {\n            this.emit('error', new Error('Connection is not open. You should listen for the `open` event before sending messages.'));\n            return;\n        }\n        if (this._reliable) {\n            // Note: reliable shim sending will make it so that you cannot customize\n            // serialization.\n            this._reliable.send(data);\n            return;\n        }\n        var self = this;\n        if (this.serialization === 'json') {\n            this._bufferedSend(JSON.stringify(data));\n        } else if (this.serialization === 'binary' || this.serialization === 'binary-utf8') {\n            var blob = util.pack(data);\n\n            // For Chrome-Firefox interoperability, we need to make Firefox \"chunk\"\n            // the data it sends out.\n            var needsChunking = util.chunkedBrowsers[this._peerBrowser] || util.chunkedBrowsers[util.browser];\n            if (needsChunking && !chunked && blob.size > util.chunkedMTU) {\n                this._sendChunks(blob);\n                return;\n            }\n\n            // DataChannel currently only supports strings.\n            if (!util.supports.sctp) {\n                util.blobToBinaryString(blob, function(str) {\n                    self._bufferedSend(str);\n                });\n            } else if (!util.supports.binaryBlob) {\n                // We only do this if we really need to (e.g. blobs are not supported),\n                // because this conversion is costly.\n                util.blobToArrayBuffer(blob, function(ab) {\n                    self._bufferedSend(ab);\n                });\n            } else {\n                this._bufferedSend(blob);\n            }\n        } else {\n            this._bufferedSend(data);\n        }\n    }\n\n    DataConnection.prototype._bufferedSend = function(msg) {\n        if (this._buffering || !this._trySend(msg)) {\n            this._buffer.push(msg);\n            this.bufferSize = this._buffer.length;\n        }\n    }\n\n// Returns true if the send succeeds.\n    DataConnection.prototype._trySend = function(msg) {\n        try {\n            this._dc.send(msg);\n        } catch (e) {\n            this._buffering = true;\n\n            var self = this;\n            setTimeout(function() {\n                // Try again.\n                self._buffering = false;\n                self._tryBuffer();\n            }, 100);\n            return false;\n        }\n        return true;\n    }\n\n// Try to send the first message in the buffer.\n    DataConnection.prototype._tryBuffer = function() {\n        if (this._buffer.length === 0) {\n            return;\n        }\n\n        var msg = this._buffer[0];\n\n        if (this._trySend(msg)) {\n            this._buffer.shift();\n            this.bufferSize = this._buffer.length;\n            this._tryBuffer();\n        }\n    }\n\n    DataConnection.prototype._sendChunks = function(blob) {\n        var blobs = util.chunk(blob);\n        for (var i = 0, ii = blobs.length; i < ii; i += 1) {\n            var blob = blobs[i];\n            this.send(blob, true);\n        }\n    }\n\n    DataConnection.prototype.handleMessage = function(message) {\n        var payload = message.payload;\n\n        switch (message.type) {\n            case 'ANSWER':\n                this._peerBrowser = payload.browser;\n\n                // Forward to negotiator\n                Negotiator.handleSDP(message.type, this, payload.sdp);\n                break;\n            case 'CANDIDATE':\n                Negotiator.handleCandidate(this, payload.candidate);\n                break;\n            default:\n                util.warn('Unrecognized message type:', message.type, 'from peer:', this.peer);\n                break;\n        }\n    }\n\n    module.exports = DataConnection;\n\n},{\"./negotiator\":5,\"./util\":8,\"eventemitter3\":9,\"reliable\":12}],3:[function(require,module,exports){\n    window.Socket = require('./socket');\n    window.MediaConnection = require('./mediaconnection');\n    window.DataConnection = require('./dataconnection');\n    window.Peer = require('./peer');\n    window.RTCPeerConnection = require('./adapter').RTCPeerConnection;\n    window.RTCSessionDescription = require('./adapter').RTCSessionDescription;\n    window.RTCIceCandidate = require('./adapter').RTCIceCandidate;\n    window.Negotiator = require('./negotiator');\n    window.util = require('./util');\n    window.BinaryPack = require('js-binarypack');\n\n},{\"./adapter\":1,\"./dataconnection\":2,\"./mediaconnection\":4,\"./negotiator\":5,\"./peer\":6,\"./socket\":7,\"./util\":8,\"js-binarypack\":10}],4:[function(require,module,exports){\n    var util = require('./util');\n    var EventEmitter = require('eventemitter3');\n    var Negotiator = require('./negotiator');\n\n    /**\n     * Wraps the streaming interface between two Peers.\n     */\n    function MediaConnection(peer, provider, options) {\n        if (!(this instanceof MediaConnection)) return new MediaConnection(peer, provider, options);\n        EventEmitter.call(this);\n\n        this.options = util.extend({}, options);\n\n        this.open = false;\n        this.type = 'media';\n        this.peer = peer;\n        this.provider = provider;\n        this.metadata = this.options.metadata;\n        this.localStream = this.options._stream;\n\n        this.id = this.options.connectionId || MediaConnection._idPrefix + util.randomToken();\n        if (this.localStream) {\n            Negotiator.startConnection(\n                this,\n                {_stream: this.localStream, originator: true}\n            );\n        }\n    };\n\n    util.inherits(MediaConnection, EventEmitter);\n\n    MediaConnection._idPrefix = 'mc_';\n\n    MediaConnection.prototype.addStream = function(remoteStream) {\n        util.log('Receiving stream', remoteStream);\n\n        this.remoteStream = remoteStream;\n        this.emit('stream', remoteStream); // Should we call this `open`?\n\n    };\n\n    MediaConnection.prototype.handleMessage = function(message) {\n        var payload = message.payload;\n\n        switch (message.type) {\n            case 'ANSWER':\n                // Forward to negotiator\n                Negotiator.handleSDP(message.type, this, payload.sdp);\n                this.open = true;\n                break;\n            case 'CANDIDATE':\n                Negotiator.handleCandidate(this, payload.candidate);\n                break;\n            default:\n                util.warn('Unrecognized message type:', message.type, 'from peer:', this.peer);\n                break;\n        }\n    }\n\n    MediaConnection.prototype.answer = function(stream) {\n        if (this.localStream) {\n            util.warn('Local stream already exists on this MediaConnection. Are you answering a call twice?');\n            return;\n        }\n\n        this.options._payload._stream = stream;\n\n        this.localStream = stream;\n        Negotiator.startConnection(\n            this,\n            this.options._payload\n        )\n        // Retrieve lost messages stored because PeerConnection not set up.\n        var messages = this.provider._getMessages(this.id);\n        for (var i = 0, ii = messages.length; i < ii; i += 1) {\n            this.handleMessage(messages[i]);\n        }\n        this.open = true;\n    };\n\n    /**\n     * Exposed functionality for users.\n     */\n\n    /** Allows user to close connection. */\n    MediaConnection.prototype.close = function() {\n        if (!this.open) {\n            return;\n        }\n        this.open = false;\n        Negotiator.cleanup(this);\n        this.emit('close')\n    };\n\n    module.exports = MediaConnection;\n\n},{\"./negotiator\":5,\"./util\":8,\"eventemitter3\":9}],5:[function(require,module,exports){\n    var util = require('./util');\n    var RTCPeerConnection = require('./adapter').RTCPeerConnection;\n    var RTCSessionDescription = require('./adapter').RTCSessionDescription;\n    var RTCIceCandidate = require('./adapter').RTCIceCandidate;\n\n    /**\n     * Manages all negotiations between Peers.\n     */\n    var Negotiator = {\n        pcs: {\n            data: {},\n            media: {}\n        }, // type => {peerId: {pc_id: pc}}.\n        //providers: {}, // provider's id => providers (there may be multiple providers/client.\n        queue: [] // connections that are delayed due to a PC being in use.\n    }\n\n    Negotiator._idPrefix = 'pc_';\n\n    /** Returns a PeerConnection object set up correctly (for data, media). */\n    Negotiator.startConnection = function(connection, options) {\n        var pc = Negotiator._getPeerConnection(connection, options);\n\n        if (connection.type === 'media' && options._stream) {\n            // Add the stream.\n            pc.addStream(options._stream);\n        }\n\n        // Set the connection's PC.\n        connection.pc = connection.peerConnection = pc;\n        // What do we need to do now?\n        if (options.originator) {\n            if (connection.type === 'data') {\n                // Create the datachannel.\n                var config = {};\n                // Dropping reliable:false support, since it seems to be crashing\n                // Chrome.\n                /*if (util.supports.sctp && !options.reliable) {\n                  // If we have canonical reliable support...\n                  config = {maxRetransmits: 0};\n                }*/\n                // Fallback to ensure older browsers don't crash.\n                if (!util.supports.sctp) {\n                    config = {reliable: options.reliable};\n                }\n                var dc = pc.createDataChannel(connection.label, config);\n                connection.initialize(dc);\n            }\n\n            if (!util.supports.onnegotiationneeded) {\n                Negotiator._makeOffer(connection);\n            }\n        } else {\n            Negotiator.handleSDP('OFFER', connection, options.sdp);\n        }\n    }\n\n    Negotiator._getPeerConnection = function(connection, options) {\n        if (!Negotiator.pcs[connection.type]) {\n            util.error(connection.type + ' is not a valid connection type. Maybe you overrode the `type` property somewhere.');\n        }\n\n        if (!Negotiator.pcs[connection.type][connection.peer]) {\n            Negotiator.pcs[connection.type][connection.peer] = {};\n        }\n        var peerConnections = Negotiator.pcs[connection.type][connection.peer];\n\n        var pc;\n        // Not multiplexing while FF and Chrome have not-great support for it.\n        /*if (options.multiplex) {\n          ids = Object.keys(peerConnections);\n          for (var i = 0, ii = ids.length; i < ii; i += 1) {\n            pc = peerConnections[ids[i]];\n            if (pc.signalingState === 'stable') {\n              break; // We can go ahead and use this PC.\n            }\n          }\n        } else */\n        if (options.pc) { // Simplest case: PC id already provided for us.\n            pc = Negotiator.pcs[connection.type][connection.peer][options.pc];\n        }\n\n        if (!pc || pc.signalingState !== 'stable') {\n            pc = Negotiator._startPeerConnection(connection);\n        }\n        return pc;\n    }\n\n    /*\n    Negotiator._addProvider = function(provider) {\n      if ((!provider.id && !provider.disconnected) || !provider.socket.open) {\n        // Wait for provider to obtain an ID.\n        provider.on('open', function(id) {\n          Negotiator._addProvider(provider);\n        });\n      } else {\n        Negotiator.providers[provider.id] = provider;\n      }\n    }*/\n\n\n    /** Start a PC. */\n    Negotiator._startPeerConnection = function(connection) {\n        util.log('Creating RTCPeerConnection.');\n\n        var id = Negotiator._idPrefix + util.randomToken();\n        var optional = {};\n\n        if (connection.type === 'data' && !util.supports.sctp) {\n            optional = {optional: [{RtpDataChannels: true}]};\n        } else if (connection.type === 'media') {\n            // Interop req for chrome.\n            optional = {optional: [{DtlsSrtpKeyAgreement: true}]};\n        }\n\n        var pc = new RTCPeerConnection(connection.provider.options.config, optional);\n        Negotiator.pcs[connection.type][connection.peer][id] = pc;\n\n        Negotiator._setupListeners(connection, pc, id);\n\n        return pc;\n    }\n\n    /** Set up various WebRTC listeners. */\n    Negotiator._setupListeners = function(connection, pc, pc_id) {\n        var peerId = connection.peer;\n        var connectionId = connection.id;\n        var provider = connection.provider;\n\n        // ICE CANDIDATES.\n        util.log('Listening for ICE candidates.');\n        pc.onicecandidate = function(evt) {\n            if (evt.candidate) {\n                util.log('Received ICE candidates for:', connection.peer);\n                provider.socket.send({\n                    type: 'CANDIDATE',\n                    payload: {\n                        candidate: evt.candidate,\n                        type: connection.type,\n                        connectionId: connection.id\n                    },\n                    dst: peerId\n                });\n            }\n        };\n\n        pc.oniceconnectionstatechange = function() {\n            switch (pc.iceConnectionState) {\n                case 'disconnected':\n                case 'failed':\n                    util.log('iceConnectionState is disconnected, closing connections to ' + peerId);\n                    connection.close();\n                    break;\n                case 'completed':\n                    pc.onicecandidate = util.noop;\n                    break;\n            }\n        };\n\n        // Fallback for older Chrome impls.\n        pc.onicechange = pc.oniceconnectionstatechange;\n\n        // ONNEGOTIATIONNEEDED (Chrome)\n        util.log('Listening for `negotiationneeded`');\n        pc.onnegotiationneeded = function() {\n            util.log('`negotiationneeded` triggered');\n            if (pc.signalingState == 'stable') {\n                Negotiator._makeOffer(connection);\n            } else {\n                util.log('onnegotiationneeded triggered when not stable. Is another connection being established?');\n            }\n        };\n\n        // DATACONNECTION.\n        util.log('Listening for data channel');\n        // Fired between offer and answer, so options should already be saved\n        // in the options hash.\n        pc.ondatachannel = function(evt) {\n            util.log('Received data channel');\n            var dc = evt.channel;\n            var connection = provider.getConnection(peerId, connectionId);\n            connection.initialize(dc);\n        };\n\n        // MEDIACONNECTION.\n        util.log('Listening for remote stream');\n        pc.onaddstream = function(evt) {\n            util.log('Received remote stream');\n            var stream = evt.stream;\n            var connection = provider.getConnection(peerId, connectionId);\n            // 10/10/2014: looks like in Chrome 38, onaddstream is triggered after\n            // setting the remote description. Our connection object in these cases\n            // is actually a DATA connection, so addStream fails.\n            // TODO: This is hopefully just a temporary fix. We should try to\n            // understand why this is happening.\n            if (connection.type === 'media') {\n                connection.addStream(stream);\n            }\n        };\n    }\n\n    Negotiator.cleanup = function(connection) {\n        util.log('Cleaning up PeerConnection to ' + connection.peer);\n\n        var pc = connection.pc;\n\n        if (!!pc && (pc.readyState !== 'closed' || pc.signalingState !== 'closed')) {\n            pc.close();\n            connection.pc = null;\n        }\n    }\n\n    Negotiator._makeOffer = function(connection) {\n        var pc = connection.pc;\n        pc.createOffer(function(offer) {\n            util.log('Created offer.');\n\n            if (!util.supports.sctp && connection.type === 'data' && connection.reliable) {\n                offer.sdp = Reliable.higherBandwidthSDP(offer.sdp);\n            }\n\n            pc.setLocalDescription(offer, function() {\n                util.log('Set localDescription: offer', 'for:', connection.peer);\n                connection.provider.socket.send({\n                    type: 'OFFER',\n                    payload: {\n                        sdp: offer,\n                        type: connection.type,\n                        label: connection.label,\n                        connectionId: connection.id,\n                        reliable: connection.reliable,\n                        serialization: connection.serialization,\n                        metadata: connection.metadata,\n                        browser: util.browser\n                    },\n                    dst: connection.peer\n                });\n            }, function(err) {\n                connection.provider.emitError('webrtc', err);\n                util.log('Failed to setLocalDescription, ', err);\n            });\n        }, function(err) {\n            connection.provider.emitError('webrtc', err);\n            util.log('Failed to createOffer, ', err);\n        }, connection.options.constraints);\n    }\n\n    Negotiator._makeAnswer = function(connection) {\n        var pc = connection.pc;\n\n        pc.createAnswer(function(answer) {\n            util.log('Created answer.');\n\n            if (!util.supports.sctp && connection.type === 'data' && connection.reliable) {\n                answer.sdp = Reliable.higherBandwidthSDP(answer.sdp);\n            }\n\n            pc.setLocalDescription(answer, function() {\n                util.log('Set localDescription: answer', 'for:', connection.peer);\n                connection.provider.socket.send({\n                    type: 'ANSWER',\n                    payload: {\n                        sdp: answer,\n                        type: connection.type,\n                        connectionId: connection.id,\n                        browser: util.browser\n                    },\n                    dst: connection.peer\n                });\n            }, function(err) {\n                connection.provider.emitError('webrtc', err);\n                util.log('Failed to setLocalDescription, ', err);\n            });\n        }, function(err) {\n            connection.provider.emitError('webrtc', err);\n            util.log('Failed to create answer, ', err);\n        });\n    }\n\n    /** Handle an SDP. */\n    Negotiator.handleSDP = function(type, connection, sdp) {\n        sdp = new RTCSessionDescription(sdp);\n        var pc = connection.pc;\n\n        util.log('Setting remote description', sdp);\n        pc.setRemoteDescription(sdp, function() {\n            util.log('Set remoteDescription:', type, 'for:', connection.peer);\n\n            if (type === 'OFFER') {\n                Negotiator._makeAnswer(connection);\n            }\n        }, function(err) {\n            connection.provider.emitError('webrtc', err);\n            util.log('Failed to setRemoteDescription, ', err);\n        });\n    }\n\n    /** Handle a candidate. */\n    Negotiator.handleCandidate = function(connection, ice) {\n        var candidate = ice.candidate;\n        var sdpMLineIndex = ice.sdpMLineIndex;\n        connection.pc.addIceCandidate(new RTCIceCandidate({\n            sdpMLineIndex: sdpMLineIndex,\n            candidate: candidate\n        }));\n        util.log('Added ICE candidate for:', connection.peer);\n    }\n\n    module.exports = Negotiator;\n\n},{\"./adapter\":1,\"./util\":8}],6:[function(require,module,exports){\n    var util = require('./util');\n    var EventEmitter = require('eventemitter3');\n    var Socket = require('./socket');\n    var MediaConnection = require('./mediaconnection');\n    var DataConnection = require('./dataconnection');\n\n    /**\n     * A peer who can initiate connections with other peers.\n     */\n    function Peer(id, options) {\n        if (!(this instanceof Peer)) return new Peer(id, options);\n        EventEmitter.call(this);\n\n        // Deal with overloading\n        if (id && id.constructor == Object) {\n            options = id;\n            id = undefined;\n        } else if (id) {\n            // Ensure id is a string\n            id = id.toString();\n        }\n        //\n\n        // Configurize options\n        options = util.extend({\n            debug: 0, // 1: Errors, 2: Warnings, 3: All logs\n            host: util.CLOUD_HOST,\n            port: util.CLOUD_PORT,\n            key: 'peerjs',\n            path: '/',\n            token: util.randomToken(),\n            config: util.defaultConfig\n        }, options);\n        this.options = options;\n        // Detect relative URL host.\n        if (options.host === '/') {\n            options.host = window.location.hostname;\n        }\n        // Set path correctly.\n        if (options.path[0] !== '/') {\n            options.path = '/' + options.path;\n        }\n        if (options.path[options.path.length - 1] !== '/') {\n            options.path += '/';\n        }\n\n        // Set whether we use SSL to same as current host\n        if (options.secure === undefined && options.host !== util.CLOUD_HOST) {\n            options.secure = util.isSecure();\n        }\n        // Set a custom log function if present\n        if (options.logFunction) {\n            util.setLogFunction(options.logFunction);\n        }\n        util.setLogLevel(options.debug);\n        //\n\n        // Sanity checks\n        // Ensure WebRTC supported\n        if (!util.supports.audioVideo && !util.supports.data ) {\n            this._delayedAbort('browser-incompatible', 'The current browser does not support WebRTC');\n            return;\n        }\n        // Ensure alphanumeric id\n        if (!util.validateId(id)) {\n            this._delayedAbort('invalid-id', 'ID \"' + id + '\" is invalid');\n            return;\n        }\n        // Ensure valid key\n        if (!util.validateKey(options.key)) {\n            this._delayedAbort('invalid-key', 'API KEY \"' + options.key + '\" is invalid');\n            return;\n        }\n        // Ensure not using unsecure cloud server on SSL page\n        if (options.secure && options.host === '0.peerjs.com') {\n            this._delayedAbort('ssl-unavailable',\n                'The cloud server currently does not support HTTPS. Please run your own PeerServer to use HTTPS.');\n            return;\n        }\n        //\n\n        // States.\n        this.destroyed = false; // Connections have been killed\n        this.disconnected = false; // Connection to PeerServer killed but P2P connections still active\n        this.open = false; // Sockets and such are not yet open.\n        //\n\n        // References\n        this.connections = {}; // DataConnections for this peer.\n        this._lostMessages = {}; // src => [list of messages]\n        //\n\n        // Start the server connection\n        this._initializeServerConnection();\n        if (id) {\n            this._initialize(id);\n        } else {\n            this._retrieveId();\n        }\n        //\n    }\n\n    util.inherits(Peer, EventEmitter);\n\n// Initialize the 'socket' (which is actually a mix of XHR streaming and\n// websockets.)\n    Peer.prototype._initializeServerConnection = function() {\n        var self = this;\n        this.socket = new Socket(this.options.secure, this.options.host, this.options.port, this.options.path, this.options.key);\n        this.socket.on('message', function(data) {\n            self._handleMessage(data);\n        });\n        this.socket.on('error', function(error) {\n            self._abort('socket-error', error);\n        });\n        this.socket.on('disconnected', function() {\n            // If we haven't explicitly disconnected, emit error and disconnect.\n            if (!self.disconnected) {\n                self.emitError('network', 'Lost connection to server.');\n                self.disconnect();\n            }\n        });\n        this.socket.on('close', function() {\n            // If we haven't explicitly disconnected, emit error.\n            if (!self.disconnected) {\n                self._abort('socket-closed', 'Underlying socket is already closed.');\n            }\n        });\n    };\n\n    /** Get a unique ID from the server via XHR. */\n    Peer.prototype._retrieveId = function(cb) {\n        var self = this;\n        var http = new XMLHttpRequest();\n        var protocol = this.options.secure ? 'https://' : 'http://';\n        var url = protocol + this.options.host + ':' + this.options.port +\n            this.options.path + this.options.key + '/id';\n        var queryString = '?ts=' + new Date().getTime() + '' + Math.random();\n        url += queryString;\n\n        // If there's no ID we need to wait for one before trying to init socket.\n        http.open('get', url, true);\n        http.onerror = function(e) {\n            util.error('Error retrieving ID', e);\n            var pathError = '';\n            if (self.options.path === '/' && self.options.host !== util.CLOUD_HOST) {\n                pathError = ' If you passed in a `path` to your self-hosted PeerServer, ' +\n                    'you\\'ll also need to pass in that same path when creating a new ' +\n                    'Peer.';\n            }\n            self._abort('server-error', 'Could not get an ID from the server.' + pathError);\n        };\n        http.onreadystatechange = function() {\n            if (http.readyState !== 4) {\n                return;\n            }\n            if (http.status !== 200) {\n                http.onerror();\n                return;\n            }\n            self._initialize(http.responseText);\n        };\n        http.send(null);\n    };\n\n    /** Initialize a connection with the server. */\n    Peer.prototype._initialize = function(id) {\n        this.id = id;\n        this.socket.start(this.id, this.options.token);\n    };\n\n    /** Handles messages from the server. */\n    Peer.prototype._handleMessage = function(message) {\n        var type = message.type;\n        var payload = message.payload;\n        var peer = message.src;\n        var connection;\n\n        switch (type) {\n            case 'OPEN': // The connection to the server is open.\n                this.emit('open', this.id);\n                this.open = true;\n                break;\n            case 'ERROR': // Server error.\n                this._abort('server-error', payload.msg);\n                break;\n            case 'ID-TAKEN': // The selected ID is taken.\n                this._abort('unavailable-id', 'ID `' + this.id + '` is taken');\n                break;\n            case 'INVALID-KEY': // The given API key cannot be found.\n                this._abort('invalid-key', 'API KEY \"' + this.options.key + '\" is invalid');\n                break;\n\n            //\n            case 'LEAVE': // Another peer has closed its connection to this peer.\n                util.log('Received leave message from', peer);\n                this._cleanupPeer(peer);\n                break;\n\n            case 'EXPIRE': // The offer sent to a peer has expired without response.\n                this.emitError('peer-unavailable', 'Could not connect to peer ' + peer);\n                break;\n            case 'OFFER': // we should consider switching this to CALL/CONNECT, but this is the least breaking option.\n                var connectionId = payload.connectionId;\n                connection = this.getConnection(peer, connectionId);\n\n                if (connection) {\n                    util.warn('Offer received for existing Connection ID:', connectionId);\n                    //connection.handleMessage(message);\n                } else {\n                    // Create a new connection.\n                    if (payload.type === 'media') {\n                        connection = new MediaConnection(peer, this, {\n                            connectionId: connectionId,\n                            _payload: payload,\n                            metadata: payload.metadata\n                        });\n                        this._addConnection(peer, connection);\n                        this.emit('call', connection);\n                    } else if (payload.type === 'data') {\n                        connection = new DataConnection(peer, this, {\n                            connectionId: connectionId,\n                            _payload: payload,\n                            metadata: payload.metadata,\n                            label: payload.label,\n                            serialization: payload.serialization,\n                            reliable: payload.reliable\n                        });\n                        this._addConnection(peer, connection);\n                        this.emit('connection', connection);\n                    } else {\n                        util.warn('Received malformed connection type:', payload.type);\n                        return;\n                    }\n                    // Find messages.\n                    var messages = this._getMessages(connectionId);\n                    for (var i = 0, ii = messages.length; i < ii; i += 1) {\n                        connection.handleMessage(messages[i]);\n                    }\n                }\n                break;\n            default:\n                if (!payload) {\n                    util.warn('You received a malformed message from ' + peer + ' of type ' + type);\n                    return;\n                }\n\n                var id = payload.connectionId;\n                connection = this.getConnection(peer, id);\n\n                if (connection && connection.pc) {\n                    // Pass it on.\n                    connection.handleMessage(message);\n                } else if (id) {\n                    // Store for possible later use\n                    this._storeMessage(id, message);\n                } else {\n                    util.warn('You received an unrecognized message:', message);\n                }\n                break;\n        }\n    };\n\n    /** Stores messages without a set up connection, to be claimed later. */\n    Peer.prototype._storeMessage = function(connectionId, message) {\n        if (!this._lostMessages[connectionId]) {\n            this._lostMessages[connectionId] = [];\n        }\n        this._lostMessages[connectionId].push(message);\n    };\n\n    /** Retrieve messages from lost message store */\n    Peer.prototype._getMessages = function(connectionId) {\n        var messages = this._lostMessages[connectionId];\n        if (messages) {\n            delete this._lostMessages[connectionId];\n            return messages;\n        } else {\n            return [];\n        }\n    };\n\n    /**\n     * Returns a DataConnection to the specified peer. See documentation for a\n     * complete list of options.\n     */\n    Peer.prototype.connect = function(peer, options) {\n        if (this.disconnected) {\n            util.warn('You cannot connect to a new Peer because you called ' +\n                '.disconnect() on this Peer and ended your connection with the ' +\n                'server. You can create a new Peer to reconnect, or call reconnect ' +\n                'on this peer if you believe its ID to still be available.');\n            this.emitError('disconnected', 'Cannot connect to new Peer after disconnecting from server.');\n            return;\n        }\n        var connection = new DataConnection(peer, this, options);\n        this._addConnection(peer, connection);\n        return connection;\n    };\n\n    /**\n     * Returns a MediaConnection to the specified peer. See documentation for a\n     * complete list of options.\n     */\n    Peer.prototype.call = function(peer, stream, options) {\n        if (this.disconnected) {\n            util.warn('You cannot connect to a new Peer because you called ' +\n                '.disconnect() on this Peer and ended your connection with the ' +\n                'server. You can create a new Peer to reconnect.');\n            this.emitError('disconnected', 'Cannot connect to new Peer after disconnecting from server.');\n            return;\n        }\n        if (!stream) {\n            util.error('To call a peer, you must provide a stream from your browser\\'s `getUserMedia`.');\n            return;\n        }\n        options = options || {};\n        options._stream = stream;\n        var call = new MediaConnection(peer, this, options);\n        this._addConnection(peer, call);\n        return call;\n    };\n\n    /** Add a data/media connection to this peer. */\n    Peer.prototype._addConnection = function(peer, connection) {\n        if (!this.connections[peer]) {\n            this.connections[peer] = [];\n        }\n        this.connections[peer].push(connection);\n    };\n\n    /** Retrieve a data/media connection for this peer. */\n    Peer.prototype.getConnection = function(peer, id) {\n        var connections = this.connections[peer];\n        if (!connections) {\n            return null;\n        }\n        for (var i = 0, ii = connections.length; i < ii; i++) {\n            if (connections[i].id === id) {\n                return connections[i];\n            }\n        }\n        return null;\n    };\n\n    Peer.prototype._delayedAbort = function(type, message) {\n        var self = this;\n        util.setZeroTimeout(function(){\n            self._abort(type, message);\n        });\n    };\n\n    /**\n     * Destroys the Peer and emits an error message.\n     * The Peer is not destroyed if it's in a disconnected state, in which case\n     * it retains its disconnected state and its existing connections.\n     */\n    Peer.prototype._abort = function(type, message) {\n        util.error('Aborting!');\n        if (!this._lastServerId) {\n            this.destroy();\n        } else {\n            this.disconnect();\n        }\n        this.emitError(type, message);\n    };\n\n    /** Emits a typed error message. */\n    Peer.prototype.emitError = function(type, err) {\n        util.error('Error:', err);\n        if (typeof err === 'string') {\n            err = new Error(err);\n        }\n        err.type = type;\n        this.emit('error', err);\n    };\n\n    /**\n     * Destroys the Peer: closes all active connections as well as the connection\n     *  to the server.\n     * Warning: The peer can no longer create or accept connections after being\n     *  destroyed.\n     */\n    Peer.prototype.destroy = function() {\n        if (!this.destroyed) {\n            this._cleanup();\n            this.disconnect();\n            this.destroyed = true;\n        }\n    };\n\n\n    /** Disconnects every connection on this peer. */\n    Peer.prototype._cleanup = function() {\n        if (this.connections) {\n            var peers = Object.keys(this.connections);\n            for (var i = 0, ii = peers.length; i < ii; i++) {\n                this._cleanupPeer(peers[i]);\n            }\n        }\n        this.emit('close');\n    };\n\n    /** Closes all connections to this peer. */\n    Peer.prototype._cleanupPeer = function(peer) {\n        var connections = this.connections[peer];\n        for (var j = 0, jj = connections.length; j < jj; j += 1) {\n            connections[j].close();\n        }\n    };\n\n    /**\n     * Disconnects the Peer's connection to the PeerServer. Does not close any\n     *  active connections.\n     * Warning: The peer can no longer create or accept connections after being\n     *  disconnected. It also cannot reconnect to the server.\n     */\n    Peer.prototype.disconnect = function() {\n        var self = this;\n        util.setZeroTimeout(function(){\n            if (!self.disconnected) {\n                self.disconnected = true;\n                self.open = false;\n                if (self.socket) {\n                    self.socket.close();\n                }\n                self.emit('disconnected', self.id);\n                self._lastServerId = self.id;\n                self.id = null;\n            }\n        });\n    };\n\n    /** Attempts to reconnect with the same ID. */\n    Peer.prototype.reconnect = function() {\n        if (this.disconnected && !this.destroyed) {\n            util.log('Attempting reconnection to server with ID ' + this._lastServerId);\n            this.disconnected = false;\n            this._initializeServerConnection();\n            this._initialize(this._lastServerId);\n        } else if (this.destroyed) {\n            throw new Error('This peer cannot reconnect to the server. It has already been destroyed.');\n        } else if (!this.disconnected && !this.open) {\n            // Do nothing. We're still connecting the first time.\n            util.error('In a hurry? We\\'re still trying to make the initial connection!');\n        } else {\n            throw new Error('Peer ' + this.id + ' cannot reconnect because it is not disconnected from the server!');\n        }\n    };\n\n    /**\n     * Get a list of available peer IDs. If you're running your own server, you'll\n     * want to set allow_discovery: true in the PeerServer options. If you're using\n     * the cloud server, email team@peerjs.com to get the functionality enabled for\n     * your key.\n     */\n    Peer.prototype.listAllPeers = function(cb) {\n        cb = cb || function() {};\n        var self = this;\n        var http = new XMLHttpRequest();\n        var protocol = this.options.secure ? 'https://' : 'http://';\n        var url = protocol + this.options.host + ':' + this.options.port +\n            this.options.path + this.options.key + '/peers';\n        var queryString = '?ts=' + new Date().getTime() + '' + Math.random();\n        url += queryString;\n\n        // If there's no ID we need to wait for one before trying to init socket.\n        http.open('get', url, true);\n        http.onerror = function(e) {\n            self._abort('server-error', 'Could not get peers from the server.');\n            cb([]);\n        };\n        http.onreadystatechange = function() {\n            if (http.readyState !== 4) {\n                return;\n            }\n            if (http.status === 401) {\n                var helpfulError = '';\n                if (self.options.host !== util.CLOUD_HOST) {\n                    helpfulError = 'It looks like you\\'re using the cloud server. You can email ' +\n                        'team@peerjs.com to enable peer listing for your API key.';\n                } else {\n                    helpfulError = 'You need to enable `allow_discovery` on your self-hosted ' +\n                        'PeerServer to use this feature.';\n                }\n                cb([]);\n                throw new Error('It doesn\\'t look like you have permission to list peers IDs. ' + helpfulError);\n            } else if (http.status !== 200) {\n                cb([]);\n            } else {\n                cb(JSON.parse(http.responseText));\n            }\n        };\n        http.send(null);\n    };\n\n    module.exports = Peer;\n\n},{\"./dataconnection\":2,\"./mediaconnection\":4,\"./socket\":7,\"./util\":8,\"eventemitter3\":9}],7:[function(require,module,exports){\n    var util = require('./util');\n    var EventEmitter = require('eventemitter3');\n\n    /**\n     * An abstraction on top of WebSockets and XHR streaming to provide fastest\n     * possible connection for peers.\n     */\n    function Socket(secure, host, port, path, key) {\n        if (!(this instanceof Socket)) return new Socket(secure, host, port, path, key);\n\n        EventEmitter.call(this);\n\n        // Disconnected manually.\n        this.disconnected = false;\n        this._queue = [];\n\n        var httpProtocol = secure ? 'https://' : 'http://';\n        var wsProtocol = secure ? 'wss://' : 'ws://';\n        this._httpUrl = httpProtocol + host + ':' + port + path + key;\n        this._wsUrl = wsProtocol + host + ':' + port + path + 'peerjs?key=' + key;\n    }\n\n    util.inherits(Socket, EventEmitter);\n\n\n    /** Check in with ID or get one from server. */\n    Socket.prototype.start = function(id, token) {\n        this.id = id;\n\n        this._httpUrl += '/' + id + '/' + token;\n        this._wsUrl += '&id=' + id + '&token=' + token;\n\n        this._startXhrStream();\n        this._startWebSocket();\n    }\n\n\n    /** Start up websocket communications. */\n    Socket.prototype._startWebSocket = function(id) {\n        var self = this;\n\n        if (this._socket) {\n            return;\n        }\n\n        this._socket = new WebSocket(this._wsUrl);\n\n        this._socket.onmessage = function(event) {\n            try {\n                var data = JSON.parse(event.data);\n            } catch(e) {\n                util.log('Invalid server message', event.data);\n                return;\n            }\n            self.emit('message', data);\n        };\n\n        this._socket.onclose = function(event) {\n            util.log('Socket closed.');\n            self.disconnected = true;\n            self.emit('disconnected');\n        };\n\n        // Take care of the queue of connections if necessary and make sure Peer knows\n        // socket is open.\n        this._socket.onopen = function() {\n            if (self._timeout) {\n                clearTimeout(self._timeout);\n                setTimeout(function(){\n                    self._http.abort();\n                    self._http = null;\n                }, 5000);\n            }\n            self._sendQueuedMessages();\n            util.log('Socket open');\n        };\n    }\n\n    /** Start XHR streaming. */\n    Socket.prototype._startXhrStream = function(n) {\n        try {\n            var self = this;\n            this._http = new XMLHttpRequest();\n            this._http._index = 1;\n            this._http._streamIndex = n || 0;\n            this._http.open('post', this._httpUrl + '/id?i=' + this._http._streamIndex, true);\n            this._http.onerror = function() {\n                // If we get an error, likely something went wrong.\n                // Stop streaming.\n                clearTimeout(self._timeout);\n                self.emit('disconnected');\n            }\n            this._http.onreadystatechange = function() {\n                if (this.readyState == 2 && this.old) {\n                    this.old.abort();\n                    delete this.old;\n                } else if (this.readyState > 2 && this.status === 200 && this.responseText) {\n                    self._handleStream(this);\n                }\n            };\n            this._http.send(null);\n            this._setHTTPTimeout();\n        } catch(e) {\n            util.log('XMLHttpRequest not available; defaulting to WebSockets');\n        }\n    }\n\n\n    /** Handles onreadystatechange response as a stream. */\n    Socket.prototype._handleStream = function(http) {\n        // 3 and 4 are loading/done state. All others are not relevant.\n        var messages = http.responseText.split('\\n');\n\n        // Check to see if anything needs to be processed on buffer.\n        if (http._buffer) {\n            while (http._buffer.length > 0) {\n                var index = http._buffer.shift();\n                var bufferedMessage = messages[index];\n                try {\n                    bufferedMessage = JSON.parse(bufferedMessage);\n                } catch(e) {\n                    http._buffer.shift(index);\n                    break;\n                }\n                this.emit('message', bufferedMessage);\n            }\n        }\n\n        var message = messages[http._index];\n        if (message) {\n            http._index += 1;\n            // Buffering--this message is incomplete and we'll get to it next time.\n            // This checks if the httpResponse ended in a `\\n`, in which case the last\n            // element of messages should be the empty string.\n            if (http._index === messages.length) {\n                if (!http._buffer) {\n                    http._buffer = [];\n                }\n                http._buffer.push(http._index - 1);\n            } else {\n                try {\n                    message = JSON.parse(message);\n                } catch(e) {\n                    util.log('Invalid server message', message);\n                    return;\n                }\n                this.emit('message', message);\n            }\n        }\n    }\n\n    Socket.prototype._setHTTPTimeout = function() {\n        var self = this;\n        this._timeout = setTimeout(function() {\n            var old = self._http;\n            if (!self._wsOpen()) {\n                self._startXhrStream(old._streamIndex + 1);\n                self._http.old = old;\n            } else {\n                old.abort();\n            }\n        }, 25000);\n    }\n\n    /** Is the websocket currently open? */\n    Socket.prototype._wsOpen = function() {\n        return this._socket && this._socket.readyState == 1;\n    }\n\n    /** Send queued messages. */\n    Socket.prototype._sendQueuedMessages = function() {\n        for (var i = 0, ii = this._queue.length; i < ii; i += 1) {\n            this.send(this._queue[i]);\n        }\n    }\n\n    /** Exposed send for DC & Peer. */\n    Socket.prototype.send = function(data) {\n        if (this.disconnected) {\n            return;\n        }\n\n        // If we didn't get an ID yet, we can't yet send anything so we should queue\n        // up these messages.\n        if (!this.id) {\n            this._queue.push(data);\n            return;\n        }\n\n        if (!data.type) {\n            this.emit('error', 'Invalid message');\n            return;\n        }\n\n        var message = JSON.stringify(data);\n        if (this._wsOpen()) {\n            this._socket.send(message);\n        } else {\n            var http = new XMLHttpRequest();\n            var url = this._httpUrl + '/' + data.type.toLowerCase();\n            http.open('post', url, true);\n            http.setRequestHeader('Content-Type', 'application/json');\n            http.send(message);\n        }\n    }\n\n    Socket.prototype.close = function() {\n        if (!this.disconnected && this._wsOpen()) {\n            this._socket.close();\n            this.disconnected = true;\n        }\n    }\n\n    module.exports = Socket;\n\n},{\"./util\":8,\"eventemitter3\":9}],8:[function(require,module,exports){\n    var defaultConfig = {'iceServers': [{ 'url': 'stun:stun.l.google.com:19302' }]};\n    var dataCount = 1;\n\n    var BinaryPack = require('js-binarypack');\n    var RTCPeerConnection = require('./adapter').RTCPeerConnection;\n\n    var util = {\n        noop: function() {},\n\n        CLOUD_HOST: '0.peerjs.com',\n        CLOUD_PORT: 9000,\n\n        // Browsers that need chunking:\n        chunkedBrowsers: {'Chrome': 1},\n        chunkedMTU: 16300, // The original 60000 bytes setting does not work when sending data from Firefox to Chrome, which is \"cut off\" after 16384 bytes and delivered individually.\n\n        // Logging logic\n        logLevel: 0,\n        setLogLevel: function(level) {\n            var debugLevel = parseInt(level, 10);\n            if (!isNaN(parseInt(level, 10))) {\n                util.logLevel = debugLevel;\n            } else {\n                // If they are using truthy/falsy values for debug\n                util.logLevel = level ? 3 : 0;\n            }\n            util.log = util.warn = util.error = util.noop;\n            if (util.logLevel > 0) {\n                util.error = util._printWith('ERROR');\n            }\n            if (util.logLevel > 1) {\n                util.warn = util._printWith('WARNING');\n            }\n            if (util.logLevel > 2) {\n                util.log = util._print;\n            }\n        },\n        setLogFunction: function(fn) {\n            if (fn.constructor !== Function) {\n                util.warn('The log function you passed in is not a function. Defaulting to regular logs.');\n            } else {\n                util._print = fn;\n            }\n        },\n\n        _printWith: function(prefix) {\n            return function() {\n                var copy = Array.prototype.slice.call(arguments);\n                copy.unshift(prefix);\n                util._print.apply(util, copy);\n            };\n        },\n        _print: function () {\n            var err = false;\n            var copy = Array.prototype.slice.call(arguments);\n            copy.unshift('PeerJS: ');\n            for (var i = 0, l = copy.length; i < l; i++){\n                if (copy[i] instanceof Error) {\n                    copy[i] = '(' + copy[i].name + ') ' + copy[i].message;\n                    err = true;\n                }\n            }\n            err ? console.error.apply(console, copy) : console.log.apply(console, copy);\n        },\n        //\n\n        // Returns browser-agnostic default config\n        defaultConfig: defaultConfig,\n        //\n\n        // Returns the current browser.\n        browser: (function() {\n            if (window.mozRTCPeerConnection) {\n                return 'Firefox';\n            } else if (window.webkitRTCPeerConnection) {\n                return 'Chrome';\n            } else if (window.RTCPeerConnection) {\n                return 'Supported';\n            } else {\n                return 'Unsupported';\n            }\n        })(),\n        //\n\n        // Lists which features are supported\n        supports: (function() {\n            if (typeof RTCPeerConnection === 'undefined') {\n                return {};\n            }\n\n            var data = true;\n            var audioVideo = true;\n\n            var binaryBlob = false;\n            var sctp = false;\n            var onnegotiationneeded = !!window.webkitRTCPeerConnection;\n\n            var pc, dc;\n            try {\n                pc = new RTCPeerConnection(defaultConfig, {optional: [{RtpDataChannels: true}]});\n            } catch (e) {\n                data = false;\n                audioVideo = false;\n            }\n\n            if (data) {\n                try {\n                    dc = pc.createDataChannel('_PEERJSTEST');\n                } catch (e) {\n                    data = false;\n                }\n            }\n\n            if (data) {\n                // Binary test\n                try {\n                    dc.binaryType = 'blob';\n                    binaryBlob = true;\n                } catch (e) {\n                }\n\n                // Reliable test.\n                // Unfortunately Chrome is a bit unreliable about whether or not they\n                // support reliable.\n                var reliablePC = new RTCPeerConnection(defaultConfig, {});\n                try {\n                    var reliableDC = reliablePC.createDataChannel('_PEERJSRELIABLETEST', {});\n                    sctp = reliableDC.reliable;\n                } catch (e) {\n                }\n                reliablePC.close();\n            }\n\n            // FIXME: not really the best check...\n            if (audioVideo) {\n                audioVideo = !!pc.addStream;\n            }\n\n            // FIXME: this is not great because in theory it doesn't work for\n            // av-only browsers (?).\n            if (!onnegotiationneeded && data) {\n                // sync default check.\n                var negotiationPC = new RTCPeerConnection(defaultConfig, {optional: [{RtpDataChannels: true}]});\n                negotiationPC.onnegotiationneeded = function() {\n                    onnegotiationneeded = true;\n                    // async check.\n                    if (util && util.supports) {\n                        util.supports.onnegotiationneeded = true;\n                    }\n                };\n                negotiationPC.createDataChannel('_PEERJSNEGOTIATIONTEST');\n\n                setTimeout(function() {\n                    negotiationPC.close();\n                }, 1000);\n            }\n\n            if (pc) {\n                pc.close();\n            }\n\n            return {\n                audioVideo: audioVideo,\n                data: data,\n                binaryBlob: binaryBlob,\n                binary: sctp, // deprecated; sctp implies binary support.\n                reliable: sctp, // deprecated; sctp implies reliable data.\n                sctp: sctp,\n                onnegotiationneeded: onnegotiationneeded\n            };\n        }()),\n        //\n\n        // Ensure alphanumeric ids\n        validateId: function(id) {\n            // Allow empty ids\n            return !id || /^[A-Za-z0-9_-]+(?:[ _-][A-Za-z0-9]+)*$/.exec(id);\n        },\n\n        validateKey: function(key) {\n            // Allow empty keys\n            return !key || /^[A-Za-z0-9_-]+(?:[ _-][A-Za-z0-9]+)*$/.exec(key);\n        },\n\n\n        debug: false,\n\n        inherits: function(ctor, superCtor) {\n            ctor.super_ = superCtor;\n            ctor.prototype = Object.create(superCtor.prototype, {\n                constructor: {\n                    value: ctor,\n                    enumerable: false,\n                    writable: true,\n                    configurable: true\n                }\n            });\n        },\n        extend: function(dest, source) {\n            for(var key in source) {\n                if(source.hasOwnProperty(key)) {\n                    dest[key] = source[key];\n                }\n            }\n            return dest;\n        },\n        pack: BinaryPack.pack,\n        unpack: BinaryPack.unpack,\n\n        log: function () {\n            if (util.debug) {\n                var err = false;\n                var copy = Array.prototype.slice.call(arguments);\n                copy.unshift('PeerJS: ');\n                for (var i = 0, l = copy.length; i < l; i++){\n                    if (copy[i] instanceof Error) {\n                        copy[i] = '(' + copy[i].name + ') ' + copy[i].message;\n                        err = true;\n                    }\n                }\n                err ? console.error.apply(console, copy) : console.log.apply(console, copy);\n            }\n        },\n\n        setZeroTimeout: (function(global) {\n            var timeouts = [];\n            var messageName = 'zero-timeout-message';\n\n            // Like setTimeout, but only takes a function argument.\t There's\n            // no time argument (always zero) and no arguments (you have to\n            // use a closure).\n            function setZeroTimeoutPostMessage(fn) {\n                timeouts.push(fn);\n                global.postMessage(messageName, '*');\n            }\n\n            function handleMessage(event) {\n                if (event.source == global && event.data == messageName) {\n                    if (event.stopPropagation) {\n                        event.stopPropagation();\n                    }\n                    if (timeouts.length) {\n                        timeouts.shift()();\n                    }\n                }\n            }\n            if (global.addEventListener) {\n                global.addEventListener('message', handleMessage, true);\n            } else if (global.attachEvent) {\n                global.attachEvent('onmessage', handleMessage);\n            }\n            return setZeroTimeoutPostMessage;\n        }(window)),\n\n        // Binary stuff\n\n        // chunks a blob.\n        chunk: function(bl) {\n            var chunks = [];\n            var size = bl.size;\n            var start = index = 0;\n            var total = Math.ceil(size / util.chunkedMTU);\n            while (start < size) {\n                var end = Math.min(size, start + util.chunkedMTU);\n                var b = bl.slice(start, end);\n\n                var chunk = {\n                    __peerData: dataCount,\n                    n: index,\n                    data: b,\n                    total: total\n                };\n\n                chunks.push(chunk);\n\n                start = end;\n                index += 1;\n            }\n            dataCount += 1;\n            return chunks;\n        },\n\n        blobToArrayBuffer: function(blob, cb){\n            var fr = new FileReader();\n            fr.onload = function(evt) {\n                cb(evt.target.result);\n            };\n            fr.readAsArrayBuffer(blob);\n        },\n        blobToBinaryString: function(blob, cb){\n            var fr = new FileReader();\n            fr.onload = function(evt) {\n                cb(evt.target.result);\n            };\n            fr.readAsBinaryString(blob);\n        },\n        binaryStringToArrayBuffer: function(binary) {\n            var byteArray = new Uint8Array(binary.length);\n            for (var i = 0; i < binary.length; i++) {\n                byteArray[i] = binary.charCodeAt(i) & 0xff;\n            }\n            return byteArray.buffer;\n        },\n        randomToken: function () {\n            return Math.random().toString(36).substr(2);\n        },\n        //\n\n        isSecure: function() {\n            return location.protocol === 'https:';\n        }\n    };\n\n    module.exports = util;\n\n},{\"./adapter\":1,\"js-binarypack\":10}],9:[function(require,module,exports){\n    'use strict';\n\n    /**\n     * Representation of a single EventEmitter function.\n     *\n     * @param {Function} fn Event handler to be called.\n     * @param {Mixed} context Context for function execution.\n     * @param {Boolean} once Only emit once\n     * @api private\n     */\n    function EE(fn, context, once) {\n        this.fn = fn;\n        this.context = context;\n        this.once = once || false;\n    }\n\n    /**\n     * Minimal EventEmitter interface that is molded against the Node.js\n     * EventEmitter interface.\n     *\n     * @constructor\n     * @api public\n     */\n    function EventEmitter() { /* Nothing to set */ }\n\n    /**\n     * Holds the assigned EventEmitters by name.\n     *\n     * @type {Object}\n     * @private\n     */\n    EventEmitter.prototype._events = undefined;\n\n    /**\n     * Return a list of assigned event listeners.\n     *\n     * @param {String} event The events that should be listed.\n     * @returns {Array}\n     * @api public\n     */\n    EventEmitter.prototype.listeners = function listeners(event) {\n        if (!this._events || !this._events[event]) return [];\n\n        for (var i = 0, l = this._events[event].length, ee = []; i < l; i++) {\n            ee.push(this._events[event][i].fn);\n        }\n\n        return ee;\n    };\n\n    /**\n     * Emit an event to all registered event listeners.\n     *\n     * @param {String} event The name of the event.\n     * @returns {Boolean} Indication if we've emitted an event.\n     * @api public\n     */\n    EventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n        if (!this._events || !this._events[event]) return false;\n\n        var listeners = this._events[event]\n            , length = listeners.length\n            , len = arguments.length\n            , ee = listeners[0]\n            , args\n            , i, j;\n\n        if (1 === length) {\n            if (ee.once) this.removeListener(event, ee.fn, true);\n\n            switch (len) {\n                case 1: return ee.fn.call(ee.context), true;\n                case 2: return ee.fn.call(ee.context, a1), true;\n                case 3: return ee.fn.call(ee.context, a1, a2), true;\n                case 4: return ee.fn.call(ee.context, a1, a2, a3), true;\n                case 5: return ee.fn.call(ee.context, a1, a2, a3, a4), true;\n                case 6: return ee.fn.call(ee.context, a1, a2, a3, a4, a5), true;\n            }\n\n            for (i = 1, args = new Array(len -1); i < len; i++) {\n                args[i - 1] = arguments[i];\n            }\n\n            ee.fn.apply(ee.context, args);\n        } else {\n            for (i = 0; i < length; i++) {\n                if (listeners[i].once) this.removeListener(event, listeners[i].fn, true);\n\n                switch (len) {\n                    case 1: listeners[i].fn.call(listeners[i].context); break;\n                    case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n                    case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n                    default:\n                        if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n                            args[j - 1] = arguments[j];\n                        }\n\n                        listeners[i].fn.apply(listeners[i].context, args);\n                }\n            }\n        }\n\n        return true;\n    };\n\n    /**\n     * Register a new EventListener for the given event.\n     *\n     * @param {String} event Name of the event.\n     * @param {Functon} fn Callback function.\n     * @param {Mixed} context The context of the function.\n     * @api public\n     */\n    EventEmitter.prototype.on = function on(event, fn, context) {\n        if (!this._events) this._events = {};\n        if (!this._events[event]) this._events[event] = [];\n        this._events[event].push(new EE( fn, context || this ));\n\n        return this;\n    };\n\n    /**\n     * Add an EventListener that's only called once.\n     *\n     * @param {String} event Name of the event.\n     * @param {Function} fn Callback function.\n     * @param {Mixed} context The context of the function.\n     * @api public\n     */\n    EventEmitter.prototype.once = function once(event, fn, context) {\n        if (!this._events) this._events = {};\n        if (!this._events[event]) this._events[event] = [];\n        this._events[event].push(new EE(fn, context || this, true ));\n\n        return this;\n    };\n\n    /**\n     * Remove event listeners.\n     *\n     * @param {String} event The event we want to remove.\n     * @param {Function} fn The listener that we need to find.\n     * @param {Boolean} once Only remove once listeners.\n     * @api public\n     */\n    EventEmitter.prototype.removeListener = function removeListener(event, fn, once) {\n        if (!this._events || !this._events[event]) return this;\n\n        var listeners = this._events[event]\n            , events = [];\n\n        if (fn) for (var i = 0, length = listeners.length; i < length; i++) {\n            if (listeners[i].fn !== fn && listeners[i].once !== once) {\n                events.push(listeners[i]);\n            }\n        }\n\n        //\n        // Reset the array, or remove it completely if we have no more listeners.\n        //\n        if (events.length) this._events[event] = events;\n        else this._events[event] = null;\n\n        return this;\n    };\n\n    /**\n     * Remove all listeners or only the listeners for the specified event.\n     *\n     * @param {String} event The event want to remove all listeners for.\n     * @api public\n     */\n    EventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n        if (!this._events) return this;\n\n        if (event) this._events[event] = null;\n        else this._events = {};\n\n        return this;\n    };\n\n//\n// Alias methods names because people roll like that.\n//\n    EventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n    EventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// This function doesn't apply anymore.\n//\n    EventEmitter.prototype.setMaxListeners = function setMaxListeners() {\n        return this;\n    };\n\n//\n// Expose the module.\n//\n    EventEmitter.EventEmitter = EventEmitter;\n    EventEmitter.EventEmitter2 = EventEmitter;\n    EventEmitter.EventEmitter3 = EventEmitter;\n\n    if ('object' === typeof module && module.exports) {\n        module.exports = EventEmitter;\n    }\n\n},{}],10:[function(require,module,exports){\n    var BufferBuilder = require('./bufferbuilder').BufferBuilder;\n    var binaryFeatures = require('./bufferbuilder').binaryFeatures;\n\n    var BinaryPack = {\n        unpack: function(data){\n            var unpacker = new Unpacker(data);\n            return unpacker.unpack();\n        },\n        pack: function(data){\n            var packer = new Packer();\n            packer.pack(data);\n            var buffer = packer.getBuffer();\n            return buffer;\n        }\n    };\n\n    module.exports = BinaryPack;\n\n    function Unpacker (data){\n        // Data is ArrayBuffer\n        this.index = 0;\n        this.dataBuffer = data;\n        this.dataView = new Uint8Array(this.dataBuffer);\n        this.length = this.dataBuffer.byteLength;\n    }\n\n    Unpacker.prototype.unpack = function(){\n        var type = this.unpack_uint8();\n        if (type < 0x80){\n            var positive_fixnum = type;\n            return positive_fixnum;\n        } else if ((type ^ 0xe0) < 0x20){\n            var negative_fixnum = (type ^ 0xe0) - 0x20;\n            return negative_fixnum;\n        }\n        var size;\n        if ((size = type ^ 0xa0) <= 0x0f){\n            return this.unpack_raw(size);\n        } else if ((size = type ^ 0xb0) <= 0x0f){\n            return this.unpack_string(size);\n        } else if ((size = type ^ 0x90) <= 0x0f){\n            return this.unpack_array(size);\n        } else if ((size = type ^ 0x80) <= 0x0f){\n            return this.unpack_map(size);\n        }\n        switch(type){\n            case 0xc0:\n                return null;\n            case 0xc1:\n                return undefined;\n            case 0xc2:\n                return false;\n            case 0xc3:\n                return true;\n            case 0xca:\n                return this.unpack_float();\n            case 0xcb:\n                return this.unpack_double();\n            case 0xcc:\n                return this.unpack_uint8();\n            case 0xcd:\n                return this.unpack_uint16();\n            case 0xce:\n                return this.unpack_uint32();\n            case 0xcf:\n                return this.unpack_uint64();\n            case 0xd0:\n                return this.unpack_int8();\n            case 0xd1:\n                return this.unpack_int16();\n            case 0xd2:\n                return this.unpack_int32();\n            case 0xd3:\n                return this.unpack_int64();\n            case 0xd4:\n                return undefined;\n            case 0xd5:\n                return undefined;\n            case 0xd6:\n                return undefined;\n            case 0xd7:\n                return undefined;\n            case 0xd8:\n                size = this.unpack_uint16();\n                return this.unpack_string(size);\n            case 0xd9:\n                size = this.unpack_uint32();\n                return this.unpack_string(size);\n            case 0xda:\n                size = this.unpack_uint16();\n                return this.unpack_raw(size);\n            case 0xdb:\n                size = this.unpack_uint32();\n                return this.unpack_raw(size);\n            case 0xdc:\n                size = this.unpack_uint16();\n                return this.unpack_array(size);\n            case 0xdd:\n                size = this.unpack_uint32();\n                return this.unpack_array(size);\n            case 0xde:\n                size = this.unpack_uint16();\n                return this.unpack_map(size);\n            case 0xdf:\n                size = this.unpack_uint32();\n                return this.unpack_map(size);\n        }\n    }\n\n    Unpacker.prototype.unpack_uint8 = function(){\n        var byte = this.dataView[this.index] & 0xff;\n        this.index++;\n        return byte;\n    };\n\n    Unpacker.prototype.unpack_uint16 = function(){\n        var bytes = this.read(2);\n        var uint16 =\n            ((bytes[0] & 0xff) * 256) + (bytes[1] & 0xff);\n        this.index += 2;\n        return uint16;\n    }\n\n    Unpacker.prototype.unpack_uint32 = function(){\n        var bytes = this.read(4);\n        var uint32 =\n            ((bytes[0]  * 256 +\n                bytes[1]) * 256 +\n                bytes[2]) * 256 +\n            bytes[3];\n        this.index += 4;\n        return uint32;\n    }\n\n    Unpacker.prototype.unpack_uint64 = function(){\n        var bytes = this.read(8);\n        var uint64 =\n            ((((((bytes[0]  * 256 +\n                bytes[1]) * 256 +\n                bytes[2]) * 256 +\n                bytes[3]) * 256 +\n                bytes[4]) * 256 +\n                bytes[5]) * 256 +\n                bytes[6]) * 256 +\n            bytes[7];\n        this.index += 8;\n        return uint64;\n    }\n\n\n    Unpacker.prototype.unpack_int8 = function(){\n        var uint8 = this.unpack_uint8();\n        return (uint8 < 0x80 ) ? uint8 : uint8 - (1 << 8);\n    };\n\n    Unpacker.prototype.unpack_int16 = function(){\n        var uint16 = this.unpack_uint16();\n        return (uint16 < 0x8000 ) ? uint16 : uint16 - (1 << 16);\n    }\n\n    Unpacker.prototype.unpack_int32 = function(){\n        var uint32 = this.unpack_uint32();\n        return (uint32 < Math.pow(2, 31) ) ? uint32 :\n            uint32 - Math.pow(2, 32);\n    }\n\n    Unpacker.prototype.unpack_int64 = function(){\n        var uint64 = this.unpack_uint64();\n        return (uint64 < Math.pow(2, 63) ) ? uint64 :\n            uint64 - Math.pow(2, 64);\n    }\n\n    Unpacker.prototype.unpack_raw = function(size){\n        if ( this.length < this.index + size){\n            throw new Error('BinaryPackFailure: index is out of range'\n                + ' ' + this.index + ' ' + size + ' ' + this.length);\n        }\n        var buf = this.dataBuffer.slice(this.index, this.index + size);\n        this.index += size;\n\n        //buf = util.bufferToString(buf);\n\n        return buf;\n    }\n\n    Unpacker.prototype.unpack_string = function(size){\n        var bytes = this.read(size);\n        var i = 0, str = '', c, code;\n        while(i < size){\n            c = bytes[i];\n            if ( c < 128){\n                str += String.fromCharCode(c);\n                i++;\n            } else if ((c ^ 0xc0) < 32){\n                code = ((c ^ 0xc0) << 6) | (bytes[i+1] & 63);\n                str += String.fromCharCode(code);\n                i += 2;\n            } else {\n                code = ((c & 15) << 12) | ((bytes[i+1] & 63) << 6) |\n                    (bytes[i+2] & 63);\n                str += String.fromCharCode(code);\n                i += 3;\n            }\n        }\n        this.index += size;\n        return str;\n    }\n\n    Unpacker.prototype.unpack_array = function(size){\n        var objects = new Array(size);\n        for(var i = 0; i < size ; i++){\n            objects[i] = this.unpack();\n        }\n        return objects;\n    }\n\n    Unpacker.prototype.unpack_map = function(size){\n        var map = {};\n        for(var i = 0; i < size ; i++){\n            var key  = this.unpack();\n            var value = this.unpack();\n            map[key] = value;\n        }\n        return map;\n    }\n\n    Unpacker.prototype.unpack_float = function(){\n        var uint32 = this.unpack_uint32();\n        var sign = uint32 >> 31;\n        var exp  = ((uint32 >> 23) & 0xff) - 127;\n        var fraction = ( uint32 & 0x7fffff ) | 0x800000;\n        return (sign == 0 ? 1 : -1) *\n            fraction * Math.pow(2, exp - 23);\n    }\n\n    Unpacker.prototype.unpack_double = function(){\n        var h32 = this.unpack_uint32();\n        var l32 = this.unpack_uint32();\n        var sign = h32 >> 31;\n        var exp  = ((h32 >> 20) & 0x7ff) - 1023;\n        var hfrac = ( h32 & 0xfffff ) | 0x100000;\n        var frac = hfrac * Math.pow(2, exp - 20) +\n            l32   * Math.pow(2, exp - 52);\n        return (sign == 0 ? 1 : -1) * frac;\n    }\n\n    Unpacker.prototype.read = function(length){\n        var j = this.index;\n        if (j + length <= this.length) {\n            return this.dataView.subarray(j, j + length);\n        } else {\n            throw new Error('BinaryPackFailure: read index out of range');\n        }\n    }\n\n    function Packer(){\n        this.bufferBuilder = new BufferBuilder();\n    }\n\n    Packer.prototype.getBuffer = function(){\n        return this.bufferBuilder.getBuffer();\n    }\n\n    Packer.prototype.pack = function(value){\n        var type = typeof(value);\n        if (type == 'string'){\n            this.pack_string(value);\n        } else if (type == 'number'){\n            if (Math.floor(value) === value){\n                this.pack_integer(value);\n            } else{\n                this.pack_double(value);\n            }\n        } else if (type == 'boolean'){\n            if (value === true){\n                this.bufferBuilder.append(0xc3);\n            } else if (value === false){\n                this.bufferBuilder.append(0xc2);\n            }\n        } else if (type == 'undefined'){\n            this.bufferBuilder.append(0xc0);\n        } else if (type == 'object'){\n            if (value === null){\n                this.bufferBuilder.append(0xc0);\n            } else {\n                var constructor = value.constructor;\n                if (constructor == Array){\n                    this.pack_array(value);\n                } else if (constructor == Blob || constructor == File) {\n                    this.pack_bin(value);\n                } else if (constructor == ArrayBuffer) {\n                    if(binaryFeatures.useArrayBufferView) {\n                        this.pack_bin(new Uint8Array(value));\n                    } else {\n                        this.pack_bin(value);\n                    }\n                } else if ('BYTES_PER_ELEMENT' in value){\n                    if(binaryFeatures.useArrayBufferView) {\n                        this.pack_bin(new Uint8Array(value.buffer));\n                    } else {\n                        this.pack_bin(value.buffer);\n                    }\n                } else if (constructor == Object){\n                    this.pack_object(value);\n                } else if (constructor == Date){\n                    this.pack_string(value.toString());\n                } else if (typeof value.toBinaryPack == 'function'){\n                    this.bufferBuilder.append(value.toBinaryPack());\n                } else {\n                    throw new Error('Type \"' + constructor.toString() + '\" not yet supported');\n                }\n            }\n        } else {\n            throw new Error('Type \"' + type + '\" not yet supported');\n        }\n        this.bufferBuilder.flush();\n    }\n\n\n    Packer.prototype.pack_bin = function(blob){\n        var length = blob.length || blob.byteLength || blob.size;\n        if (length <= 0x0f){\n            this.pack_uint8(0xa0 + length);\n        } else if (length <= 0xffff){\n            this.bufferBuilder.append(0xda) ;\n            this.pack_uint16(length);\n        } else if (length <= 0xffffffff){\n            this.bufferBuilder.append(0xdb);\n            this.pack_uint32(length);\n        } else{\n            throw new Error('Invalid length');\n        }\n        this.bufferBuilder.append(blob);\n    }\n\n    Packer.prototype.pack_string = function(str){\n        var length = utf8Length(str);\n\n        if (length <= 0x0f){\n            this.pack_uint8(0xb0 + length);\n        } else if (length <= 0xffff){\n            this.bufferBuilder.append(0xd8) ;\n            this.pack_uint16(length);\n        } else if (length <= 0xffffffff){\n            this.bufferBuilder.append(0xd9);\n            this.pack_uint32(length);\n        } else{\n            throw new Error('Invalid length');\n        }\n        this.bufferBuilder.append(str);\n    }\n\n    Packer.prototype.pack_array = function(ary){\n        var length = ary.length;\n        if (length <= 0x0f){\n            this.pack_uint8(0x90 + length);\n        } else if (length <= 0xffff){\n            this.bufferBuilder.append(0xdc)\n            this.pack_uint16(length);\n        } else if (length <= 0xffffffff){\n            this.bufferBuilder.append(0xdd);\n            this.pack_uint32(length);\n        } else{\n            throw new Error('Invalid length');\n        }\n        for(var i = 0; i < length ; i++){\n            this.pack(ary[i]);\n        }\n    }\n\n    Packer.prototype.pack_integer = function(num){\n        if ( -0x20 <= num && num <= 0x7f){\n            this.bufferBuilder.append(num & 0xff);\n        } else if (0x00 <= num && num <= 0xff){\n            this.bufferBuilder.append(0xcc);\n            this.pack_uint8(num);\n        } else if (-0x80 <= num && num <= 0x7f){\n            this.bufferBuilder.append(0xd0);\n            this.pack_int8(num);\n        } else if ( 0x0000 <= num && num <= 0xffff){\n            this.bufferBuilder.append(0xcd);\n            this.pack_uint16(num);\n        } else if (-0x8000 <= num && num <= 0x7fff){\n            this.bufferBuilder.append(0xd1);\n            this.pack_int16(num);\n        } else if ( 0x00000000 <= num && num <= 0xffffffff){\n            this.bufferBuilder.append(0xce);\n            this.pack_uint32(num);\n        } else if (-0x80000000 <= num && num <= 0x7fffffff){\n            this.bufferBuilder.append(0xd2);\n            this.pack_int32(num);\n        } else if (-0x8000000000000000 <= num && num <= 0x7FFFFFFFFFFFFFFF){\n            this.bufferBuilder.append(0xd3);\n            this.pack_int64(num);\n        } else if (0x0000000000000000 <= num && num <= 0xFFFFFFFFFFFFFFFF){\n            this.bufferBuilder.append(0xcf);\n            this.pack_uint64(num);\n        } else{\n            throw new Error('Invalid integer');\n        }\n    }\n\n    Packer.prototype.pack_double = function(num){\n        var sign = 0;\n        if (num < 0){\n            sign = 1;\n            num = -num;\n        }\n        var exp  = Math.floor(Math.log(num) / Math.LN2);\n        var frac0 = num / Math.pow(2, exp) - 1;\n        var frac1 = Math.floor(frac0 * Math.pow(2, 52));\n        var b32   = Math.pow(2, 32);\n        var h32 = (sign << 31) | ((exp+1023) << 20) |\n            (frac1 / b32) & 0x0fffff;\n        var l32 = frac1 % b32;\n        this.bufferBuilder.append(0xcb);\n        this.pack_int32(h32);\n        this.pack_int32(l32);\n    }\n\n    Packer.prototype.pack_object = function(obj){\n        var keys = Object.keys(obj);\n        var length = keys.length;\n        if (length <= 0x0f){\n            this.pack_uint8(0x80 + length);\n        } else if (length <= 0xffff){\n            this.bufferBuilder.append(0xde);\n            this.pack_uint16(length);\n        } else if (length <= 0xffffffff){\n            this.bufferBuilder.append(0xdf);\n            this.pack_uint32(length);\n        } else{\n            throw new Error('Invalid length');\n        }\n        for(var prop in obj){\n            if (obj.hasOwnProperty(prop)){\n                this.pack(prop);\n                this.pack(obj[prop]);\n            }\n        }\n    }\n\n    Packer.prototype.pack_uint8 = function(num){\n        this.bufferBuilder.append(num);\n    }\n\n    Packer.prototype.pack_uint16 = function(num){\n        this.bufferBuilder.append(num >> 8);\n        this.bufferBuilder.append(num & 0xff);\n    }\n\n    Packer.prototype.pack_uint32 = function(num){\n        var n = num & 0xffffffff;\n        this.bufferBuilder.append((n & 0xff000000) >>> 24);\n        this.bufferBuilder.append((n & 0x00ff0000) >>> 16);\n        this.bufferBuilder.append((n & 0x0000ff00) >>>  8);\n        this.bufferBuilder.append((n & 0x000000ff));\n    }\n\n    Packer.prototype.pack_uint64 = function(num){\n        var high = num / Math.pow(2, 32);\n        var low  = num % Math.pow(2, 32);\n        this.bufferBuilder.append((high & 0xff000000) >>> 24);\n        this.bufferBuilder.append((high & 0x00ff0000) >>> 16);\n        this.bufferBuilder.append((high & 0x0000ff00) >>>  8);\n        this.bufferBuilder.append((high & 0x000000ff));\n        this.bufferBuilder.append((low  & 0xff000000) >>> 24);\n        this.bufferBuilder.append((low  & 0x00ff0000) >>> 16);\n        this.bufferBuilder.append((low  & 0x0000ff00) >>>  8);\n        this.bufferBuilder.append((low  & 0x000000ff));\n    }\n\n    Packer.prototype.pack_int8 = function(num){\n        this.bufferBuilder.append(num & 0xff);\n    }\n\n    Packer.prototype.pack_int16 = function(num){\n        this.bufferBuilder.append((num & 0xff00) >> 8);\n        this.bufferBuilder.append(num & 0xff);\n    }\n\n    Packer.prototype.pack_int32 = function(num){\n        this.bufferBuilder.append((num >>> 24) & 0xff);\n        this.bufferBuilder.append((num & 0x00ff0000) >>> 16);\n        this.bufferBuilder.append((num & 0x0000ff00) >>> 8);\n        this.bufferBuilder.append((num & 0x000000ff));\n    }\n\n    Packer.prototype.pack_int64 = function(num){\n        var high = Math.floor(num / Math.pow(2, 32));\n        var low  = num % Math.pow(2, 32);\n        this.bufferBuilder.append((high & 0xff000000) >>> 24);\n        this.bufferBuilder.append((high & 0x00ff0000) >>> 16);\n        this.bufferBuilder.append((high & 0x0000ff00) >>>  8);\n        this.bufferBuilder.append((high & 0x000000ff));\n        this.bufferBuilder.append((low  & 0xff000000) >>> 24);\n        this.bufferBuilder.append((low  & 0x00ff0000) >>> 16);\n        this.bufferBuilder.append((low  & 0x0000ff00) >>>  8);\n        this.bufferBuilder.append((low  & 0x000000ff));\n    }\n\n    function _utf8Replace(m){\n        var code = m.charCodeAt(0);\n\n        if(code <= 0x7ff) return '00';\n        if(code <= 0xffff) return '000';\n        if(code <= 0x1fffff) return '0000';\n        if(code <= 0x3ffffff) return '00000';\n        return '000000';\n    }\n\n    function utf8Length(str){\n        if (str.length > 600) {\n            // Blob method faster for large strings\n            return (new Blob([str])).size;\n        } else {\n            return str.replace(/[^\\u0000-\\u007F]/g, _utf8Replace).length;\n        }\n    }\n\n},{\"./bufferbuilder\":11}],11:[function(require,module,exports){\n    var binaryFeatures = {};\n    binaryFeatures.useBlobBuilder = (function(){\n        try {\n            new Blob([]);\n            return false;\n        } catch (e) {\n            return true;\n        }\n    })();\n\n    binaryFeatures.useArrayBufferView = !binaryFeatures.useBlobBuilder && (function(){\n        try {\n            return (new Blob([new Uint8Array([])])).size === 0;\n        } catch (e) {\n            return true;\n        }\n    })();\n\n    module.exports.binaryFeatures = binaryFeatures;\n    var BlobBuilder = module.exports.BlobBuilder;\n    if (typeof window != 'undefined') {\n        BlobBuilder = module.exports.BlobBuilder = window.WebKitBlobBuilder ||\n            window.MozBlobBuilder || window.MSBlobBuilder || window.BlobBuilder;\n    }\n\n    function BufferBuilder(){\n        this._pieces = [];\n        this._parts = [];\n    }\n\n    BufferBuilder.prototype.append = function(data) {\n        if(typeof data === 'number') {\n            this._pieces.push(data);\n        } else {\n            this.flush();\n            this._parts.push(data);\n        }\n    };\n\n    BufferBuilder.prototype.flush = function() {\n        if (this._pieces.length > 0) {\n            var buf = new Uint8Array(this._pieces);\n            if(!binaryFeatures.useArrayBufferView) {\n                buf = buf.buffer;\n            }\n            this._parts.push(buf);\n            this._pieces = [];\n        }\n    };\n\n    BufferBuilder.prototype.getBuffer = function() {\n        this.flush();\n        if(binaryFeatures.useBlobBuilder) {\n            var builder = new BlobBuilder();\n            for(var i = 0, ii = this._parts.length; i < ii; i++) {\n                builder.append(this._parts[i]);\n            }\n            return builder.getBlob();\n        } else {\n            return new Blob(this._parts);\n        }\n    };\n\n    module.exports.BufferBuilder = BufferBuilder;\n\n},{}],12:[function(require,module,exports){\n    var util = require('./util');\n\n    /**\n     * Reliable transfer for Chrome Canary DataChannel impl.\n     * Author: @michellebu\n     */\n    function Reliable(dc, debug) {\n        if (!(this instanceof Reliable)) return new Reliable(dc);\n        this._dc = dc;\n\n        util.debug = debug;\n\n        // Messages sent/received so far.\n        // id: { ack: n, chunks: [...] }\n        this._outgoing = {};\n        // id: { ack: ['ack', id, n], chunks: [...] }\n        this._incoming = {};\n        this._received = {};\n\n        // Window size.\n        this._window = 1000;\n        // MTU.\n        this._mtu = 500;\n        // Interval for setInterval. In ms.\n        this._interval = 0;\n\n        // Messages sent.\n        this._count = 0;\n\n        // Outgoing message queue.\n        this._queue = [];\n\n        this._setupDC();\n    };\n\n// Send a message reliably.\n    Reliable.prototype.send = function(msg) {\n        // Determine if chunking is necessary.\n        var bl = util.pack(msg);\n        if (bl.size < this._mtu) {\n            this._handleSend(['no', bl]);\n            return;\n        }\n\n        this._outgoing[this._count] = {\n            ack: 0,\n            chunks: this._chunk(bl)\n        };\n\n        if (util.debug) {\n            this._outgoing[this._count].timer = new Date();\n        }\n\n        // Send prelim window.\n        this._sendWindowedChunks(this._count);\n        this._count += 1;\n    };\n\n// Set up interval for processing queue.\n    Reliable.prototype._setupInterval = function() {\n        // TODO: fail gracefully.\n\n        var self = this;\n        this._timeout = setInterval(function() {\n            // FIXME: String stuff makes things terribly async.\n            var msg = self._queue.shift();\n            if (msg._multiple) {\n                for (var i = 0, ii = msg.length; i < ii; i += 1) {\n                    self._intervalSend(msg[i]);\n                }\n            } else {\n                self._intervalSend(msg);\n            }\n        }, this._interval);\n    };\n\n    Reliable.prototype._intervalSend = function(msg) {\n        var self = this;\n        msg = util.pack(msg);\n        util.blobToBinaryString(msg, function(str) {\n            self._dc.send(str);\n        });\n        if (self._queue.length === 0) {\n            clearTimeout(self._timeout);\n            self._timeout = null;\n            //self._processAcks();\n        }\n    };\n\n// Go through ACKs to send missing pieces.\n    Reliable.prototype._processAcks = function() {\n        for (var id in this._outgoing) {\n            if (this._outgoing.hasOwnProperty(id)) {\n                this._sendWindowedChunks(id);\n            }\n        }\n    };\n\n// Handle sending a message.\n// FIXME: Don't wait for interval time for all messages...\n    Reliable.prototype._handleSend = function(msg) {\n        var push = true;\n        for (var i = 0, ii = this._queue.length; i < ii; i += 1) {\n            var item = this._queue[i];\n            if (item === msg) {\n                push = false;\n            } else if (item._multiple && item.indexOf(msg) !== -1) {\n                push = false;\n            }\n        }\n        if (push) {\n            this._queue.push(msg);\n            if (!this._timeout) {\n                this._setupInterval();\n            }\n        }\n    };\n\n// Set up DataChannel handlers.\n    Reliable.prototype._setupDC = function() {\n        // Handle various message types.\n        var self = this;\n        this._dc.onmessage = function(e) {\n            var msg = e.data;\n            var datatype = msg.constructor;\n            // FIXME: msg is String until binary is supported.\n            // Once that happens, this will have to be smarter.\n            if (datatype === String) {\n                var ab = util.binaryStringToArrayBuffer(msg);\n                msg = util.unpack(ab);\n                self._handleMessage(msg);\n            }\n        };\n    };\n\n// Handles an incoming message.\n    Reliable.prototype._handleMessage = function(msg) {\n        var id = msg[1];\n        var idata = this._incoming[id];\n        var odata = this._outgoing[id];\n        var data;\n        switch (msg[0]) {\n            // No chunking was done.\n            case 'no':\n                var message = id;\n                if (!!message) {\n                    this.onmessage(util.unpack(message));\n                }\n                break;\n            // Reached the end of the message.\n            case 'end':\n                data = idata;\n\n                // In case end comes first.\n                this._received[id] = msg[2];\n\n                if (!data) {\n                    break;\n                }\n\n                this._ack(id);\n                break;\n            case 'ack':\n                data = odata;\n                if (!!data) {\n                    var ack = msg[2];\n                    // Take the larger ACK, for out of order messages.\n                    data.ack = Math.max(ack, data.ack);\n\n                    // Clean up when all chunks are ACKed.\n                    if (data.ack >= data.chunks.length) {\n                        util.log('Time: ', new Date() - data.timer);\n                        delete this._outgoing[id];\n                    } else {\n                        this._processAcks();\n                    }\n                }\n                // If !data, just ignore.\n                break;\n            // Received a chunk of data.\n            case 'chunk':\n                // Create a new entry if none exists.\n                data = idata;\n                if (!data) {\n                    var end = this._received[id];\n                    if (end === true) {\n                        break;\n                    }\n                    data = {\n                        ack: ['ack', id, 0],\n                        chunks: []\n                    };\n                    this._incoming[id] = data;\n                }\n\n                var n = msg[2];\n                var chunk = msg[3];\n                data.chunks[n] = new Uint8Array(chunk);\n\n                // If we get the chunk we're looking for, ACK for next missing.\n                // Otherwise, ACK the same N again.\n                if (n === data.ack[2]) {\n                    this._calculateNextAck(id);\n                }\n                this._ack(id);\n                break;\n            default:\n                // Shouldn't happen, but would make sense for message to just go\n                // through as is.\n                this._handleSend(msg);\n                break;\n        }\n    };\n\n// Chunks BL into smaller messages.\n    Reliable.prototype._chunk = function(bl) {\n        var chunks = [];\n        var size = bl.size;\n        var start = 0;\n        while (start < size) {\n            var end = Math.min(size, start + this._mtu);\n            var b = bl.slice(start, end);\n            var chunk = {\n                payload: b\n            }\n            chunks.push(chunk);\n            start = end;\n        }\n        util.log('Created', chunks.length, 'chunks.');\n        return chunks;\n    };\n\n// Sends ACK N, expecting Nth blob chunk for message ID.\n    Reliable.prototype._ack = function(id) {\n        var ack = this._incoming[id].ack;\n\n        // if ack is the end value, then call _complete.\n        if (this._received[id] === ack[2]) {\n            this._complete(id);\n            this._received[id] = true;\n        }\n\n        this._handleSend(ack);\n    };\n\n// Calculates the next ACK number, given chunks.\n    Reliable.prototype._calculateNextAck = function(id) {\n        var data = this._incoming[id];\n        var chunks = data.chunks;\n        for (var i = 0, ii = chunks.length; i < ii; i += 1) {\n            // This chunk is missing!!! Better ACK for it.\n            if (chunks[i] === undefined) {\n                data.ack[2] = i;\n                return;\n            }\n        }\n        data.ack[2] = chunks.length;\n    };\n\n// Sends the next window of chunks.\n    Reliable.prototype._sendWindowedChunks = function(id) {\n        util.log('sendWindowedChunks for: ', id);\n        var data = this._outgoing[id];\n        var ch = data.chunks;\n        var chunks = [];\n        var limit = Math.min(data.ack + this._window, ch.length);\n        for (var i = data.ack; i < limit; i += 1) {\n            if (!ch[i].sent || i === data.ack) {\n                ch[i].sent = true;\n                chunks.push(['chunk', id, i, ch[i].payload]);\n            }\n        }\n        if (data.ack + this._window >= ch.length) {\n            chunks.push(['end', id, ch.length])\n        }\n        chunks._multiple = true;\n        this._handleSend(chunks);\n    };\n\n// Puts together a message from chunks.\n    Reliable.prototype._complete = function(id) {\n        util.log('Completed called for', id);\n        var self = this;\n        var chunks = this._incoming[id].chunks;\n        var bl = new Blob(chunks);\n        util.blobToArrayBuffer(bl, function(ab) {\n            self.onmessage(util.unpack(ab));\n        });\n        delete this._incoming[id];\n    };\n\n// Ups bandwidth limit on SDP. Meant to be called during offer/answer.\n    Reliable.higherBandwidthSDP = function(sdp) {\n        // AS stands for Application-Specific Maximum.\n        // Bandwidth number is in kilobits / sec.\n        // See RFC for more info: http://www.ietf.org/rfc/rfc2327.txt\n\n        // Chrome 31+ doesn't want us munging the SDP, so we'll let them have their\n        // way.\n        var version = navigator.appVersion.match(/Chrome\\/(.*?) /);\n        if (version) {\n            version = parseInt(version[1].split('.').shift());\n            if (version < 31) {\n                var parts = sdp.split('b=AS:30');\n                var replace = 'b=AS:102400'; // 100 Mbps\n                if (parts.length > 1) {\n                    return parts[0] + replace + parts[1];\n                }\n            }\n        }\n\n        return sdp;\n    };\n\n// Overwritten, typically.\n    Reliable.prototype.onmessage = function(msg) {};\n\n    module.exports.Reliable = Reliable;\n\n},{\"./util\":13}],13:[function(require,module,exports){\n    var BinaryPack = require('js-binarypack');\n\n    var util = {\n        debug: false,\n\n        inherits: function(ctor, superCtor) {\n            ctor.super_ = superCtor;\n            ctor.prototype = Object.create(superCtor.prototype, {\n                constructor: {\n                    value: ctor,\n                    enumerable: false,\n                    writable: true,\n                    configurable: true\n                }\n            });\n        },\n        extend: function(dest, source) {\n            for(var key in source) {\n                if(source.hasOwnProperty(key)) {\n                    dest[key] = source[key];\n                }\n            }\n            return dest;\n        },\n        pack: BinaryPack.pack,\n        unpack: BinaryPack.unpack,\n\n        log: function () {\n            if (util.debug) {\n                var copy = [];\n                for (var i = 0; i < arguments.length; i++) {\n                    copy[i] = arguments[i];\n                }\n                copy.unshift('Reliable: ');\n                console.log.apply(console, copy);\n            }\n        },\n\n        setZeroTimeout: (function(global) {\n            var timeouts = [];\n            var messageName = 'zero-timeout-message';\n\n            // Like setTimeout, but only takes a function argument.\t There's\n            // no time argument (always zero) and no arguments (you have to\n            // use a closure).\n            function setZeroTimeoutPostMessage(fn) {\n                timeouts.push(fn);\n                global.postMessage(messageName, '*');\n            }\n\n            function handleMessage(event) {\n                if (event.source == global && event.data == messageName) {\n                    if (event.stopPropagation) {\n                        event.stopPropagation();\n                    }\n                    if (timeouts.length) {\n                        timeouts.shift()();\n                    }\n                }\n            }\n            if (global.addEventListener) {\n                global.addEventListener('message', handleMessage, true);\n            } else if (global.attachEvent) {\n                global.attachEvent('onmessage', handleMessage);\n            }\n            return setZeroTimeoutPostMessage;\n        }(this)),\n\n        blobToArrayBuffer: function(blob, cb){\n            var fr = new FileReader();\n            fr.onload = function(evt) {\n                cb(evt.target.result);\n            };\n            fr.readAsArrayBuffer(blob);\n        },\n        blobToBinaryString: function(blob, cb){\n            var fr = new FileReader();\n            fr.onload = function(evt) {\n                cb(evt.target.result);\n            };\n            fr.readAsBinaryString(blob);\n        },\n        binaryStringToArrayBuffer: function(binary) {\n            var byteArray = new Uint8Array(binary.length);\n            for (var i = 0; i < binary.length; i++) {\n                byteArray[i] = binary.charCodeAt(i) & 0xff;\n            }\n            return byteArray.buffer;\n        },\n        randomToken: function () {\n            return Math.random().toString(36).substr(2);\n        }\n    };\n\n    module.exports = util;\n\n},{\"js-binarypack\":10}]},{},[3]);"]}