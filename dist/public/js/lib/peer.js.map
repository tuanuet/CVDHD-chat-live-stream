{"version":3,"sources":["../../../../public/js/lib/peer.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","module","RTCSessionDescription","window","mozRTCSessionDescription","RTCPeerConnection","mozRTCPeerConnection","webkitRTCPeerConnection","RTCIceCandidate","mozRTCIceCandidate","util","EventEmitter","Negotiator","Reliable","DataConnection","peer","provider","options","extend","serialization","reliable","open","type","id","connectionId","_idPrefix","randomToken","label","metadata","_buffer","_buffering","bufferSize","_chunkedData","_payload","_peerBrowser","browser","startConnection","originator","inherits","prototype","initialize","dc","_dc","dataChannel","_configureDataChannel","self","supports","sctp","binaryType","onopen","log","emit","_reliable","debug","onmessage","msg","_handleDataMessage","onclose","close","data","datatype","constructor","Blob","blobToArrayBuffer","ab","unpack","ArrayBuffer","String","binaryStringToArrayBuffer","JSON","parse","__peerData","chunkInfo","count","total","cleanup","send","chunked","_bufferedSend","stringify","blob","pack","needsChunking","chunkedBrowsers","size","chunkedMTU","_sendChunks","blobToBinaryString","str","binaryBlob","_trySend","push","setTimeout","_tryBuffer","shift","blobs","chunk","ii","handleMessage","message","payload","handleSDP","sdp","handleCandidate","candidate","warn","Socket","MediaConnection","Peer","BinaryPack","localStream","_stream","addStream","remoteStream","answer","stream","messages","_getMessages","pcs","media","queue","connection","pc","_getPeerConnection","peerConnection","config","createDataChannel","onnegotiationneeded","_makeOffer","error","peerConnections","signalingState","_startPeerConnection","optional","RtpDataChannels","DtlsSrtpKeyAgreement","_setupListeners","pc_id","peerId","onicecandidate","evt","socket","dst","oniceconnectionstatechange","iceConnectionState","noop","onicechange","ondatachannel","channel","getConnection","onaddstream","readyState","createOffer","offer","higherBandwidthSDP","setLocalDescription","err","emitError","constraints","_makeAnswer","createAnswer","setRemoteDescription","ice","sdpMLineIndex","addIceCandidate","Object","undefined","toString","host","CLOUD_HOST","port","CLOUD_PORT","key","path","token","defaultConfig","location","hostname","secure","isSecure","logFunction","setLogFunction","setLogLevel","audioVideo","_delayedAbort","validateId","validateKey","destroyed","disconnected","connections","_lostMessages","_initializeServerConnection","_initialize","_retrieveId","on","_handleMessage","_abort","disconnect","cb","http","XMLHttpRequest","protocol","url","queryString","Date","getTime","Math","random","onerror","pathError","onreadystatechange","status","responseText","start","src","_cleanupPeer","_addConnection","_storeMessage","connect","setZeroTimeout","_lastServerId","destroy","_cleanup","peers","keys","j","jj","reconnect","listAllPeers","helpfulError","_queue","httpProtocol","wsProtocol","_httpUrl","_wsUrl","_startXhrStream","_startWebSocket","_socket","WebSocket","event","_timeout","clearTimeout","_http","abort","_sendQueuedMessages","_index","_streamIndex","old","_handleStream","_setHTTPTimeout","split","index","bufferedMessage","_wsOpen","toLowerCase","setRequestHeader","dataCount","logLevel","level","debugLevel","parseInt","isNaN","_printWith","_print","fn","Function","prefix","copy","Array","slice","arguments","unshift","apply","name","console","reliablePC","reliableDC","negotiationPC","binary","exec","ctor","superCtor","super_","create","value","enumerable","writable","configurable","dest","source","hasOwnProperty","global","timeouts","messageName","setZeroTimeoutPostMessage","postMessage","stopPropagation","addEventListener","attachEvent","bl","chunks","ceil","end","min","b","fr","FileReader","onload","target","result","readAsArrayBuffer","readAsBinaryString","byteArray","Uint8Array","charCodeAt","buffer","substr","EE","context","once","_events","listeners","ee","a1","a2","a3","a4","a5","len","args","removeListener","events","removeAllListeners","off","addListener","setMaxListeners","EventEmitter2","EventEmitter3","BufferBuilder","binaryFeatures","unpacker","Unpacker","packer","Packer","getBuffer","dataBuffer","dataView","byteLength","unpack_uint8","positive_fixnum","negative_fixnum","unpack_raw","unpack_string","unpack_array","unpack_map","unpack_float","unpack_double","unpack_uint16","unpack_uint32","unpack_uint64","unpack_int8","unpack_int16","unpack_int32","unpack_int64","byte","bytes","read","uint16","uint32","uint64","uint8","pow","buf","c","fromCharCode","objects","map","sign","exp","fraction","h32","l32","hfrac","frac","subarray","bufferBuilder","pack_string","floor","pack_integer","pack_double","append","pack_array","File","pack_bin","useArrayBufferView","pack_object","toBinaryPack","flush","pack_uint8","pack_uint16","pack_uint32","utf8Length","ary","num","pack_int8","pack_int16","pack_int32","pack_int64","pack_uint64","LN2","frac0","frac1","b32","obj","prop","high","low","_utf8Replace","m","replace","useBlobBuilder","BlobBuilder","WebKitBlobBuilder","MozBlobBuilder","MSBlobBuilder","_pieces","_parts","builder","getBlob","_outgoing","_incoming","_received","_window","_mtu","_interval","_count","_setupDC","_handleSend","ack","_chunk","timer","_sendWindowedChunks","_setupInterval","setInterval","_multiple","_intervalSend","_processAcks","item","indexOf","idata","odata","_ack","max","_calculateNextAck","_complete","ch","limit","sent","version","navigator","appVersion","match","parts"],"mappings":"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","file":"peer.js","sourcesContent":["/*! peerjs build:0.3.13, development. Copyright(c) 2013 Michelle Bu <michelle@michellebu.com> */(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\nmodule.exports.RTCSessionDescription = window.RTCSessionDescription ||\n\twindow.mozRTCSessionDescription;\nmodule.exports.RTCPeerConnection = window.RTCPeerConnection ||\n\twindow.mozRTCPeerConnection || window.webkitRTCPeerConnection;\nmodule.exports.RTCIceCandidate = window.RTCIceCandidate ||\n\twindow.mozRTCIceCandidate;\n\n},{}],2:[function(require,module,exports){\nvar util = require('./util');\nvar EventEmitter = require('eventemitter3');\nvar Negotiator = require('./negotiator');\nvar Reliable = require('reliable');\n\n/**\n * Wraps a DataChannel between two Peers.\n */\nfunction DataConnection(peer, provider, options) {\n  if (!(this instanceof DataConnection)) return new DataConnection(peer, provider, options);\n  EventEmitter.call(this);\n\n  this.options = util.extend({\n    serialization: 'binary',\n    reliable: false\n  }, options);\n\n  // Connection is not open yet.\n  this.open = false;\n  this.type = 'data';\n  this.peer = peer;\n  this.provider = provider;\n\n  this.id = this.options.connectionId || DataConnection._idPrefix + util.randomToken();\n\n  this.label = this.options.label || this.id;\n  this.metadata = this.options.metadata;\n  this.serialization = this.options.serialization;\n  this.reliable = this.options.reliable;\n\n  // Data channel buffering.\n  this._buffer = [];\n  this._buffering = false;\n  this.bufferSize = 0;\n\n  // For storing large data.\n  this._chunkedData = {};\n\n  if (this.options._payload) {\n    this._peerBrowser = this.options._payload.browser;\n  }\n\n  Negotiator.startConnection(\n    this,\n    this.options._payload || {\n      originator: true\n    }\n  );\n}\n\nutil.inherits(DataConnection, EventEmitter);\n\nDataConnection._idPrefix = 'dc_';\n\n/** Called by the Negotiator when the DataChannel is ready. */\nDataConnection.prototype.initialize = function(dc) {\n  this._dc = this.dataChannel = dc;\n  this._configureDataChannel();\n}\n\nDataConnection.prototype._configureDataChannel = function() {\n  var self = this;\n  if (util.supports.sctp) {\n    this._dc.binaryType = 'arraybuffer';\n  }\n  this._dc.onopen = function() {\n    util.log('Data channel connection success');\n    self.open = true;\n    self.emit('open');\n  }\n\n  // Use the Reliable shim for non Firefox browsers\n  if (!util.supports.sctp && this.reliable) {\n    this._reliable = new Reliable(this._dc, util.debug);\n  }\n\n  if (this._reliable) {\n    this._reliable.onmessage = function(msg) {\n      self.emit('data', msg);\n    };\n  } else {\n    this._dc.onmessage = function(e) {\n      self._handleDataMessage(e);\n    };\n  }\n  this._dc.onclose = function(e) {\n    util.log('DataChannel closed for:', self.peer);\n    self.close();\n  };\n}\n\n// Handles a DataChannel message.\nDataConnection.prototype._handleDataMessage = function(e) {\n  var self = this;\n  var data = e.data;\n  var datatype = data.constructor;\n  if (this.serialization === 'binary' || this.serialization === 'binary-utf8') {\n    if (datatype === Blob) {\n      // Datatype should never be blob\n      util.blobToArrayBuffer(data, function(ab) {\n        data = util.unpack(ab);\n        self.emit('data', data);\n      });\n      return;\n    } else if (datatype === ArrayBuffer) {\n      data = util.unpack(data);\n    } else if (datatype === String) {\n      // String fallback for binary data for browsers that don't support binary yet\n      var ab = util.binaryStringToArrayBuffer(data);\n      data = util.unpack(ab);\n    }\n  } else if (this.serialization === 'json') {\n    data = JSON.parse(data);\n  }\n\n  // Check if we've chunked--if so, piece things back together.\n  // We're guaranteed that this isn't 0.\n  if (data.__peerData) {\n    var id = data.__peerData;\n    var chunkInfo = this._chunkedData[id] || {data: [], count: 0, total: data.total};\n\n    chunkInfo.data[data.n] = data.data;\n    chunkInfo.count += 1;\n\n    if (chunkInfo.total === chunkInfo.count) {\n      // Clean up before making the recursive call to `_handleDataMessage`.\n      delete this._chunkedData[id];\n\n      // We've received all the chunks--time to construct the complete data.\n      data = new Blob(chunkInfo.data);\n      this._handleDataMessage({data: data});\n    }\n\n    this._chunkedData[id] = chunkInfo;\n    return;\n  }\n\n  this.emit('data', data);\n}\n\n/**\n * Exposed functionality for users.\n */\n\n/** Allows user to close connection. */\nDataConnection.prototype.close = function() {\n  if (!this.open) {\n    return;\n  }\n  this.open = false;\n  Negotiator.cleanup(this);\n  this.emit('close');\n}\n\n/** Allows user to send data. */\nDataConnection.prototype.send = function(data, chunked) {\n  if (!this.open) {\n    this.emit('error', new Error('Connection is not open. You should listen for the `open` event before sending messages.'));\n    return;\n  }\n  if (this._reliable) {\n    // Note: reliable shim sending will make it so that you cannot customize\n    // serialization.\n    this._reliable.send(data);\n    return;\n  }\n  var self = this;\n  if (this.serialization === 'json') {\n    this._bufferedSend(JSON.stringify(data));\n  } else if (this.serialization === 'binary' || this.serialization === 'binary-utf8') {\n    var blob = util.pack(data);\n\n    // For Chrome-Firefox interoperability, we need to make Firefox \"chunk\"\n    // the data it sends out.\n    var needsChunking = util.chunkedBrowsers[this._peerBrowser] || util.chunkedBrowsers[util.browser];\n    if (needsChunking && !chunked && blob.size > util.chunkedMTU) {\n      this._sendChunks(blob);\n      return;\n    }\n\n    // DataChannel currently only supports strings.\n    if (!util.supports.sctp) {\n      util.blobToBinaryString(blob, function(str) {\n        self._bufferedSend(str);\n      });\n    } else if (!util.supports.binaryBlob) {\n      // We only do this if we really need to (e.g. blobs are not supported),\n      // because this conversion is costly.\n      util.blobToArrayBuffer(blob, function(ab) {\n        self._bufferedSend(ab);\n      });\n    } else {\n      this._bufferedSend(blob);\n    }\n  } else {\n    this._bufferedSend(data);\n  }\n}\n\nDataConnection.prototype._bufferedSend = function(msg) {\n  if (this._buffering || !this._trySend(msg)) {\n    this._buffer.push(msg);\n    this.bufferSize = this._buffer.length;\n  }\n}\n\n// Returns true if the send succeeds.\nDataConnection.prototype._trySend = function(msg) {\n  try {\n    this._dc.send(msg);\n  } catch (e) {\n    this._buffering = true;\n\n    var self = this;\n    setTimeout(function() {\n      // Try again.\n      self._buffering = false;\n      self._tryBuffer();\n    }, 100);\n    return false;\n  }\n  return true;\n}\n\n// Try to send the first message in the buffer.\nDataConnection.prototype._tryBuffer = function() {\n  if (this._buffer.length === 0) {\n    return;\n  }\n\n  var msg = this._buffer[0];\n\n  if (this._trySend(msg)) {\n    this._buffer.shift();\n    this.bufferSize = this._buffer.length;\n    this._tryBuffer();\n  }\n}\n\nDataConnection.prototype._sendChunks = function(blob) {\n  var blobs = util.chunk(blob);\n  for (var i = 0, ii = blobs.length; i < ii; i += 1) {\n    var blob = blobs[i];\n    this.send(blob, true);\n  }\n}\n\nDataConnection.prototype.handleMessage = function(message) {\n  var payload = message.payload;\n\n  switch (message.type) {\n    case 'ANSWER':\n      this._peerBrowser = payload.browser;\n\n      // Forward to negotiator\n      Negotiator.handleSDP(message.type, this, payload.sdp);\n      break;\n    case 'CANDIDATE':\n      Negotiator.handleCandidate(this, payload.candidate);\n      break;\n    default:\n      util.warn('Unrecognized message type:', message.type, 'from peer:', this.peer);\n      break;\n  }\n}\n\nmodule.exports = DataConnection;\n\n},{\"./negotiator\":5,\"./util\":8,\"eventemitter3\":9,\"reliable\":12}],3:[function(require,module,exports){\nwindow.Socket = require('./socket');\nwindow.MediaConnection = require('./mediaconnection');\nwindow.DataConnection = require('./dataconnection');\nwindow.Peer = require('./peer');\nwindow.RTCPeerConnection = require('./adapter').RTCPeerConnection;\nwindow.RTCSessionDescription = require('./adapter').RTCSessionDescription;\nwindow.RTCIceCandidate = require('./adapter').RTCIceCandidate;\nwindow.Negotiator = require('./negotiator');\nwindow.util = require('./util');\nwindow.BinaryPack = require('js-binarypack');\n\n},{\"./adapter\":1,\"./dataconnection\":2,\"./mediaconnection\":4,\"./negotiator\":5,\"./peer\":6,\"./socket\":7,\"./util\":8,\"js-binarypack\":10}],4:[function(require,module,exports){\nvar util = require('./util');\nvar EventEmitter = require('eventemitter3');\nvar Negotiator = require('./negotiator');\n\n/**\n * Wraps the streaming interface between two Peers.\n */\nfunction MediaConnection(peer, provider, options) {\n  if (!(this instanceof MediaConnection)) return new MediaConnection(peer, provider, options);\n  EventEmitter.call(this);\n\n  this.options = util.extend({}, options);\n\n  this.open = false;\n  this.type = 'media';\n  this.peer = peer;\n  this.provider = provider;\n  this.metadata = this.options.metadata;\n  this.localStream = this.options._stream;\n\n  this.id = this.options.connectionId || MediaConnection._idPrefix + util.randomToken();\n  if (this.localStream) {\n    Negotiator.startConnection(\n      this,\n      {_stream: this.localStream, originator: true}\n    );\n  }\n};\n\nutil.inherits(MediaConnection, EventEmitter);\n\nMediaConnection._idPrefix = 'mc_';\n\nMediaConnection.prototype.addStream = function(remoteStream) {\n  util.log('Receiving stream', remoteStream);\n\n  this.remoteStream = remoteStream;\n  this.emit('stream', remoteStream); // Should we call this `open`?\n\n};\n\nMediaConnection.prototype.handleMessage = function(message) {\n  var payload = message.payload;\n\n  switch (message.type) {\n    case 'ANSWER':\n      // Forward to negotiator\n      Negotiator.handleSDP(message.type, this, payload.sdp);\n      this.open = true;\n      break;\n    case 'CANDIDATE':\n      Negotiator.handleCandidate(this, payload.candidate);\n      break;\n    default:\n      util.warn('Unrecognized message type:', message.type, 'from peer:', this.peer);\n      break;\n  }\n}\n\nMediaConnection.prototype.answer = function(stream) {\n  if (this.localStream) {\n    util.warn('Local stream already exists on this MediaConnection. Are you answering a call twice?');\n    return;\n  }\n\n  this.options._payload._stream = stream;\n\n  this.localStream = stream;\n  Negotiator.startConnection(\n    this,\n    this.options._payload\n  )\n  // Retrieve lost messages stored because PeerConnection not set up.\n  var messages = this.provider._getMessages(this.id);\n  for (var i = 0, ii = messages.length; i < ii; i += 1) {\n    this.handleMessage(messages[i]);\n  }\n  this.open = true;\n};\n\n/**\n * Exposed functionality for users.\n */\n\n/** Allows user to close connection. */\nMediaConnection.prototype.close = function() {\n  if (!this.open) {\n    return;\n  }\n  this.open = false;\n  Negotiator.cleanup(this);\n  this.emit('close')\n};\n\nmodule.exports = MediaConnection;\n\n},{\"./negotiator\":5,\"./util\":8,\"eventemitter3\":9}],5:[function(require,module,exports){\nvar util = require('./util');\nvar RTCPeerConnection = require('./adapter').RTCPeerConnection;\nvar RTCSessionDescription = require('./adapter').RTCSessionDescription;\nvar RTCIceCandidate = require('./adapter').RTCIceCandidate;\n\n/**\n * Manages all negotiations between Peers.\n */\nvar Negotiator = {\n  pcs: {\n    data: {},\n    media: {}\n  }, // type => {peerId: {pc_id: pc}}.\n  //providers: {}, // provider's id => providers (there may be multiple providers/client.\n  queue: [] // connections that are delayed due to a PC being in use.\n}\n\nNegotiator._idPrefix = 'pc_';\n\n/** Returns a PeerConnection object set up correctly (for data, media). */\nNegotiator.startConnection = function(connection, options) {\n  var pc = Negotiator._getPeerConnection(connection, options);\n\n  if (connection.type === 'media' && options._stream) {\n    // Add the stream.\n    pc.addStream(options._stream);\n  }\n\n  // Set the connection's PC.\n  connection.pc = connection.peerConnection = pc;\n  // What do we need to do now?\n  if (options.originator) {\n    if (connection.type === 'data') {\n      // Create the datachannel.\n      var config = {};\n      // Dropping reliable:false support, since it seems to be crashing\n      // Chrome.\n      /*if (util.supports.sctp && !options.reliable) {\n        // If we have canonical reliable support...\n        config = {maxRetransmits: 0};\n      }*/\n      // Fallback to ensure older browsers don't crash.\n      if (!util.supports.sctp) {\n        config = {reliable: options.reliable};\n      }\n      var dc = pc.createDataChannel(connection.label, config);\n      connection.initialize(dc);\n    }\n\n    if (!util.supports.onnegotiationneeded) {\n      Negotiator._makeOffer(connection);\n    }\n  } else {\n    Negotiator.handleSDP('OFFER', connection, options.sdp);\n  }\n}\n\nNegotiator._getPeerConnection = function(connection, options) {\n  if (!Negotiator.pcs[connection.type]) {\n    util.error(connection.type + ' is not a valid connection type. Maybe you overrode the `type` property somewhere.');\n  }\n\n  if (!Negotiator.pcs[connection.type][connection.peer]) {\n    Negotiator.pcs[connection.type][connection.peer] = {};\n  }\n  var peerConnections = Negotiator.pcs[connection.type][connection.peer];\n\n  var pc;\n  // Not multiplexing while FF and Chrome have not-great support for it.\n  /*if (options.multiplex) {\n    ids = Object.keys(peerConnections);\n    for (var i = 0, ii = ids.length; i < ii; i += 1) {\n      pc = peerConnections[ids[i]];\n      if (pc.signalingState === 'stable') {\n        break; // We can go ahead and use this PC.\n      }\n    }\n  } else */\n  if (options.pc) { // Simplest case: PC id already provided for us.\n    pc = Negotiator.pcs[connection.type][connection.peer][options.pc];\n  }\n\n  if (!pc || pc.signalingState !== 'stable') {\n    pc = Negotiator._startPeerConnection(connection);\n  }\n  return pc;\n}\n\n/*\nNegotiator._addProvider = function(provider) {\n  if ((!provider.id && !provider.disconnected) || !provider.socket.open) {\n    // Wait for provider to obtain an ID.\n    provider.on('open', function(id) {\n      Negotiator._addProvider(provider);\n    });\n  } else {\n    Negotiator.providers[provider.id] = provider;\n  }\n}*/\n\n\n/** Start a PC. */\nNegotiator._startPeerConnection = function(connection) {\n  util.log('Creating RTCPeerConnection.');\n\n  var id = Negotiator._idPrefix + util.randomToken();\n  var optional = {};\n\n  if (connection.type === 'data' && !util.supports.sctp) {\n    optional = {optional: [{RtpDataChannels: true}]};\n  } else if (connection.type === 'media') {\n    // Interop req for chrome.\n    optional = {optional: [{DtlsSrtpKeyAgreement: true}]};\n  }\n\n  var pc = new RTCPeerConnection(connection.provider.options.config, optional);\n  Negotiator.pcs[connection.type][connection.peer][id] = pc;\n\n  Negotiator._setupListeners(connection, pc, id);\n\n  return pc;\n}\n\n/** Set up various WebRTC listeners. */\nNegotiator._setupListeners = function(connection, pc, pc_id) {\n  var peerId = connection.peer;\n  var connectionId = connection.id;\n  var provider = connection.provider;\n\n  // ICE CANDIDATES.\n  util.log('Listening for ICE candidates.');\n  pc.onicecandidate = function(evt) {\n    if (evt.candidate) {\n      util.log('Received ICE candidates for:', connection.peer);\n      provider.socket.send({\n        type: 'CANDIDATE',\n        payload: {\n          candidate: evt.candidate,\n          type: connection.type,\n          connectionId: connection.id\n        },\n        dst: peerId\n      });\n    }\n  };\n\n  pc.oniceconnectionstatechange = function() {\n    switch (pc.iceConnectionState) {\n      case 'disconnected':\n      case 'failed':\n        util.log('iceConnectionState is disconnected, closing connections to ' + peerId);\n        connection.close();\n        break;\n      case 'completed':\n        pc.onicecandidate = util.noop;\n        break;\n    }\n  };\n\n  // Fallback for older Chrome impls.\n  pc.onicechange = pc.oniceconnectionstatechange;\n\n  // ONNEGOTIATIONNEEDED (Chrome)\n  util.log('Listening for `negotiationneeded`');\n  pc.onnegotiationneeded = function() {\n    util.log('`negotiationneeded` triggered');\n    if (pc.signalingState == 'stable') {\n      Negotiator._makeOffer(connection);\n    } else {\n      util.log('onnegotiationneeded triggered when not stable. Is another connection being established?');\n    }\n  };\n\n  // DATACONNECTION.\n  util.log('Listening for data channel');\n  // Fired between offer and answer, so options should already be saved\n  // in the options hash.\n  pc.ondatachannel = function(evt) {\n    util.log('Received data channel');\n    var dc = evt.channel;\n    var connection = provider.getConnection(peerId, connectionId);\n    connection.initialize(dc);\n  };\n\n  // MEDIACONNECTION.\n  util.log('Listening for remote stream');\n  pc.onaddstream = function(evt) {\n    util.log('Received remote stream');\n    var stream = evt.stream;\n    var connection = provider.getConnection(peerId, connectionId);\n    // 10/10/2014: looks like in Chrome 38, onaddstream is triggered after\n    // setting the remote description. Our connection object in these cases\n    // is actually a DATA connection, so addStream fails.\n    // TODO: This is hopefully just a temporary fix. We should try to\n    // understand why this is happening.\n    if (connection.type === 'media') {\n      connection.addStream(stream);\n    }\n  };\n}\n\nNegotiator.cleanup = function(connection) {\n  util.log('Cleaning up PeerConnection to ' + connection.peer);\n\n  var pc = connection.pc;\n\n  if (!!pc && (pc.readyState !== 'closed' || pc.signalingState !== 'closed')) {\n    pc.close();\n    connection.pc = null;\n  }\n}\n\nNegotiator._makeOffer = function(connection) {\n  var pc = connection.pc;\n  pc.createOffer(function(offer) {\n    util.log('Created offer.');\n\n    if (!util.supports.sctp && connection.type === 'data' && connection.reliable) {\n      offer.sdp = Reliable.higherBandwidthSDP(offer.sdp);\n    }\n\n    pc.setLocalDescription(offer, function() {\n      util.log('Set localDescription: offer', 'for:', connection.peer);\n      connection.provider.socket.send({\n        type: 'OFFER',\n        payload: {\n          sdp: offer,\n          type: connection.type,\n          label: connection.label,\n          connectionId: connection.id,\n          reliable: connection.reliable,\n          serialization: connection.serialization,\n          metadata: connection.metadata,\n          browser: util.browser\n        },\n        dst: connection.peer\n      });\n    }, function(err) {\n      connection.provider.emitError('webrtc', err);\n      util.log('Failed to setLocalDescription, ', err);\n    });\n  }, function(err) {\n    connection.provider.emitError('webrtc', err);\n    util.log('Failed to createOffer, ', err);\n  }, connection.options.constraints);\n}\n\nNegotiator._makeAnswer = function(connection) {\n  var pc = connection.pc;\n\n  pc.createAnswer(function(answer) {\n    util.log('Created answer.');\n\n    if (!util.supports.sctp && connection.type === 'data' && connection.reliable) {\n      answer.sdp = Reliable.higherBandwidthSDP(answer.sdp);\n    }\n\n    pc.setLocalDescription(answer, function() {\n      util.log('Set localDescription: answer', 'for:', connection.peer);\n      connection.provider.socket.send({\n        type: 'ANSWER',\n        payload: {\n          sdp: answer,\n          type: connection.type,\n          connectionId: connection.id,\n          browser: util.browser\n        },\n        dst: connection.peer\n      });\n    }, function(err) {\n      connection.provider.emitError('webrtc', err);\n      util.log('Failed to setLocalDescription, ', err);\n    });\n  }, function(err) {\n    connection.provider.emitError('webrtc', err);\n    util.log('Failed to create answer, ', err);\n  });\n}\n\n/** Handle an SDP. */\nNegotiator.handleSDP = function(type, connection, sdp) {\n  sdp = new RTCSessionDescription(sdp);\n  var pc = connection.pc;\n\n  util.log('Setting remote description', sdp);\n  pc.setRemoteDescription(sdp, function() {\n    util.log('Set remoteDescription:', type, 'for:', connection.peer);\n\n    if (type === 'OFFER') {\n      Negotiator._makeAnswer(connection);\n    }\n  }, function(err) {\n    connection.provider.emitError('webrtc', err);\n    util.log('Failed to setRemoteDescription, ', err);\n  });\n}\n\n/** Handle a candidate. */\nNegotiator.handleCandidate = function(connection, ice) {\n  var candidate = ice.candidate;\n  var sdpMLineIndex = ice.sdpMLineIndex;\n  connection.pc.addIceCandidate(new RTCIceCandidate({\n    sdpMLineIndex: sdpMLineIndex,\n    candidate: candidate\n  }));\n  util.log('Added ICE candidate for:', connection.peer);\n}\n\nmodule.exports = Negotiator;\n\n},{\"./adapter\":1,\"./util\":8}],6:[function(require,module,exports){\nvar util = require('./util');\nvar EventEmitter = require('eventemitter3');\nvar Socket = require('./socket');\nvar MediaConnection = require('./mediaconnection');\nvar DataConnection = require('./dataconnection');\n\n/**\n * A peer who can initiate connections with other peers.\n */\nfunction Peer(id, options) {\n  if (!(this instanceof Peer)) return new Peer(id, options);\n  EventEmitter.call(this);\n\n  // Deal with overloading\n  if (id && id.constructor == Object) {\n    options = id;\n    id = undefined;\n  } else if (id) {\n    // Ensure id is a string\n    id = id.toString();\n  }\n  //\n\n  // Configurize options\n  options = util.extend({\n    debug: 0, // 1: Errors, 2: Warnings, 3: All logs\n    host: util.CLOUD_HOST,\n    port: util.CLOUD_PORT,\n    key: 'peerjs',\n    path: '/',\n    token: util.randomToken(),\n    config: util.defaultConfig\n  }, options);\n  this.options = options;\n  // Detect relative URL host.\n  if (options.host === '/') {\n    options.host = window.location.hostname;\n  }\n  // Set path correctly.\n  if (options.path[0] !== '/') {\n    options.path = '/' + options.path;\n  }\n  if (options.path[options.path.length - 1] !== '/') {\n    options.path += '/';\n  }\n\n  // Set whether we use SSL to same as current host\n  if (options.secure === undefined && options.host !== util.CLOUD_HOST) {\n    options.secure = util.isSecure();\n  }\n  // Set a custom log function if present\n  if (options.logFunction) {\n    util.setLogFunction(options.logFunction);\n  }\n  util.setLogLevel(options.debug);\n  //\n\n  // Sanity checks\n  // Ensure WebRTC supported\n  if (!util.supports.audioVideo && !util.supports.data ) {\n    this._delayedAbort('browser-incompatible', 'The current browser does not support WebRTC');\n    return;\n  }\n  // Ensure alphanumeric id\n  if (!util.validateId(id)) {\n    this._delayedAbort('invalid-id', 'ID \"' + id + '\" is invalid');\n    return;\n  }\n  // Ensure valid key\n  if (!util.validateKey(options.key)) {\n    this._delayedAbort('invalid-key', 'API KEY \"' + options.key + '\" is invalid');\n    return;\n  }\n  // Ensure not using unsecure cloud server on SSL page\n  if (options.secure && options.host === '0.peerjs.com') {\n    this._delayedAbort('ssl-unavailable',\n      'The cloud server currently does not support HTTPS. Please run your own PeerServer to use HTTPS.');\n    return;\n  }\n  //\n\n  // States.\n  this.destroyed = false; // Connections have been killed\n  this.disconnected = false; // Connection to PeerServer killed but P2P connections still active\n  this.open = false; // Sockets and such are not yet open.\n  //\n\n  // References\n  this.connections = {}; // DataConnections for this peer.\n  this._lostMessages = {}; // src => [list of messages]\n  //\n\n  // Start the server connection\n  this._initializeServerConnection();\n  if (id) {\n    this._initialize(id);\n  } else {\n    this._retrieveId();\n  }\n  //\n}\n\nutil.inherits(Peer, EventEmitter);\n\n// Initialize the 'socket' (which is actually a mix of XHR streaming and\n// websockets.)\nPeer.prototype._initializeServerConnection = function() {\n  var self = this;\n  this.socket = new Socket(this.options.secure, this.options.host, this.options.port, this.options.path, this.options.key);\n  this.socket.on('message', function(data) {\n    self._handleMessage(data);\n  });\n  this.socket.on('error', function(error) {\n    self._abort('socket-error', error);\n  });\n  this.socket.on('disconnected', function() {\n    // If we haven't explicitly disconnected, emit error and disconnect.\n    if (!self.disconnected) {\n      self.emitError('network', 'Lost connection to server.');\n      self.disconnect();\n    }\n  });\n  this.socket.on('close', function() {\n    // If we haven't explicitly disconnected, emit error.\n    if (!self.disconnected) {\n      self._abort('socket-closed', 'Underlying socket is already closed.');\n    }\n  });\n};\n\n/** Get a unique ID from the server via XHR. */\nPeer.prototype._retrieveId = function(cb) {\n  var self = this;\n  var http = new XMLHttpRequest();\n  var protocol = this.options.secure ? 'https://' : 'http://';\n  var url = protocol + this.options.host + ':' + this.options.port +\n    this.options.path + this.options.key + '/id';\n  var queryString = '?ts=' + new Date().getTime() + '' + Math.random();\n  url += queryString;\n\n  // If there's no ID we need to wait for one before trying to init socket.\n  http.open('get', url, true);\n  http.onerror = function(e) {\n    util.error('Error retrieving ID', e);\n    var pathError = '';\n    if (self.options.path === '/' && self.options.host !== util.CLOUD_HOST) {\n      pathError = ' If you passed in a `path` to your self-hosted PeerServer, ' +\n        'you\\'ll also need to pass in that same path when creating a new ' +\n        'Peer.';\n    }\n    self._abort('server-error', 'Could not get an ID from the server.' + pathError);\n  };\n  http.onreadystatechange = function() {\n    if (http.readyState !== 4) {\n      return;\n    }\n    if (http.status !== 200) {\n      http.onerror();\n      return;\n    }\n    self._initialize(http.responseText);\n  };\n  http.send(null);\n};\n\n/** Initialize a connection with the server. */\nPeer.prototype._initialize = function(id) {\n  this.id = id;\n  this.socket.start(this.id, this.options.token);\n};\n\n/** Handles messages from the server. */\nPeer.prototype._handleMessage = function(message) {\n  var type = message.type;\n  var payload = message.payload;\n  var peer = message.src;\n  var connection;\n\n  switch (type) {\n    case 'OPEN': // The connection to the server is open.\n      this.emit('open', this.id);\n      this.open = true;\n      break;\n    case 'ERROR': // Server error.\n      this._abort('server-error', payload.msg);\n      break;\n    case 'ID-TAKEN': // The selected ID is taken.\n      this._abort('unavailable-id', 'ID `' + this.id + '` is taken');\n      break;\n    case 'INVALID-KEY': // The given API key cannot be found.\n      this._abort('invalid-key', 'API KEY \"' + this.options.key + '\" is invalid');\n      break;\n\n    //\n    case 'LEAVE': // Another peer has closed its connection to this peer.\n      util.log('Received leave message from', peer);\n      this._cleanupPeer(peer);\n      break;\n\n    case 'EXPIRE': // The offer sent to a peer has expired without response.\n      this.emitError('peer-unavailable', 'Could not connect to peer ' + peer);\n      break;\n    case 'OFFER': // we should consider switching this to CALL/CONNECT, but this is the least breaking option.\n      var connectionId = payload.connectionId;\n      connection = this.getConnection(peer, connectionId);\n\n      if (connection) {\n        util.warn('Offer received for existing Connection ID:', connectionId);\n        //connection.handleMessage(message);\n      } else {\n        // Create a new connection.\n        if (payload.type === 'media') {\n          connection = new MediaConnection(peer, this, {\n            connectionId: connectionId,\n            _payload: payload,\n            metadata: payload.metadata\n          });\n          this._addConnection(peer, connection);\n          this.emit('call', connection);\n        } else if (payload.type === 'data') {\n          connection = new DataConnection(peer, this, {\n            connectionId: connectionId,\n            _payload: payload,\n            metadata: payload.metadata,\n            label: payload.label,\n            serialization: payload.serialization,\n            reliable: payload.reliable\n          });\n          this._addConnection(peer, connection);\n          this.emit('connection', connection);\n        } else {\n          util.warn('Received malformed connection type:', payload.type);\n          return;\n        }\n        // Find messages.\n        var messages = this._getMessages(connectionId);\n        for (var i = 0, ii = messages.length; i < ii; i += 1) {\n          connection.handleMessage(messages[i]);\n        }\n      }\n      break;\n    default:\n      if (!payload) {\n        util.warn('You received a malformed message from ' + peer + ' of type ' + type);\n        return;\n      }\n\n      var id = payload.connectionId;\n      connection = this.getConnection(peer, id);\n\n      if (connection && connection.pc) {\n        // Pass it on.\n        connection.handleMessage(message);\n      } else if (id) {\n        // Store for possible later use\n        this._storeMessage(id, message);\n      } else {\n        util.warn('You received an unrecognized message:', message);\n      }\n      break;\n  }\n};\n\n/** Stores messages without a set up connection, to be claimed later. */\nPeer.prototype._storeMessage = function(connectionId, message) {\n  if (!this._lostMessages[connectionId]) {\n    this._lostMessages[connectionId] = [];\n  }\n  this._lostMessages[connectionId].push(message);\n};\n\n/** Retrieve messages from lost message store */\nPeer.prototype._getMessages = function(connectionId) {\n  var messages = this._lostMessages[connectionId];\n  if (messages) {\n    delete this._lostMessages[connectionId];\n    return messages;\n  } else {\n    return [];\n  }\n};\n\n/**\n * Returns a DataConnection to the specified peer. See documentation for a\n * complete list of options.\n */\nPeer.prototype.connect = function(peer, options) {\n  if (this.disconnected) {\n    util.warn('You cannot connect to a new Peer because you called ' +\n      '.disconnect() on this Peer and ended your connection with the ' +\n      'server. You can create a new Peer to reconnect, or call reconnect ' +\n      'on this peer if you believe its ID to still be available.');\n    this.emitError('disconnected', 'Cannot connect to new Peer after disconnecting from server.');\n    return;\n  }\n  var connection = new DataConnection(peer, this, options);\n  this._addConnection(peer, connection);\n  return connection;\n};\n\n/**\n * Returns a MediaConnection to the specified peer. See documentation for a\n * complete list of options.\n */\nPeer.prototype.call = function(peer, stream, options) {\n  if (this.disconnected) {\n    util.warn('You cannot connect to a new Peer because you called ' +\n      '.disconnect() on this Peer and ended your connection with the ' +\n      'server. You can create a new Peer to reconnect.');\n    this.emitError('disconnected', 'Cannot connect to new Peer after disconnecting from server.');\n    return;\n  }\n  if (!stream) {\n    util.error('To call a peer, you must provide a stream from your browser\\'s `getUserMedia`.');\n    return;\n  }\n  options = options || {};\n  options._stream = stream;\n  var call = new MediaConnection(peer, this, options);\n  this._addConnection(peer, call);\n  return call;\n};\n\n/** Add a data/media connection to this peer. */\nPeer.prototype._addConnection = function(peer, connection) {\n  if (!this.connections[peer]) {\n    this.connections[peer] = [];\n  }\n  this.connections[peer].push(connection);\n};\n\n/** Retrieve a data/media connection for this peer. */\nPeer.prototype.getConnection = function(peer, id) {\n  var connections = this.connections[peer];\n  if (!connections) {\n    return null;\n  }\n  for (var i = 0, ii = connections.length; i < ii; i++) {\n    if (connections[i].id === id) {\n      return connections[i];\n    }\n  }\n  return null;\n};\n\nPeer.prototype._delayedAbort = function(type, message) {\n  var self = this;\n  util.setZeroTimeout(function(){\n    self._abort(type, message);\n  });\n};\n\n/**\n * Destroys the Peer and emits an error message.\n * The Peer is not destroyed if it's in a disconnected state, in which case\n * it retains its disconnected state and its existing connections.\n */\nPeer.prototype._abort = function(type, message) {\n  util.error('Aborting!');\n  if (!this._lastServerId) {\n    this.destroy();\n  } else {\n    this.disconnect();\n  }\n  this.emitError(type, message);\n};\n\n/** Emits a typed error message. */\nPeer.prototype.emitError = function(type, err) {\n  util.error('Error:', err);\n  if (typeof err === 'string') {\n    err = new Error(err);\n  }\n  err.type = type;\n  this.emit('error', err);\n};\n\n/**\n * Destroys the Peer: closes all active connections as well as the connection\n *  to the server.\n * Warning: The peer can no longer create or accept connections after being\n *  destroyed.\n */\nPeer.prototype.destroy = function() {\n  if (!this.destroyed) {\n    this._cleanup();\n    this.disconnect();\n    this.destroyed = true;\n  }\n};\n\n\n/** Disconnects every connection on this peer. */\nPeer.prototype._cleanup = function() {\n  if (this.connections) {\n    var peers = Object.keys(this.connections);\n    for (var i = 0, ii = peers.length; i < ii; i++) {\n      this._cleanupPeer(peers[i]);\n    }\n  }\n  this.emit('close');\n};\n\n/** Closes all connections to this peer. */\nPeer.prototype._cleanupPeer = function(peer) {\n  var connections = this.connections[peer];\n  for (var j = 0, jj = connections.length; j < jj; j += 1) {\n    connections[j].close();\n  }\n};\n\n/**\n * Disconnects the Peer's connection to the PeerServer. Does not close any\n *  active connections.\n * Warning: The peer can no longer create or accept connections after being\n *  disconnected. It also cannot reconnect to the server.\n */\nPeer.prototype.disconnect = function() {\n  var self = this;\n  util.setZeroTimeout(function(){\n    if (!self.disconnected) {\n      self.disconnected = true;\n      self.open = false;\n      if (self.socket) {\n        self.socket.close();\n      }\n      self.emit('disconnected', self.id);\n      self._lastServerId = self.id;\n      self.id = null;\n    }\n  });\n};\n\n/** Attempts to reconnect with the same ID. */\nPeer.prototype.reconnect = function() {\n  if (this.disconnected && !this.destroyed) {\n    util.log('Attempting reconnection to server with ID ' + this._lastServerId);\n    this.disconnected = false;\n    this._initializeServerConnection();\n    this._initialize(this._lastServerId);\n  } else if (this.destroyed) {\n    throw new Error('This peer cannot reconnect to the server. It has already been destroyed.');\n  } else if (!this.disconnected && !this.open) {\n    // Do nothing. We're still connecting the first time.\n    util.error('In a hurry? We\\'re still trying to make the initial connection!');\n  } else {\n    throw new Error('Peer ' + this.id + ' cannot reconnect because it is not disconnected from the server!');\n  }\n};\n\n/**\n * Get a list of available peer IDs. If you're running your own server, you'll\n * want to set allow_discovery: true in the PeerServer options. If you're using\n * the cloud server, email team@peerjs.com to get the functionality enabled for\n * your key.\n */\nPeer.prototype.listAllPeers = function(cb) {\n  cb = cb || function() {};\n  var self = this;\n  var http = new XMLHttpRequest();\n  var protocol = this.options.secure ? 'https://' : 'http://';\n  var url = protocol + this.options.host + ':' + this.options.port +\n    this.options.path + this.options.key + '/peers';\n  var queryString = '?ts=' + new Date().getTime() + '' + Math.random();\n  url += queryString;\n\n  // If there's no ID we need to wait for one before trying to init socket.\n  http.open('get', url, true);\n  http.onerror = function(e) {\n    self._abort('server-error', 'Could not get peers from the server.');\n    cb([]);\n  };\n  http.onreadystatechange = function() {\n    if (http.readyState !== 4) {\n      return;\n    }\n    if (http.status === 401) {\n      var helpfulError = '';\n      if (self.options.host !== util.CLOUD_HOST) {\n        helpfulError = 'It looks like you\\'re using the cloud server. You can email ' +\n          'team@peerjs.com to enable peer listing for your API key.';\n      } else {\n        helpfulError = 'You need to enable `allow_discovery` on your self-hosted ' +\n          'PeerServer to use this feature.';\n      }\n      cb([]);\n      throw new Error('It doesn\\'t look like you have permission to list peers IDs. ' + helpfulError);\n    } else if (http.status !== 200) {\n      cb([]);\n    } else {\n      cb(JSON.parse(http.responseText));\n    }\n  };\n  http.send(null);\n};\n\nmodule.exports = Peer;\n\n},{\"./dataconnection\":2,\"./mediaconnection\":4,\"./socket\":7,\"./util\":8,\"eventemitter3\":9}],7:[function(require,module,exports){\nvar util = require('./util');\nvar EventEmitter = require('eventemitter3');\n\n/**\n * An abstraction on top of WebSockets and XHR streaming to provide fastest\n * possible connection for peers.\n */\nfunction Socket(secure, host, port, path, key) {\n  if (!(this instanceof Socket)) return new Socket(secure, host, port, path, key);\n\n  EventEmitter.call(this);\n\n  // Disconnected manually.\n  this.disconnected = false;\n  this._queue = [];\n\n  var httpProtocol = secure ? 'https://' : 'http://';\n  var wsProtocol = secure ? 'wss://' : 'ws://';\n  this._httpUrl = httpProtocol + host + ':' + port + path + key;\n  this._wsUrl = wsProtocol + host + ':' + port + path + 'peerjs?key=' + key;\n}\n\nutil.inherits(Socket, EventEmitter);\n\n\n/** Check in with ID or get one from server. */\nSocket.prototype.start = function(id, token) {\n  this.id = id;\n\n  this._httpUrl += '/' + id + '/' + token;\n  this._wsUrl += '&id=' + id + '&token=' + token;\n\n  this._startXhrStream();\n  this._startWebSocket();\n}\n\n\n/** Start up websocket communications. */\nSocket.prototype._startWebSocket = function(id) {\n  var self = this;\n\n  if (this._socket) {\n    return;\n  }\n\n  this._socket = new WebSocket(this._wsUrl);\n\n  this._socket.onmessage = function(event) {\n    try {\n      var data = JSON.parse(event.data);\n    } catch(e) {\n      util.log('Invalid server message', event.data);\n      return;\n    }\n    self.emit('message', data);\n  };\n\n  this._socket.onclose = function(event) {\n    util.log('Socket closed.');\n    self.disconnected = true;\n    self.emit('disconnected');\n  };\n\n  // Take care of the queue of connections if necessary and make sure Peer knows\n  // socket is open.\n  this._socket.onopen = function() {\n    if (self._timeout) {\n      clearTimeout(self._timeout);\n      setTimeout(function(){\n        self._http.abort();\n        self._http = null;\n      }, 5000);\n    }\n    self._sendQueuedMessages();\n    util.log('Socket open');\n  };\n}\n\n/** Start XHR streaming. */\nSocket.prototype._startXhrStream = function(n) {\n  try {\n    var self = this;\n    this._http = new XMLHttpRequest();\n    this._http._index = 1;\n    this._http._streamIndex = n || 0;\n    this._http.open('post', this._httpUrl + '/id?i=' + this._http._streamIndex, true);\n    this._http.onerror = function() {\n      // If we get an error, likely something went wrong.\n      // Stop streaming.\n      clearTimeout(self._timeout);\n      self.emit('disconnected');\n    }\n    this._http.onreadystatechange = function() {\n      if (this.readyState == 2 && this.old) {\n        this.old.abort();\n        delete this.old;\n      } else if (this.readyState > 2 && this.status === 200 && this.responseText) {\n        self._handleStream(this);\n      }\n    };\n    this._http.send(null);\n    this._setHTTPTimeout();\n  } catch(e) {\n    util.log('XMLHttpRequest not available; defaulting to WebSockets');\n  }\n}\n\n\n/** Handles onreadystatechange response as a stream. */\nSocket.prototype._handleStream = function(http) {\n  // 3 and 4 are loading/done state. All others are not relevant.\n  var messages = http.responseText.split('\\n');\n\n  // Check to see if anything needs to be processed on buffer.\n  if (http._buffer) {\n    while (http._buffer.length > 0) {\n      var index = http._buffer.shift();\n      var bufferedMessage = messages[index];\n      try {\n        bufferedMessage = JSON.parse(bufferedMessage);\n      } catch(e) {\n        http._buffer.shift(index);\n        break;\n      }\n      this.emit('message', bufferedMessage);\n    }\n  }\n\n  var message = messages[http._index];\n  if (message) {\n    http._index += 1;\n    // Buffering--this message is incomplete and we'll get to it next time.\n    // This checks if the httpResponse ended in a `\\n`, in which case the last\n    // element of messages should be the empty string.\n    if (http._index === messages.length) {\n      if (!http._buffer) {\n        http._buffer = [];\n      }\n      http._buffer.push(http._index - 1);\n    } else {\n      try {\n        message = JSON.parse(message);\n      } catch(e) {\n        util.log('Invalid server message', message);\n        return;\n      }\n      this.emit('message', message);\n    }\n  }\n}\n\nSocket.prototype._setHTTPTimeout = function() {\n  var self = this;\n  this._timeout = setTimeout(function() {\n    var old = self._http;\n    if (!self._wsOpen()) {\n      self._startXhrStream(old._streamIndex + 1);\n      self._http.old = old;\n    } else {\n      old.abort();\n    }\n  }, 25000);\n}\n\n/** Is the websocket currently open? */\nSocket.prototype._wsOpen = function() {\n  return this._socket && this._socket.readyState == 1;\n}\n\n/** Send queued messages. */\nSocket.prototype._sendQueuedMessages = function() {\n  for (var i = 0, ii = this._queue.length; i < ii; i += 1) {\n    this.send(this._queue[i]);\n  }\n}\n\n/** Exposed send for DC & Peer. */\nSocket.prototype.send = function(data) {\n  if (this.disconnected) {\n    return;\n  }\n\n  // If we didn't get an ID yet, we can't yet send anything so we should queue\n  // up these messages.\n  if (!this.id) {\n    this._queue.push(data);\n    return;\n  }\n\n  if (!data.type) {\n    this.emit('error', 'Invalid message');\n    return;\n  }\n\n  var message = JSON.stringify(data);\n  if (this._wsOpen()) {\n    this._socket.send(message);\n  } else {\n    var http = new XMLHttpRequest();\n    var url = this._httpUrl + '/' + data.type.toLowerCase();\n    http.open('post', url, true);\n    http.setRequestHeader('Content-Type', 'application/json');\n    http.send(message);\n  }\n}\n\nSocket.prototype.close = function() {\n  if (!this.disconnected && this._wsOpen()) {\n    this._socket.close();\n    this.disconnected = true;\n  }\n}\n\nmodule.exports = Socket;\n\n},{\"./util\":8,\"eventemitter3\":9}],8:[function(require,module,exports){\nvar defaultConfig = {'iceServers': [{ 'url': 'stun:stun.l.google.com:19302' }]};\nvar dataCount = 1;\n\nvar BinaryPack = require('js-binarypack');\nvar RTCPeerConnection = require('./adapter').RTCPeerConnection;\n\nvar util = {\n  noop: function() {},\n\n  CLOUD_HOST: '0.peerjs.com',\n  CLOUD_PORT: 9000,\n\n  // Browsers that need chunking:\n  chunkedBrowsers: {'Chrome': 1},\n  chunkedMTU: 16300, // The original 60000 bytes setting does not work when sending data from Firefox to Chrome, which is \"cut off\" after 16384 bytes and delivered individually.\n\n  // Logging logic\n  logLevel: 0,\n  setLogLevel: function(level) {\n    var debugLevel = parseInt(level, 10);\n    if (!isNaN(parseInt(level, 10))) {\n      util.logLevel = debugLevel;\n    } else {\n      // If they are using truthy/falsy values for debug\n      util.logLevel = level ? 3 : 0;\n    }\n    util.log = util.warn = util.error = util.noop;\n    if (util.logLevel > 0) {\n      util.error = util._printWith('ERROR');\n    }\n    if (util.logLevel > 1) {\n      util.warn = util._printWith('WARNING');\n    }\n    if (util.logLevel > 2) {\n      util.log = util._print;\n    }\n  },\n  setLogFunction: function(fn) {\n    if (fn.constructor !== Function) {\n      util.warn('The log function you passed in is not a function. Defaulting to regular logs.');\n    } else {\n      util._print = fn;\n    }\n  },\n\n  _printWith: function(prefix) {\n    return function() {\n      var copy = Array.prototype.slice.call(arguments);\n      copy.unshift(prefix);\n      util._print.apply(util, copy);\n    };\n  },\n  _print: function () {\n    var err = false;\n    var copy = Array.prototype.slice.call(arguments);\n    copy.unshift('PeerJS: ');\n    for (var i = 0, l = copy.length; i < l; i++){\n      if (copy[i] instanceof Error) {\n        copy[i] = '(' + copy[i].name + ') ' + copy[i].message;\n        err = true;\n      }\n    }\n    err ? console.error.apply(console, copy) : console.log.apply(console, copy);\n  },\n  //\n\n  // Returns browser-agnostic default config\n  defaultConfig: defaultConfig,\n  //\n\n  // Returns the current browser.\n  browser: (function() {\n    if (window.mozRTCPeerConnection) {\n      return 'Firefox';\n    } else if (window.webkitRTCPeerConnection) {\n      return 'Chrome';\n    } else if (window.RTCPeerConnection) {\n      return 'Supported';\n    } else {\n      return 'Unsupported';\n    }\n  })(),\n  //\n\n  // Lists which features are supported\n  supports: (function() {\n    if (typeof RTCPeerConnection === 'undefined') {\n      return {};\n    }\n\n    var data = true;\n    var audioVideo = true;\n\n    var binaryBlob = false;\n    var sctp = false;\n    var onnegotiationneeded = !!window.webkitRTCPeerConnection;\n\n    var pc, dc;\n    try {\n      pc = new RTCPeerConnection(defaultConfig, {optional: [{RtpDataChannels: true}]});\n    } catch (e) {\n      data = false;\n      audioVideo = false;\n    }\n\n    if (data) {\n      try {\n        dc = pc.createDataChannel('_PEERJSTEST');\n      } catch (e) {\n        data = false;\n      }\n    }\n\n    if (data) {\n      // Binary test\n      try {\n        dc.binaryType = 'blob';\n        binaryBlob = true;\n      } catch (e) {\n      }\n\n      // Reliable test.\n      // Unfortunately Chrome is a bit unreliable about whether or not they\n      // support reliable.\n      var reliablePC = new RTCPeerConnection(defaultConfig, {});\n      try {\n        var reliableDC = reliablePC.createDataChannel('_PEERJSRELIABLETEST', {});\n        sctp = reliableDC.reliable;\n      } catch (e) {\n      }\n      reliablePC.close();\n    }\n\n    // FIXME: not really the best check...\n    if (audioVideo) {\n      audioVideo = !!pc.addStream;\n    }\n\n    // FIXME: this is not great because in theory it doesn't work for\n    // av-only browsers (?).\n    if (!onnegotiationneeded && data) {\n      // sync default check.\n      var negotiationPC = new RTCPeerConnection(defaultConfig, {optional: [{RtpDataChannels: true}]});\n      negotiationPC.onnegotiationneeded = function() {\n        onnegotiationneeded = true;\n        // async check.\n        if (util && util.supports) {\n          util.supports.onnegotiationneeded = true;\n        }\n      };\n      negotiationPC.createDataChannel('_PEERJSNEGOTIATIONTEST');\n\n      setTimeout(function() {\n        negotiationPC.close();\n      }, 1000);\n    }\n\n    if (pc) {\n      pc.close();\n    }\n\n    return {\n      audioVideo: audioVideo,\n      data: data,\n      binaryBlob: binaryBlob,\n      binary: sctp, // deprecated; sctp implies binary support.\n      reliable: sctp, // deprecated; sctp implies reliable data.\n      sctp: sctp,\n      onnegotiationneeded: onnegotiationneeded\n    };\n  }()),\n  //\n\n  // Ensure alphanumeric ids\n  validateId: function(id) {\n    // Allow empty ids\n    return !id || /^[A-Za-z0-9_-]+(?:[ _-][A-Za-z0-9]+)*$/.exec(id);\n  },\n\n  validateKey: function(key) {\n    // Allow empty keys\n    return !key || /^[A-Za-z0-9_-]+(?:[ _-][A-Za-z0-9]+)*$/.exec(key);\n  },\n\n\n  debug: false,\n\n  inherits: function(ctor, superCtor) {\n    ctor.super_ = superCtor;\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  },\n  extend: function(dest, source) {\n    for(var key in source) {\n      if(source.hasOwnProperty(key)) {\n        dest[key] = source[key];\n      }\n    }\n    return dest;\n  },\n  pack: BinaryPack.pack,\n  unpack: BinaryPack.unpack,\n\n  log: function () {\n    if (util.debug) {\n      var err = false;\n      var copy = Array.prototype.slice.call(arguments);\n      copy.unshift('PeerJS: ');\n      for (var i = 0, l = copy.length; i < l; i++){\n        if (copy[i] instanceof Error) {\n          copy[i] = '(' + copy[i].name + ') ' + copy[i].message;\n          err = true;\n        }\n      }\n      err ? console.error.apply(console, copy) : console.log.apply(console, copy);\n    }\n  },\n\n  setZeroTimeout: (function(global) {\n    var timeouts = [];\n    var messageName = 'zero-timeout-message';\n\n    // Like setTimeout, but only takes a function argument.\t There's\n    // no time argument (always zero) and no arguments (you have to\n    // use a closure).\n    function setZeroTimeoutPostMessage(fn) {\n      timeouts.push(fn);\n      global.postMessage(messageName, '*');\n    }\n\n    function handleMessage(event) {\n      if (event.source == global && event.data == messageName) {\n        if (event.stopPropagation) {\n          event.stopPropagation();\n        }\n        if (timeouts.length) {\n          timeouts.shift()();\n        }\n      }\n    }\n    if (global.addEventListener) {\n      global.addEventListener('message', handleMessage, true);\n    } else if (global.attachEvent) {\n      global.attachEvent('onmessage', handleMessage);\n    }\n    return setZeroTimeoutPostMessage;\n  }(window)),\n\n  // Binary stuff\n\n  // chunks a blob.\n  chunk: function(bl) {\n    var chunks = [];\n    var size = bl.size;\n    var start = index = 0;\n    var total = Math.ceil(size / util.chunkedMTU);\n    while (start < size) {\n      var end = Math.min(size, start + util.chunkedMTU);\n      var b = bl.slice(start, end);\n\n      var chunk = {\n        __peerData: dataCount,\n        n: index,\n        data: b,\n        total: total\n      };\n\n      chunks.push(chunk);\n\n      start = end;\n      index += 1;\n    }\n    dataCount += 1;\n    return chunks;\n  },\n\n  blobToArrayBuffer: function(blob, cb){\n    var fr = new FileReader();\n    fr.onload = function(evt) {\n      cb(evt.target.result);\n    };\n    fr.readAsArrayBuffer(blob);\n  },\n  blobToBinaryString: function(blob, cb){\n    var fr = new FileReader();\n    fr.onload = function(evt) {\n      cb(evt.target.result);\n    };\n    fr.readAsBinaryString(blob);\n  },\n  binaryStringToArrayBuffer: function(binary) {\n    var byteArray = new Uint8Array(binary.length);\n    for (var i = 0; i < binary.length; i++) {\n      byteArray[i] = binary.charCodeAt(i) & 0xff;\n    }\n    return byteArray.buffer;\n  },\n  randomToken: function () {\n    return Math.random().toString(36).substr(2);\n  },\n  //\n\n  isSecure: function() {\n    return location.protocol === 'https:';\n  }\n};\n\nmodule.exports = util;\n\n},{\"./adapter\":1,\"js-binarypack\":10}],9:[function(require,module,exports){\n'use strict';\n\n/**\n * Representation of a single EventEmitter function.\n *\n * @param {Function} fn Event handler to be called.\n * @param {Mixed} context Context for function execution.\n * @param {Boolean} once Only emit once\n * @api private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Minimal EventEmitter interface that is molded against the Node.js\n * EventEmitter interface.\n *\n * @constructor\n * @api public\n */\nfunction EventEmitter() { /* Nothing to set */ }\n\n/**\n * Holds the assigned EventEmitters by name.\n *\n * @type {Object}\n * @private\n */\nEventEmitter.prototype._events = undefined;\n\n/**\n * Return a list of assigned event listeners.\n *\n * @param {String} event The events that should be listed.\n * @returns {Array}\n * @api public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  if (!this._events || !this._events[event]) return [];\n\n  for (var i = 0, l = this._events[event].length, ee = []; i < l; i++) {\n    ee.push(this._events[event][i].fn);\n  }\n\n  return ee;\n};\n\n/**\n * Emit an event to all registered event listeners.\n *\n * @param {String} event The name of the event.\n * @returns {Boolean} Indication if we've emitted an event.\n * @api public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  if (!this._events || !this._events[event]) return false;\n\n  var listeners = this._events[event]\n    , length = listeners.length\n    , len = arguments.length\n    , ee = listeners[0]\n    , args\n    , i, j;\n\n  if (1 === length) {\n    if (ee.once) this.removeListener(event, ee.fn, true);\n\n    switch (len) {\n      case 1: return ee.fn.call(ee.context), true;\n      case 2: return ee.fn.call(ee.context, a1), true;\n      case 3: return ee.fn.call(ee.context, a1, a2), true;\n      case 4: return ee.fn.call(ee.context, a1, a2, a3), true;\n      case 5: return ee.fn.call(ee.context, a1, a2, a3, a4), true;\n      case 6: return ee.fn.call(ee.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    ee.fn.apply(ee.context, args);\n  } else {\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Register a new EventListener for the given event.\n *\n * @param {String} event Name of the event.\n * @param {Functon} fn Callback function.\n * @param {Mixed} context The context of the function.\n * @api public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  if (!this._events) this._events = {};\n  if (!this._events[event]) this._events[event] = [];\n  this._events[event].push(new EE( fn, context || this ));\n\n  return this;\n};\n\n/**\n * Add an EventListener that's only called once.\n *\n * @param {String} event Name of the event.\n * @param {Function} fn Callback function.\n * @param {Mixed} context The context of the function.\n * @api public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  if (!this._events) this._events = {};\n  if (!this._events[event]) this._events[event] = [];\n  this._events[event].push(new EE(fn, context || this, true ));\n\n  return this;\n};\n\n/**\n * Remove event listeners.\n *\n * @param {String} event The event we want to remove.\n * @param {Function} fn The listener that we need to find.\n * @param {Boolean} once Only remove once listeners.\n * @api public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, once) {\n  if (!this._events || !this._events[event]) return this;\n\n  var listeners = this._events[event]\n    , events = [];\n\n  if (fn) for (var i = 0, length = listeners.length; i < length; i++) {\n    if (listeners[i].fn !== fn && listeners[i].once !== once) {\n      events.push(listeners[i]);\n    }\n  }\n\n  //\n  // Reset the array, or remove it completely if we have no more listeners.\n  //\n  if (events.length) this._events[event] = events;\n  else this._events[event] = null;\n\n  return this;\n};\n\n/**\n * Remove all listeners or only the listeners for the specified event.\n *\n * @param {String} event The event want to remove all listeners for.\n * @api public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  if (!this._events) return this;\n\n  if (event) this._events[event] = null;\n  else this._events = {};\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// This function doesn't apply anymore.\n//\nEventEmitter.prototype.setMaxListeners = function setMaxListeners() {\n  return this;\n};\n\n//\n// Expose the module.\n//\nEventEmitter.EventEmitter = EventEmitter;\nEventEmitter.EventEmitter2 = EventEmitter;\nEventEmitter.EventEmitter3 = EventEmitter;\n\nif ('object' === typeof module && module.exports) {\n  module.exports = EventEmitter;\n}\n\n},{}],10:[function(require,module,exports){\nvar BufferBuilder = require('./bufferbuilder').BufferBuilder;\nvar binaryFeatures = require('./bufferbuilder').binaryFeatures;\n\nvar BinaryPack = {\n  unpack: function(data){\n    var unpacker = new Unpacker(data);\n    return unpacker.unpack();\n  },\n  pack: function(data){\n    var packer = new Packer();\n    packer.pack(data);\n    var buffer = packer.getBuffer();\n    return buffer;\n  }\n};\n\nmodule.exports = BinaryPack;\n\nfunction Unpacker (data){\n  // Data is ArrayBuffer\n  this.index = 0;\n  this.dataBuffer = data;\n  this.dataView = new Uint8Array(this.dataBuffer);\n  this.length = this.dataBuffer.byteLength;\n}\n\nUnpacker.prototype.unpack = function(){\n  var type = this.unpack_uint8();\n  if (type < 0x80){\n    var positive_fixnum = type;\n    return positive_fixnum;\n  } else if ((type ^ 0xe0) < 0x20){\n    var negative_fixnum = (type ^ 0xe0) - 0x20;\n    return negative_fixnum;\n  }\n  var size;\n  if ((size = type ^ 0xa0) <= 0x0f){\n    return this.unpack_raw(size);\n  } else if ((size = type ^ 0xb0) <= 0x0f){\n    return this.unpack_string(size);\n  } else if ((size = type ^ 0x90) <= 0x0f){\n    return this.unpack_array(size);\n  } else if ((size = type ^ 0x80) <= 0x0f){\n    return this.unpack_map(size);\n  }\n  switch(type){\n    case 0xc0:\n      return null;\n    case 0xc1:\n      return undefined;\n    case 0xc2:\n      return false;\n    case 0xc3:\n      return true;\n    case 0xca:\n      return this.unpack_float();\n    case 0xcb:\n      return this.unpack_double();\n    case 0xcc:\n      return this.unpack_uint8();\n    case 0xcd:\n      return this.unpack_uint16();\n    case 0xce:\n      return this.unpack_uint32();\n    case 0xcf:\n      return this.unpack_uint64();\n    case 0xd0:\n      return this.unpack_int8();\n    case 0xd1:\n      return this.unpack_int16();\n    case 0xd2:\n      return this.unpack_int32();\n    case 0xd3:\n      return this.unpack_int64();\n    case 0xd4:\n      return undefined;\n    case 0xd5:\n      return undefined;\n    case 0xd6:\n      return undefined;\n    case 0xd7:\n      return undefined;\n    case 0xd8:\n      size = this.unpack_uint16();\n      return this.unpack_string(size);\n    case 0xd9:\n      size = this.unpack_uint32();\n      return this.unpack_string(size);\n    case 0xda:\n      size = this.unpack_uint16();\n      return this.unpack_raw(size);\n    case 0xdb:\n      size = this.unpack_uint32();\n      return this.unpack_raw(size);\n    case 0xdc:\n      size = this.unpack_uint16();\n      return this.unpack_array(size);\n    case 0xdd:\n      size = this.unpack_uint32();\n      return this.unpack_array(size);\n    case 0xde:\n      size = this.unpack_uint16();\n      return this.unpack_map(size);\n    case 0xdf:\n      size = this.unpack_uint32();\n      return this.unpack_map(size);\n  }\n}\n\nUnpacker.prototype.unpack_uint8 = function(){\n  var byte = this.dataView[this.index] & 0xff;\n  this.index++;\n  return byte;\n};\n\nUnpacker.prototype.unpack_uint16 = function(){\n  var bytes = this.read(2);\n  var uint16 =\n    ((bytes[0] & 0xff) * 256) + (bytes[1] & 0xff);\n  this.index += 2;\n  return uint16;\n}\n\nUnpacker.prototype.unpack_uint32 = function(){\n  var bytes = this.read(4);\n  var uint32 =\n     ((bytes[0]  * 256 +\n       bytes[1]) * 256 +\n       bytes[2]) * 256 +\n       bytes[3];\n  this.index += 4;\n  return uint32;\n}\n\nUnpacker.prototype.unpack_uint64 = function(){\n  var bytes = this.read(8);\n  var uint64 =\n   ((((((bytes[0]  * 256 +\n       bytes[1]) * 256 +\n       bytes[2]) * 256 +\n       bytes[3]) * 256 +\n       bytes[4]) * 256 +\n       bytes[5]) * 256 +\n       bytes[6]) * 256 +\n       bytes[7];\n  this.index += 8;\n  return uint64;\n}\n\n\nUnpacker.prototype.unpack_int8 = function(){\n  var uint8 = this.unpack_uint8();\n  return (uint8 < 0x80 ) ? uint8 : uint8 - (1 << 8);\n};\n\nUnpacker.prototype.unpack_int16 = function(){\n  var uint16 = this.unpack_uint16();\n  return (uint16 < 0x8000 ) ? uint16 : uint16 - (1 << 16);\n}\n\nUnpacker.prototype.unpack_int32 = function(){\n  var uint32 = this.unpack_uint32();\n  return (uint32 < Math.pow(2, 31) ) ? uint32 :\n    uint32 - Math.pow(2, 32);\n}\n\nUnpacker.prototype.unpack_int64 = function(){\n  var uint64 = this.unpack_uint64();\n  return (uint64 < Math.pow(2, 63) ) ? uint64 :\n    uint64 - Math.pow(2, 64);\n}\n\nUnpacker.prototype.unpack_raw = function(size){\n  if ( this.length < this.index + size){\n    throw new Error('BinaryPackFailure: index is out of range'\n      + ' ' + this.index + ' ' + size + ' ' + this.length);\n  }\n  var buf = this.dataBuffer.slice(this.index, this.index + size);\n  this.index += size;\n\n    //buf = util.bufferToString(buf);\n\n  return buf;\n}\n\nUnpacker.prototype.unpack_string = function(size){\n  var bytes = this.read(size);\n  var i = 0, str = '', c, code;\n  while(i < size){\n    c = bytes[i];\n    if ( c < 128){\n      str += String.fromCharCode(c);\n      i++;\n    } else if ((c ^ 0xc0) < 32){\n      code = ((c ^ 0xc0) << 6) | (bytes[i+1] & 63);\n      str += String.fromCharCode(code);\n      i += 2;\n    } else {\n      code = ((c & 15) << 12) | ((bytes[i+1] & 63) << 6) |\n        (bytes[i+2] & 63);\n      str += String.fromCharCode(code);\n      i += 3;\n    }\n  }\n  this.index += size;\n  return str;\n}\n\nUnpacker.prototype.unpack_array = function(size){\n  var objects = new Array(size);\n  for(var i = 0; i < size ; i++){\n    objects[i] = this.unpack();\n  }\n  return objects;\n}\n\nUnpacker.prototype.unpack_map = function(size){\n  var map = {};\n  for(var i = 0; i < size ; i++){\n    var key  = this.unpack();\n    var value = this.unpack();\n    map[key] = value;\n  }\n  return map;\n}\n\nUnpacker.prototype.unpack_float = function(){\n  var uint32 = this.unpack_uint32();\n  var sign = uint32 >> 31;\n  var exp  = ((uint32 >> 23) & 0xff) - 127;\n  var fraction = ( uint32 & 0x7fffff ) | 0x800000;\n  return (sign == 0 ? 1 : -1) *\n    fraction * Math.pow(2, exp - 23);\n}\n\nUnpacker.prototype.unpack_double = function(){\n  var h32 = this.unpack_uint32();\n  var l32 = this.unpack_uint32();\n  var sign = h32 >> 31;\n  var exp  = ((h32 >> 20) & 0x7ff) - 1023;\n  var hfrac = ( h32 & 0xfffff ) | 0x100000;\n  var frac = hfrac * Math.pow(2, exp - 20) +\n    l32   * Math.pow(2, exp - 52);\n  return (sign == 0 ? 1 : -1) * frac;\n}\n\nUnpacker.prototype.read = function(length){\n  var j = this.index;\n  if (j + length <= this.length) {\n    return this.dataView.subarray(j, j + length);\n  } else {\n    throw new Error('BinaryPackFailure: read index out of range');\n  }\n}\n\nfunction Packer(){\n  this.bufferBuilder = new BufferBuilder();\n}\n\nPacker.prototype.getBuffer = function(){\n  return this.bufferBuilder.getBuffer();\n}\n\nPacker.prototype.pack = function(value){\n  var type = typeof(value);\n  if (type == 'string'){\n    this.pack_string(value);\n  } else if (type == 'number'){\n    if (Math.floor(value) === value){\n      this.pack_integer(value);\n    } else{\n      this.pack_double(value);\n    }\n  } else if (type == 'boolean'){\n    if (value === true){\n      this.bufferBuilder.append(0xc3);\n    } else if (value === false){\n      this.bufferBuilder.append(0xc2);\n    }\n  } else if (type == 'undefined'){\n    this.bufferBuilder.append(0xc0);\n  } else if (type == 'object'){\n    if (value === null){\n      this.bufferBuilder.append(0xc0);\n    } else {\n      var constructor = value.constructor;\n      if (constructor == Array){\n        this.pack_array(value);\n      } else if (constructor == Blob || constructor == File) {\n        this.pack_bin(value);\n      } else if (constructor == ArrayBuffer) {\n        if(binaryFeatures.useArrayBufferView) {\n          this.pack_bin(new Uint8Array(value));\n        } else {\n          this.pack_bin(value);\n        }\n      } else if ('BYTES_PER_ELEMENT' in value){\n        if(binaryFeatures.useArrayBufferView) {\n          this.pack_bin(new Uint8Array(value.buffer));\n        } else {\n          this.pack_bin(value.buffer);\n        }\n      } else if (constructor == Object){\n        this.pack_object(value);\n      } else if (constructor == Date){\n        this.pack_string(value.toString());\n      } else if (typeof value.toBinaryPack == 'function'){\n        this.bufferBuilder.append(value.toBinaryPack());\n      } else {\n        throw new Error('Type \"' + constructor.toString() + '\" not yet supported');\n      }\n    }\n  } else {\n    throw new Error('Type \"' + type + '\" not yet supported');\n  }\n  this.bufferBuilder.flush();\n}\n\n\nPacker.prototype.pack_bin = function(blob){\n  var length = blob.length || blob.byteLength || blob.size;\n  if (length <= 0x0f){\n    this.pack_uint8(0xa0 + length);\n  } else if (length <= 0xffff){\n    this.bufferBuilder.append(0xda) ;\n    this.pack_uint16(length);\n  } else if (length <= 0xffffffff){\n    this.bufferBuilder.append(0xdb);\n    this.pack_uint32(length);\n  } else{\n    throw new Error('Invalid length');\n  }\n  this.bufferBuilder.append(blob);\n}\n\nPacker.prototype.pack_string = function(str){\n  var length = utf8Length(str);\n\n  if (length <= 0x0f){\n    this.pack_uint8(0xb0 + length);\n  } else if (length <= 0xffff){\n    this.bufferBuilder.append(0xd8) ;\n    this.pack_uint16(length);\n  } else if (length <= 0xffffffff){\n    this.bufferBuilder.append(0xd9);\n    this.pack_uint32(length);\n  } else{\n    throw new Error('Invalid length');\n  }\n  this.bufferBuilder.append(str);\n}\n\nPacker.prototype.pack_array = function(ary){\n  var length = ary.length;\n  if (length <= 0x0f){\n    this.pack_uint8(0x90 + length);\n  } else if (length <= 0xffff){\n    this.bufferBuilder.append(0xdc)\n    this.pack_uint16(length);\n  } else if (length <= 0xffffffff){\n    this.bufferBuilder.append(0xdd);\n    this.pack_uint32(length);\n  } else{\n    throw new Error('Invalid length');\n  }\n  for(var i = 0; i < length ; i++){\n    this.pack(ary[i]);\n  }\n}\n\nPacker.prototype.pack_integer = function(num){\n  if ( -0x20 <= num && num <= 0x7f){\n    this.bufferBuilder.append(num & 0xff);\n  } else if (0x00 <= num && num <= 0xff){\n    this.bufferBuilder.append(0xcc);\n    this.pack_uint8(num);\n  } else if (-0x80 <= num && num <= 0x7f){\n    this.bufferBuilder.append(0xd0);\n    this.pack_int8(num);\n  } else if ( 0x0000 <= num && num <= 0xffff){\n    this.bufferBuilder.append(0xcd);\n    this.pack_uint16(num);\n  } else if (-0x8000 <= num && num <= 0x7fff){\n    this.bufferBuilder.append(0xd1);\n    this.pack_int16(num);\n  } else if ( 0x00000000 <= num && num <= 0xffffffff){\n    this.bufferBuilder.append(0xce);\n    this.pack_uint32(num);\n  } else if (-0x80000000 <= num && num <= 0x7fffffff){\n    this.bufferBuilder.append(0xd2);\n    this.pack_int32(num);\n  } else if (-0x8000000000000000 <= num && num <= 0x7FFFFFFFFFFFFFFF){\n    this.bufferBuilder.append(0xd3);\n    this.pack_int64(num);\n  } else if (0x0000000000000000 <= num && num <= 0xFFFFFFFFFFFFFFFF){\n    this.bufferBuilder.append(0xcf);\n    this.pack_uint64(num);\n  } else{\n    throw new Error('Invalid integer');\n  }\n}\n\nPacker.prototype.pack_double = function(num){\n  var sign = 0;\n  if (num < 0){\n    sign = 1;\n    num = -num;\n  }\n  var exp  = Math.floor(Math.log(num) / Math.LN2);\n  var frac0 = num / Math.pow(2, exp) - 1;\n  var frac1 = Math.floor(frac0 * Math.pow(2, 52));\n  var b32   = Math.pow(2, 32);\n  var h32 = (sign << 31) | ((exp+1023) << 20) |\n      (frac1 / b32) & 0x0fffff;\n  var l32 = frac1 % b32;\n  this.bufferBuilder.append(0xcb);\n  this.pack_int32(h32);\n  this.pack_int32(l32);\n}\n\nPacker.prototype.pack_object = function(obj){\n  var keys = Object.keys(obj);\n  var length = keys.length;\n  if (length <= 0x0f){\n    this.pack_uint8(0x80 + length);\n  } else if (length <= 0xffff){\n    this.bufferBuilder.append(0xde);\n    this.pack_uint16(length);\n  } else if (length <= 0xffffffff){\n    this.bufferBuilder.append(0xdf);\n    this.pack_uint32(length);\n  } else{\n    throw new Error('Invalid length');\n  }\n  for(var prop in obj){\n    if (obj.hasOwnProperty(prop)){\n      this.pack(prop);\n      this.pack(obj[prop]);\n    }\n  }\n}\n\nPacker.prototype.pack_uint8 = function(num){\n  this.bufferBuilder.append(num);\n}\n\nPacker.prototype.pack_uint16 = function(num){\n  this.bufferBuilder.append(num >> 8);\n  this.bufferBuilder.append(num & 0xff);\n}\n\nPacker.prototype.pack_uint32 = function(num){\n  var n = num & 0xffffffff;\n  this.bufferBuilder.append((n & 0xff000000) >>> 24);\n  this.bufferBuilder.append((n & 0x00ff0000) >>> 16);\n  this.bufferBuilder.append((n & 0x0000ff00) >>>  8);\n  this.bufferBuilder.append((n & 0x000000ff));\n}\n\nPacker.prototype.pack_uint64 = function(num){\n  var high = num / Math.pow(2, 32);\n  var low  = num % Math.pow(2, 32);\n  this.bufferBuilder.append((high & 0xff000000) >>> 24);\n  this.bufferBuilder.append((high & 0x00ff0000) >>> 16);\n  this.bufferBuilder.append((high & 0x0000ff00) >>>  8);\n  this.bufferBuilder.append((high & 0x000000ff));\n  this.bufferBuilder.append((low  & 0xff000000) >>> 24);\n  this.bufferBuilder.append((low  & 0x00ff0000) >>> 16);\n  this.bufferBuilder.append((low  & 0x0000ff00) >>>  8);\n  this.bufferBuilder.append((low  & 0x000000ff));\n}\n\nPacker.prototype.pack_int8 = function(num){\n  this.bufferBuilder.append(num & 0xff);\n}\n\nPacker.prototype.pack_int16 = function(num){\n  this.bufferBuilder.append((num & 0xff00) >> 8);\n  this.bufferBuilder.append(num & 0xff);\n}\n\nPacker.prototype.pack_int32 = function(num){\n  this.bufferBuilder.append((num >>> 24) & 0xff);\n  this.bufferBuilder.append((num & 0x00ff0000) >>> 16);\n  this.bufferBuilder.append((num & 0x0000ff00) >>> 8);\n  this.bufferBuilder.append((num & 0x000000ff));\n}\n\nPacker.prototype.pack_int64 = function(num){\n  var high = Math.floor(num / Math.pow(2, 32));\n  var low  = num % Math.pow(2, 32);\n  this.bufferBuilder.append((high & 0xff000000) >>> 24);\n  this.bufferBuilder.append((high & 0x00ff0000) >>> 16);\n  this.bufferBuilder.append((high & 0x0000ff00) >>>  8);\n  this.bufferBuilder.append((high & 0x000000ff));\n  this.bufferBuilder.append((low  & 0xff000000) >>> 24);\n  this.bufferBuilder.append((low  & 0x00ff0000) >>> 16);\n  this.bufferBuilder.append((low  & 0x0000ff00) >>>  8);\n  this.bufferBuilder.append((low  & 0x000000ff));\n}\n\nfunction _utf8Replace(m){\n  var code = m.charCodeAt(0);\n\n  if(code <= 0x7ff) return '00';\n  if(code <= 0xffff) return '000';\n  if(code <= 0x1fffff) return '0000';\n  if(code <= 0x3ffffff) return '00000';\n  return '000000';\n}\n\nfunction utf8Length(str){\n  if (str.length > 600) {\n    // Blob method faster for large strings\n    return (new Blob([str])).size;\n  } else {\n    return str.replace(/[^\\u0000-\\u007F]/g, _utf8Replace).length;\n  }\n}\n\n},{\"./bufferbuilder\":11}],11:[function(require,module,exports){\nvar binaryFeatures = {};\nbinaryFeatures.useBlobBuilder = (function(){\n  try {\n    new Blob([]);\n    return false;\n  } catch (e) {\n    return true;\n  }\n})();\n\nbinaryFeatures.useArrayBufferView = !binaryFeatures.useBlobBuilder && (function(){\n  try {\n    return (new Blob([new Uint8Array([])])).size === 0;\n  } catch (e) {\n    return true;\n  }\n})();\n\nmodule.exports.binaryFeatures = binaryFeatures;\nvar BlobBuilder = module.exports.BlobBuilder;\nif (typeof window != 'undefined') {\n  BlobBuilder = module.exports.BlobBuilder = window.WebKitBlobBuilder ||\n    window.MozBlobBuilder || window.MSBlobBuilder || window.BlobBuilder;\n}\n\nfunction BufferBuilder(){\n  this._pieces = [];\n  this._parts = [];\n}\n\nBufferBuilder.prototype.append = function(data) {\n  if(typeof data === 'number') {\n    this._pieces.push(data);\n  } else {\n    this.flush();\n    this._parts.push(data);\n  }\n};\n\nBufferBuilder.prototype.flush = function() {\n  if (this._pieces.length > 0) {\n    var buf = new Uint8Array(this._pieces);\n    if(!binaryFeatures.useArrayBufferView) {\n      buf = buf.buffer;\n    }\n    this._parts.push(buf);\n    this._pieces = [];\n  }\n};\n\nBufferBuilder.prototype.getBuffer = function() {\n  this.flush();\n  if(binaryFeatures.useBlobBuilder) {\n    var builder = new BlobBuilder();\n    for(var i = 0, ii = this._parts.length; i < ii; i++) {\n      builder.append(this._parts[i]);\n    }\n    return builder.getBlob();\n  } else {\n    return new Blob(this._parts);\n  }\n};\n\nmodule.exports.BufferBuilder = BufferBuilder;\n\n},{}],12:[function(require,module,exports){\nvar util = require('./util');\n\n/**\n * Reliable transfer for Chrome Canary DataChannel impl.\n * Author: @michellebu\n */\nfunction Reliable(dc, debug) {\n  if (!(this instanceof Reliable)) return new Reliable(dc);\n  this._dc = dc;\n\n  util.debug = debug;\n\n  // Messages sent/received so far.\n  // id: { ack: n, chunks: [...] }\n  this._outgoing = {};\n  // id: { ack: ['ack', id, n], chunks: [...] }\n  this._incoming = {};\n  this._received = {};\n\n  // Window size.\n  this._window = 1000;\n  // MTU.\n  this._mtu = 500;\n  // Interval for setInterval. In ms.\n  this._interval = 0;\n\n  // Messages sent.\n  this._count = 0;\n\n  // Outgoing message queue.\n  this._queue = [];\n\n  this._setupDC();\n};\n\n// Send a message reliably.\nReliable.prototype.send = function(msg) {\n  // Determine if chunking is necessary.\n  var bl = util.pack(msg);\n  if (bl.size < this._mtu) {\n    this._handleSend(['no', bl]);\n    return;\n  }\n\n  this._outgoing[this._count] = {\n    ack: 0,\n    chunks: this._chunk(bl)\n  };\n\n  if (util.debug) {\n    this._outgoing[this._count].timer = new Date();\n  }\n\n  // Send prelim window.\n  this._sendWindowedChunks(this._count);\n  this._count += 1;\n};\n\n// Set up interval for processing queue.\nReliable.prototype._setupInterval = function() {\n  // TODO: fail gracefully.\n\n  var self = this;\n  this._timeout = setInterval(function() {\n    // FIXME: String stuff makes things terribly async.\n    var msg = self._queue.shift();\n    if (msg._multiple) {\n      for (var i = 0, ii = msg.length; i < ii; i += 1) {\n        self._intervalSend(msg[i]);\n      }\n    } else {\n      self._intervalSend(msg);\n    }\n  }, this._interval);\n};\n\nReliable.prototype._intervalSend = function(msg) {\n  var self = this;\n  msg = util.pack(msg);\n  util.blobToBinaryString(msg, function(str) {\n    self._dc.send(str);\n  });\n  if (self._queue.length === 0) {\n    clearTimeout(self._timeout);\n    self._timeout = null;\n    //self._processAcks();\n  }\n};\n\n// Go through ACKs to send missing pieces.\nReliable.prototype._processAcks = function() {\n  for (var id in this._outgoing) {\n    if (this._outgoing.hasOwnProperty(id)) {\n      this._sendWindowedChunks(id);\n    }\n  }\n};\n\n// Handle sending a message.\n// FIXME: Don't wait for interval time for all messages...\nReliable.prototype._handleSend = function(msg) {\n  var push = true;\n  for (var i = 0, ii = this._queue.length; i < ii; i += 1) {\n    var item = this._queue[i];\n    if (item === msg) {\n      push = false;\n    } else if (item._multiple && item.indexOf(msg) !== -1) {\n      push = false;\n    }\n  }\n  if (push) {\n    this._queue.push(msg);\n    if (!this._timeout) {\n      this._setupInterval();\n    }\n  }\n};\n\n// Set up DataChannel handlers.\nReliable.prototype._setupDC = function() {\n  // Handle various message types.\n  var self = this;\n  this._dc.onmessage = function(e) {\n    var msg = e.data;\n    var datatype = msg.constructor;\n    // FIXME: msg is String until binary is supported.\n    // Once that happens, this will have to be smarter.\n    if (datatype === String) {\n      var ab = util.binaryStringToArrayBuffer(msg);\n      msg = util.unpack(ab);\n      self._handleMessage(msg);\n    }\n  };\n};\n\n// Handles an incoming message.\nReliable.prototype._handleMessage = function(msg) {\n  var id = msg[1];\n  var idata = this._incoming[id];\n  var odata = this._outgoing[id];\n  var data;\n  switch (msg[0]) {\n    // No chunking was done.\n    case 'no':\n      var message = id;\n      if (!!message) {\n        this.onmessage(util.unpack(message));\n      }\n      break;\n    // Reached the end of the message.\n    case 'end':\n      data = idata;\n\n      // In case end comes first.\n      this._received[id] = msg[2];\n\n      if (!data) {\n        break;\n      }\n\n      this._ack(id);\n      break;\n    case 'ack':\n      data = odata;\n      if (!!data) {\n        var ack = msg[2];\n        // Take the larger ACK, for out of order messages.\n        data.ack = Math.max(ack, data.ack);\n\n        // Clean up when all chunks are ACKed.\n        if (data.ack >= data.chunks.length) {\n          util.log('Time: ', new Date() - data.timer);\n          delete this._outgoing[id];\n        } else {\n          this._processAcks();\n        }\n      }\n      // If !data, just ignore.\n      break;\n    // Received a chunk of data.\n    case 'chunk':\n      // Create a new entry if none exists.\n      data = idata;\n      if (!data) {\n        var end = this._received[id];\n        if (end === true) {\n          break;\n        }\n        data = {\n          ack: ['ack', id, 0],\n          chunks: []\n        };\n        this._incoming[id] = data;\n      }\n\n      var n = msg[2];\n      var chunk = msg[3];\n      data.chunks[n] = new Uint8Array(chunk);\n\n      // If we get the chunk we're looking for, ACK for next missing.\n      // Otherwise, ACK the same N again.\n      if (n === data.ack[2]) {\n        this._calculateNextAck(id);\n      }\n      this._ack(id);\n      break;\n    default:\n      // Shouldn't happen, but would make sense for message to just go\n      // through as is.\n      this._handleSend(msg);\n      break;\n  }\n};\n\n// Chunks BL into smaller messages.\nReliable.prototype._chunk = function(bl) {\n  var chunks = [];\n  var size = bl.size;\n  var start = 0;\n  while (start < size) {\n    var end = Math.min(size, start + this._mtu);\n    var b = bl.slice(start, end);\n    var chunk = {\n      payload: b\n    }\n    chunks.push(chunk);\n    start = end;\n  }\n  util.log('Created', chunks.length, 'chunks.');\n  return chunks;\n};\n\n// Sends ACK N, expecting Nth blob chunk for message ID.\nReliable.prototype._ack = function(id) {\n  var ack = this._incoming[id].ack;\n\n  // if ack is the end value, then call _complete.\n  if (this._received[id] === ack[2]) {\n    this._complete(id);\n    this._received[id] = true;\n  }\n\n  this._handleSend(ack);\n};\n\n// Calculates the next ACK number, given chunks.\nReliable.prototype._calculateNextAck = function(id) {\n  var data = this._incoming[id];\n  var chunks = data.chunks;\n  for (var i = 0, ii = chunks.length; i < ii; i += 1) {\n    // This chunk is missing!!! Better ACK for it.\n    if (chunks[i] === undefined) {\n      data.ack[2] = i;\n      return;\n    }\n  }\n  data.ack[2] = chunks.length;\n};\n\n// Sends the next window of chunks.\nReliable.prototype._sendWindowedChunks = function(id) {\n  util.log('sendWindowedChunks for: ', id);\n  var data = this._outgoing[id];\n  var ch = data.chunks;\n  var chunks = [];\n  var limit = Math.min(data.ack + this._window, ch.length);\n  for (var i = data.ack; i < limit; i += 1) {\n    if (!ch[i].sent || i === data.ack) {\n      ch[i].sent = true;\n      chunks.push(['chunk', id, i, ch[i].payload]);\n    }\n  }\n  if (data.ack + this._window >= ch.length) {\n    chunks.push(['end', id, ch.length])\n  }\n  chunks._multiple = true;\n  this._handleSend(chunks);\n};\n\n// Puts together a message from chunks.\nReliable.prototype._complete = function(id) {\n  util.log('Completed called for', id);\n  var self = this;\n  var chunks = this._incoming[id].chunks;\n  var bl = new Blob(chunks);\n  util.blobToArrayBuffer(bl, function(ab) {\n    self.onmessage(util.unpack(ab));\n  });\n  delete this._incoming[id];\n};\n\n// Ups bandwidth limit on SDP. Meant to be called during offer/answer.\nReliable.higherBandwidthSDP = function(sdp) {\n  // AS stands for Application-Specific Maximum.\n  // Bandwidth number is in kilobits / sec.\n  // See RFC for more info: http://www.ietf.org/rfc/rfc2327.txt\n\n  // Chrome 31+ doesn't want us munging the SDP, so we'll let them have their\n  // way.\n  var version = navigator.appVersion.match(/Chrome\\/(.*?) /);\n  if (version) {\n    version = parseInt(version[1].split('.').shift());\n    if (version < 31) {\n      var parts = sdp.split('b=AS:30');\n      var replace = 'b=AS:102400'; // 100 Mbps\n      if (parts.length > 1) {\n        return parts[0] + replace + parts[1];\n      }\n    }\n  }\n\n  return sdp;\n};\n\n// Overwritten, typically.\nReliable.prototype.onmessage = function(msg) {};\n\nmodule.exports.Reliable = Reliable;\n\n},{\"./util\":13}],13:[function(require,module,exports){\nvar BinaryPack = require('js-binarypack');\n\nvar util = {\n  debug: false,\n\n  inherits: function(ctor, superCtor) {\n    ctor.super_ = superCtor;\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  },\n  extend: function(dest, source) {\n    for(var key in source) {\n      if(source.hasOwnProperty(key)) {\n        dest[key] = source[key];\n      }\n    }\n    return dest;\n  },\n  pack: BinaryPack.pack,\n  unpack: BinaryPack.unpack,\n\n  log: function () {\n    if (util.debug) {\n      var copy = [];\n      for (var i = 0; i < arguments.length; i++) {\n        copy[i] = arguments[i];\n      }\n      copy.unshift('Reliable: ');\n      console.log.apply(console, copy);\n    }\n  },\n\n  setZeroTimeout: (function(global) {\n    var timeouts = [];\n    var messageName = 'zero-timeout-message';\n\n    // Like setTimeout, but only takes a function argument.\t There's\n    // no time argument (always zero) and no arguments (you have to\n    // use a closure).\n    function setZeroTimeoutPostMessage(fn) {\n      timeouts.push(fn);\n      global.postMessage(messageName, '*');\n    }\n\n    function handleMessage(event) {\n      if (event.source == global && event.data == messageName) {\n        if (event.stopPropagation) {\n          event.stopPropagation();\n        }\n        if (timeouts.length) {\n          timeouts.shift()();\n        }\n      }\n    }\n    if (global.addEventListener) {\n      global.addEventListener('message', handleMessage, true);\n    } else if (global.attachEvent) {\n      global.attachEvent('onmessage', handleMessage);\n    }\n    return setZeroTimeoutPostMessage;\n  }(this)),\n\n  blobToArrayBuffer: function(blob, cb){\n    var fr = new FileReader();\n    fr.onload = function(evt) {\n      cb(evt.target.result);\n    };\n    fr.readAsArrayBuffer(blob);\n  },\n  blobToBinaryString: function(blob, cb){\n    var fr = new FileReader();\n    fr.onload = function(evt) {\n      cb(evt.target.result);\n    };\n    fr.readAsBinaryString(blob);\n  },\n  binaryStringToArrayBuffer: function(binary) {\n    var byteArray = new Uint8Array(binary.length);\n    for (var i = 0; i < binary.length; i++) {\n      byteArray[i] = binary.charCodeAt(i) & 0xff;\n    }\n    return byteArray.buffer;\n  },\n  randomToken: function () {\n    return Math.random().toString(36).substr(2);\n  }\n};\n\nmodule.exports = util;\n\n},{\"js-binarypack\":10}]},{},[3]);\n"]}